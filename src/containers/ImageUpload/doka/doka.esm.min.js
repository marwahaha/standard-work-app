/* eslint-disable */

/*!
 * Doka 2.1.1
 * Copyright 2018 PQINA Inc - All Rights Reserved
 * Please visit https://pqina.nl/doka for further information
 */

var isNode=function(t){return t instanceof HTMLElement};function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){_defineProperty(t,e,n[e])})}return t}var insertBefore=function(t,e){return e.parentNode.insertBefore(t,e)},insertAfter=function(t,e){return e.parentNode.insertBefore(t,e.nextSibling)},createStore=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=_objectSpread({},t),o=[],i=[],a=function(t,e,n){n?i.push({type:t,data:e}):(l[t]&&l[t](e),o.push({type:t,data:e}))},c=function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return u[t]?(e=u)[t].apply(e,r):null},s={getState:function(){return _objectSpread({},r)},processActionQueue:function(){var t=o.concat();return o.length=0,t},processDispatchQueue:function(){var t=i.concat();i.length=0,t.forEach(function(t){var e=t.type,n=t.data;a(e,n)})},dispatch:a,query:c},u={};e.forEach(function(t){u=_objectSpread({},t(r),u)});var l={};return n.forEach(function(t){l=_objectSpread({},t(a,c,r),l)}),s},defineProperty=function(t,e,n){"function"!=typeof n?Object.defineProperty(t,e,_objectSpread({},n)):t[e]=n},forin=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])},createObject=function(t){var e={};return forin(t,function(n){defineProperty(e,n,t[n])}),e},attr=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===n)return t.getAttribute(e)||t.hasAttribute(e);t.setAttribute(e,n)},ns="http://www.w3.org/2000/svg",svgElements=["svg","path"],isSVGElement=function(t){return svgElements.includes(t)},createElement=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"===_typeof(e)&&(n=e,e=null);var r=isSVGElement(t)?document.createElementNS(ns,t):document.createElement(t);return e&&(isSVGElement(t)?attr(r,"class",e):r.className=e),forin(n,function(t,e){attr(r,t,e)}),r},appendChild=function(t){return function(e,n){void 0!==n&&t.children[n]?t.insertBefore(e,t.children[n]):t.appendChild(e)}},appendChildView=function(t,e){return function(t,n){return void 0!==n?e.splice(n,0,t):e.push(t),t}},removeChildView=function(t,e){return function(n){return e.splice(e.indexOf(n),1),n.element.parentNode&&t.removeChild(n.element),n}},getViewRect=function(t,e,n,r){var o=n[0]||t.left,i=n[1]||t.top,a=o+t.width,c=i+t.height*(r[1]||1),s={element:_objectSpread({},t),inner:{left:t.left,top:t.top,right:t.right,bottom:t.bottom},outer:{left:o,top:i,right:a,bottom:c}};return e.filter(function(t){return!t.isRectIgnored()}).map(function(t){return t.rect}).forEach(function(t){expandRect(s.inner,_objectSpread({},t.inner)),expandRect(s.outer,_objectSpread({},t.outer))}),calculateRectSize(s.inner),s.outer.bottom+=s.element.marginBottom,s.outer.right+=s.element.marginRight,calculateRectSize(s.outer),s},expandRect=function(t,e){e.top+=t.top,e.right+=t.left,e.bottom+=t.top,e.left+=t.left,e.bottom>t.bottom&&(t.bottom=e.bottom),e.right>t.right&&(t.right=e.right)},calculateRectSize=function(t){t.width=t.right-t.left,t.height=t.bottom-t.top},isNumber=function(t){return"number"==typeof t},thereYet=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001;return Math.abs(t-e)<r&&Math.abs(n)<r},spring=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.stiffness,n=void 0===e?.5:e,r=t.damping,o=void 0===r?.75:r,i=t.mass,a=void 0===i?10:i,c=null,s=null,u=0,l=!1,f=createObject({interpolate:function(){if(!l){if(!isNumber(c)||!isNumber(s))return l=!0,void(u=0);thereYet(s+=u+=-(s-c)*n/a,c,u*=o)?(s=c,u=0,l=!0,f.onupdate(s),f.oncomplete(s)):f.onupdate(s)}},target:{set:function(t){if(isNumber(t)&&!isNumber(s)&&(s=t),null===c&&(c=t,s=t),s===(c=t)||void 0===c)return l=!0,u=0,f.onupdate(s),void f.oncomplete(s);l=!1},get:function(){return c}},resting:{get:function(){return l}},onupdate:function(t){},oncomplete:function(t){}});return f},easeInOutQuad=function(t){return t<.5?2*t*t:(4-2*t)*t-1},tween=function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.duration,o=void 0===r?500:r,i=n.easing,a=void 0===i?easeInOutQuad:i,c=n.delay,s=void 0===c?0:c,u=null,l=!0,f=!1,p=null,d=createObject({interpolate:function(n){l||null===p||(null===u&&(u=n),n-u<s||((t=n-u-s)<o?(e=t/o,d.onupdate((t>=0?a(f?1-e:e):0)*p)):(t=1,e=f?0:1,d.onupdate(e*p),d.oncomplete(e*p),l=!0)))},target:{get:function(){return f?0:p},set:function(t){if(null===p)return p=t,d.onupdate(t),void d.oncomplete(t);t<p?(p=1,f=!0):(f=!1,p=t),l=!1,u=null}},resting:{get:function(){return l}},onupdate:function(t){},oncomplete:function(t){}});return d},animator={spring:spring,tween:tween},createAnimator=function(t,e,n){var r=t[e]&&"object"===_typeof(t[e][n])?t[e][n]:t[e]||t,o="string"==typeof r?r:r.type,i="object"===_typeof(r)?_objectSpread({},r):{};return animator[o]?animator[o](i):null},addGetSet=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(e=Array.isArray(e)?e:[e]).forEach(function(e){t.forEach(function(t){var o=t,i=function(){return n[t]},a=function(e){return n[t]=e};"object"===_typeof(t)&&(o=t.key,i=t.getter||i,a=t.setter||a),e[o]&&!r||(e[o]={get:i,set:a})})})},isDefined=function(t){return null!=t},animations=function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewInternalAPI,o=t.viewExternalAPI,i=(t.viewState,_objectSpread({},n)),a=[];return forin(e,function(t,e){var c=createAnimator(e);c&&(c.onupdate=function(e){n[t]=e},c.target=i[t],addGetSet([{key:t,setter:function(t){c.target!==t&&(c.target=t)},getter:function(){return n[t]}}],[r,o],n,!0),a.push(c))}),{write:function(t){var e=!0;return a.forEach(function(n){n.resting||(e=!1),n.interpolate(t)}),e},destroy:function(){}}},addEvent=function(t){return function(e,n){t.addEventListener(e,n)}},removeEvent=function(t){return function(e,n){t.removeEventListener(e,n)}},listeners=function(t){t.mixinConfig,t.viewProps,t.viewInternalAPI;var e=t.viewExternalAPI,n=(t.viewState,t.view),r=[],o=addEvent(n.element),i=removeEvent(n.element);return e.on=function(t,e){r.push({type:t,fn:e}),o(t,e)},e.off=function(t,e){r.splice(r.findIndex(function(n){return n.type===t&&n.fn===e}),1),i(t,e)},{write:function(){return!0},destroy:function(){r.forEach(function(t){i(t.type,t.fn)})}}},apis=function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewExternalAPI;addGetSet(e,r,n)},defaults={opacity:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotateX:0,rotateY:0,rotateZ:0,originX:0,originY:0},styles=function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewInternalAPI,o=t.viewExternalAPI,i=t.view,a=_objectSpread({},n),c={};addGetSet(e,[r,o],n);var s=function(){return i.rect?getViewRect(i.rect,i.childViews,[n.translateX||0,n.translateY||0],[n.scaleX||0,n.scaleY||0]):null};return r.rect={get:s},o.rect={get:s},e.forEach(function(t){n[t]=void 0===a[t]?defaults[t]:a[t]}),{write:function(){if(propsHaveChanged(c,n))return applyStyles(i.element,n),Object.assign(c,_objectSpread({},n)),!0},destroy:function(){}}},propsHaveChanged=function(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!0;for(var n in e)if(e[n]!==t[n])return!0;return!1},applyStyles=function(t,e){var n=e.opacity,r=e.perspective,o=e.translateX,i=e.translateY,a=e.scaleX,c=e.scaleY,s=e.rotateX,u=e.rotateY,l=e.rotateZ,f=e.originX,p=e.originY,d=e.width,h=e.height,m="",g="";(isDefined(f)||isDefined(p))&&(g+="transform-origin: ".concat(f||0,"px ").concat(p||0,"px;")),isDefined(r)&&(m+="perspective(".concat(r,"px) ")),(isDefined(o)||isDefined(i))&&(m+="translate3d(".concat(o||0,"px, ").concat(i||0,"px, 0) ")),(isDefined(a)||isDefined(c))&&(m+="scale3d(".concat(isDefined(a)?a:1,", ").concat(isDefined(c)?c:1,", 1) ")),isDefined(l)&&(m+="rotateZ(".concat(l,"rad) ")),isDefined(s)&&(m+="rotateX(".concat(s,"rad) ")),isDefined(u)&&(m+="rotateY(".concat(u,"rad) ")),m.length&&(g+="transform:".concat(m,";")),isDefined(n)&&(g+="opacity:".concat(n,";"),0===n&&"BUTTON"===t.nodeName&&(g+="visibility:hidden;"),n<1&&(g+="pointer-events:none;")),isDefined(h)&&(g+="height:".concat(h,"px;")),isDefined(d)&&(g+="width:".concat(d,"px;"));var y=t.elementCurrentStyle||"";g.length===y.length&&g===y||(t.setAttribute("style",g),t.elementCurrentStyle=g)},Mixins={styles:styles,listeners:listeners,animations:animations,apis:apis},updateRect=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.layoutCalculated||(t.paddingTop=parseInt(n.paddingTop,10)||0,t.marginTop=parseInt(n.marginTop,10)||0,t.marginRight=parseInt(n.marginRight,10)||0,t.marginBottom=parseInt(n.marginBottom,10)||0,t.marginLeft=parseInt(n.marginLeft,10)||0,e.layoutCalculated=!0),t.left=e.offsetLeft||0,t.top=e.offsetTop||0,t.width=e.offsetWidth||0,t.height=e.offsetHeight||0,t.right=t.left+t.width,t.bottom=t.top+t.height,t.scrollTop=e.scrollTop,t.hidden=null===e.offsetParent&&"fixed"!==n.position,t},createView=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.tag,n=void 0===e?"div":e,r=t.name,o=void 0===r?null:r,i=t.attributes,a=void 0===i?{}:i,c=t.read,s=void 0===c?function(){}:c,u=t.write,l=void 0===u?function(){}:u,f=t.create,p=void 0===f?function(){}:f,d=t.destroy,h=void 0===d?function(){}:d,m=t.filterFrameActionsForChild,g=void 0===m?function(t,e){return e}:m,y=t.didCreateView,v=void 0===y?function(){}:y,E=t.didWriteView,T=void 0===E?function(){}:E,R=t.ignoreRect,w=void 0!==R&&R,_=t.ignoreRectUpdate,x=void 0!==_&&_,I=t.mixins,C=void 0===I?[]:I;return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=createElement(n,o?"doka--".concat(o):null,a),i=window.getComputedStyle(r,null),c=updateRect(),u=null,f=!1,d=[],m=[],y={},E={},R=[l],_=[s],I=[h],A=function(){return r},O=function(){return d.concat()},b=function(){return u||(u=getViewRect(c,d,[0,0],[1,1]))},S=function(){return r.layoutCalculated=!1},P={element:{get:A},style:{get:function(){return i}},childViews:{get:O}},M=_objectSpread({},P,{rect:{get:b},ref:{get:function(){return y}},is:function(t){return o===t},appendChild:appendChild(r),createChildView:function(t){return function(e,n){return e(t,n)}}(t),linkView:function(t){return d.push(t),t},unlinkView:function(t){d.splice(d.indexOf(t),1)},appendChildView:appendChildView(r,d),removeChildView:removeChildView(r,d),registerWriter:function(t){return R.push(t)},registerReader:function(t){return _.push(t)},registerDestroyer:function(t){return I.push(t)},invalidateLayout:S,dispatch:t.dispatch,query:t.query}),D={element:{get:A},childViews:{get:O},rect:{get:b},resting:{get:function(){return f}},isRectIgnored:function(){return w},invalidateLayout:S,_read:function(){u=null,d.forEach(function(t){return t._read()}),!(x&&c.width&&c.height)&&updateRect(c,r,i);var t={root:G,props:e,rect:c};_.forEach(function(e){return e(t)})},_write:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=0===n.length;return R.forEach(function(o){!1===o({props:e,root:G,actions:n,timestamp:t})&&(r=!1)}),m.forEach(function(e){!1===e.write(t)&&(r=!1)}),d.filter(function(t){return!!t.element.parentNode}).forEach(function(e){e._write(t,g(e,n))||(r=!1)}),d.forEach(function(e,o){e.element.parentNode||(G.appendChild(e.element,o),e._read(),e._write(t,g(e,n)),r=!1)}),f=r,T({props:e,root:G,actions:n,timestamp:t}),r},_destroy:function(){m.forEach(function(t){return t.destroy()}),I.forEach(function(t){t({root:G})}),d.forEach(function(t){return t._destroy()})}},L=_objectSpread({},P,{rect:{get:function(){return c}}});Object.keys(C).sort(function(t,e){return"styles"===t?1:"styles"===e?-1:0}).forEach(function(t){var n=Mixins[t]({mixinConfig:C[t],viewProps:e,viewState:E,viewInternalAPI:M,viewExternalAPI:D,view:createObject(L)});n&&m.push(n)});var G=createObject(M);p({root:G,props:e});var U=r.children.length;return d.forEach(function(t,e){G.appendChild(t.element,U+e)}),v(G),createObject(D,e)}},createPainter=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,r="__framePainter";if(window[r])return window[r].readers.push(t),void window[r].writers.push(e);window[r]={readers:[t],writers:[e]};var o=window[r],i=1e3/n,a=null,c=null;return function t(e){c=window.requestAnimationFrame(t),a||(a=e);var n=e-a;n<=i||(a=e-n%i,o.readers.forEach(function(t){return t()}),o.writers.forEach(function(t){return t(e)}))}(performance.now()),{pause:function(){window.cancelAnimationFrame(c)}}},createRoute=function(t,e){return function(n){var r=n.root,o=n.props,i=n.actions,a=void 0===i?[]:i,c=n.timestamp;a.filter(function(e){return t[e.type]}).forEach(function(e){return t[e.type]({root:r,props:o,action:e.data,timestamp:c})}),e&&e({root:r,props:o,actions:a,timestamp:c})}},isArray=function(t){return Array.isArray(t)},isEmpty=function(t){return null==t},trim=function(t){return t.trim()},toString=function(t){return""+t},toArray=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return isEmpty(t)?[]:isArray(t)?t:toString(t).split(e).map(trim).filter(function(t){return t.length})},isBoolean=function(t){return"boolean"==typeof t},toBoolean=function(t){return isBoolean(t)?t:"true"===t},isString=function(t){return"string"==typeof t},toNumber=function(t){return isNumber(t)?t:isString(t)?toString(t).replace(/[a-z]+/gi,""):0},toInt=function(t){return parseInt(toNumber(t),10)},toFloat=function(t){return parseFloat(toNumber(t))},isInt=function(t){return isNumber(t)&&isFinite(t)&&Math.floor(t)===t},toBytes=function(t){if(isInt(t))return t;var e=toString(t).trim();return/MB$/i.test(e)?(e=e.replace(/MB$i/,"").trim(),1e3*toInt(e)*1e3):/KB/i.test(e)?(e=e.replace(/KB$i/,"").trim(),1e3*toInt(e)):toInt(e)},isFunction=function(t){return"function"==typeof t},toFunctionReference=function(t){for(var e=self,n=t.split("."),r=null;r=n.shift();)if(!(e=e[r]))return null;return e},isNull=function(t){return null===t},getType=function(t){return isArray(t)?"array":isNull(t)?"null":isInt(t)?"int":/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(t)?"bytes":_typeof(t)},replaceSingleQuotes=function(t){return t.replace(/{\s*'/g,'{"').replace(/'\s*}/g,'"}').replace(/'\s*:/g,'":').replace(/:\s*'/g,':"').replace(/,\s*'/g,',"').replace(/'\s*,/g,'",')},conversionTable={array:toArray,boolean:toBoolean,int:function(t){return"bytes"===getType(t)?toBytes(t):toInt(t)},float:toFloat,bytes:toBytes,string:function(t){return isFunction(t)?t:toString(t)},object:function(t){try{return JSON.parse(replaceSingleQuotes(t))}catch(t){return null}},function:function(t){return toFunctionReference(t)}},convertTo=function(t,e){return conversionTable[e](t)},getValueByType=function(t,e,n){if(t===e)return t;var r=getType(t);if(r!==n){var o=convertTo(t,n);if(r=getType(o),null===o)throw'Trying to assign value with incorrect type to "'.concat(option,'", allowed type: "').concat(n,'"');t=o}return t},createOption=function(t,e){var n=t;return{enumerable:!0,get:function(){return n},set:function(r){n=getValueByType(r,t,e)}}},createOptions=function(t){var e={};return forin(t,function(n){var r=t[n];e[n]=createOption(r[0],r[1])}),createObject(e)},resetState=function(t){t.file=null,t.rootRect=null,t.stage=null,t.image=null,t.instantUpdate=!1,t.filePromise=null,t.crop={rectangle:null,transforms:null,rotation:null,flip:null,aspectRatio:null,isRotating:!1,isDirty:!1,instructions:null,draft:{rectangle:null,transforms:null}}},createInitialState=function(t){var e={queue:[],noImageTimeout:null,options:createOptions(t)};return resetState(e),e},fromCamels=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.split(/(?=[A-Z])/).map(function(t){return t.toLowerCase()}).join(e)},createOptionAPI=function(t,e){var n={};return forin(e,function(e){n[e]={get:function(){return t.getState().options[e]},set:function(n){t.dispatch("SET_".concat(fromCamels(e,"_").toUpperCase()),{value:n})}}}),n},createOptionActions=function(t){return function(e,n,r){var o={};return forin(t,function(t){var n=fromCamels(t,"_").toUpperCase();o["SET_".concat(n)]=function(o){try{r.options[t]=o.value}catch(t){}e("DID_SET_".concat(n),{value:r.options[t]})}}),o}},createOptionQueries=function(t){return function(e){var n={};return forin(t,function(t){n["GET_".concat(fromCamels(t,"_").toUpperCase())]=function(n){return e.options[t]}}),n}},getUniqueId=function(){return Math.random().toString(36).substr(2,9)},arrayRemove=function(t,e){return t.splice(e,1)},on=function(){var t=[],e=function(e,n){arrayRemove(t,t.findIndex(function(t){return t.event===e&&(t.cb===n||!n)}))};return{fire:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];t.filter(function(t){return t.event===e}).map(function(t){return t.cb}).forEach(function(t){setTimeout(function(){t.apply(void 0,r)},0)})},on:function(e,n){t.push({event:e,cb:n})},onOnce:function(n,r){t.push({event:n,cb:function(){e(n,r),r.apply(void 0,arguments)}})},off:e}},Type={BOOLEAN:"boolean",INT:"int",STRING:"string",ARRAY:"array",OBJECT:"object",FUNCTION:"function",ACTION:"action",SERVER_API:"serverapi",REGEX:"regex"},getOptions=function(){return _objectSpread({},defaultOptions)},setOptions=function(t){forin(t,function(t,e){defaultOptions[t]&&(defaultOptions[t][0]=getValueByType(e,defaultOptions[t][0],defaultOptions[t][1]))})},defaultOptions={id:[null,Type.STRING],className:[null,Type.STRING],src:[null,Type.STRING],maxImagePreviewWidth:[1500,Type.INT],maxImagePreviewHeight:[1500,Type.INT],allowButtonClose:[!0,Type.BOOLEAN],allowButtonConfirm:[!0,Type.BOOLEAN],allowDropFiles:[!1,Type.BOOLEAN],outputData:[!1,Type.BOOLEAN],outputFile:[!0,Type.BOOLEAN],outputWidth:[null,Type.INT],outputHeight:[null,Type.INT],outputFit:["cover",Type.STRING],outputUpscale:[!0,Type.BOOLEAN],outputStripImageHead:[!0,Type.BOOLEAN],outputType:[null,Type.STRING],outputQuality:[null,Type.INT],cropZoomTimeout:[null,Type.INT],cropAllowImageTurnRight:[!1,Type.BOOLEAN],cropResizeKeyCodes:[[18,91,92,93],Type.ARRAY],cropAspectRatio:[null,Type.STRING],cropAspectRatioOptions:[null,Type.ARRAY],onconfirm:[null,Type.FUNCTION],oncancel:[null,Type.FUNCTION],onclose:[null,Type.FUNCTION],labelButtonReset:["Reset",Type.STRING],labelButtonClose:["Cancel",Type.STRING],labelButtonConfirm:["Done",Type.STRING],labelStatusAwaitingImage:["Waiting for image…",Type.STRING],labelStatusLoadImageError:["Error loading image…",Type.STRING],labelStatusLoadingImage:["Loading image…",Type.STRING],labelStatusProcessingImage:["Processing image…",Type.STRING],labelButtonCropZoom:["Zoom",Type.STRING],labelButtonCropRotateLeft:["Rotate left",Type.STRING],labelButtonCropRotateRight:["Rotate right",Type.STRING],labelButtonCropRotateCenter:["Center rotation",Type.STRING],labelButtonCropFlipHorizontal:["Flip horizontal",Type.STRING],labelButtonCropFlipVertical:["Flip vertical",Type.STRING],labelButtonCropAspectRatio:["Aspect ratio",Type.STRING],styleFullscreenSafeArea:[/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"bottom":"none",Type.STRING],styleLayoutMode:[null,Type.STRING]},limit=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(n,Math.max(e,t))},vectorLimit=function(t,e){return createVector(limit(t.x,e.x,e.x+e.width),limit(t.y,e.y,e.y+e.height))},createVector=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},rectClone=function(t){return createRect(t.x,t.y,t.width,t.height)},rectBounds=function(t){return{top:t.y,right:t.x+t.width,bottom:t.y+t.height,left:t.x}},rectCenter=function(t){return createVector(t.x+.5*t.width,t.y+.5*t.height)},createRect=function(t,e,n,r){return{x:t,y:e,width:n,height:r}},getNumericAspectRatioFromString=function(t){if(isEmpty(t))return t;if(/:/.test(t)){var e=t.split(":"),n=e[0];return e[1]/n}return parseFloat(t)},viewCache=[],queries=function(t){return{GET_STYLES:function(){return Object.keys(t.options).filter(function(t){return/^style/.test(t)}).map(function(e){return{name:e,value:t.options[e]}})},HAS_EMPTY_QUEUE:function(){return 0===t.queue.length},GET_FILE:function(){return t.file},GET_IMAGE:function(){return t.image},GET_STAGE:function(){return t.stage},GET_ROOT:function(){return t.root},GET_CROP_ASPECT_RATIO_OPTIONS:function(){return t.options.cropAspectRatioOptions?t.options.cropAspectRatioOptions.map(function(t){return{label:t.label,value:t.value?getNumericAspectRatioFromString(t.value):null}}):null},GET_CROP_ASPECT_RATIO:function(){return getNumericAspectRatioFromString(void 0===t.crop.aspectRatio?t.options.cropAspectRatio:t.crop.aspectRatio)},GET_CROP_FLIP:function(){return t.crop.flip?_objectSpread({},t.crop.flip):_objectSpread({},t.crop.instructions.flip)},GET_CROP_ROTATION:function(){return _objectSpread({},t.crop.rotation)},GET_CROP:function(e,n){var r=n+"",o=viewCache[e]?viewCache[e][r]:null;if(o)return o;viewCache[e]||(viewCache[e]=[]);var i=getCropView(t);return viewCache[e][r]=i,i}}},canZoom=function(t,e){if(t.height<e.height&&t.width<e.width)return!0;var n=rectCenter(e),r=rectCenter(t);return r.x!==n.x||r.y!==n.y},getCropView=function(t){if(!t.stage||!t.image)return null;var e=t.crop.draft.rectangle||t.crop.rectangle,n=t.crop.draft.transforms||t.crop.transforms,r=n.origin,o=n.translation,i=n.scale,a=n.interaction,c=t.crop.rotation,s=t.crop.flip,u=!(!t.crop.draft.rectangle&&!t.crop.draft.transforms),l=u||t.instantUpdate;return{canRecenter:canZoom(e,t.stage),canReset:t.crop.isDirty||u,isDraft:l,isRotating:t.crop.isRotating,rectangle:e,origin:r,translation:o,scale:i,rotation:c,flip:s,interaction:a}},readExif=function(t,e){if(1165519206!==t.getUint32(e+=2,!1))return-1;var n=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,n);var r=t.getUint16(e,n);e+=2;for(var o=0;o<r;o++)if(274===t.getUint16(e+12*o,n))return t.getUint16(e+12*o+8,n)},readData=function(t){var e=new DataView(t);if(65496!=e.getUint16(0,!1))return null;for(var n,r=e.byteLength,o=2;o<r;){if(e.getUint16(o+2,!1)<=8)return-1;if(n=e.getUint16(o,!1),o+=2,65505===n)return readExif(e,o);if(65280!=(65280&n))return null;o+=e.getUint16(o,!1)}},getImageOrientation=function(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(){return e(readData(r.result)||-1)},r.readAsArrayBuffer(t.slice(0,262144))})},Direction={HORIZONTAL:1,VERTICAL:2},limit$1=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(n,Math.max(e,t))},vectorSubtract$1=function(t,e){return createVector$1(t.x-e.x,t.y-e.y)},vectorDot$1=function(t,e){return t.x*e.x+t.y*e.y},vectorDistanceSquared$1=function(t,e){return vectorDot$1(vectorSubtract$1(t,e),vectorSubtract$1(t,e))},vectorDistance$1=function(t,e){return Math.sqrt(vectorDistanceSquared$1(t,e))},vectorLimit$1=function(t,e){return createVector$1(limit$1(t.x,e.x,e.x+e.width),limit$1(t.y,e.y,e.y+e.height))},vectorRotate$1=function(t,e,n){var r=Math.cos(e),o=Math.sin(e),i=createVector$1(t.x-n.x,t.y-n.y);return createVector$1(n.x+r*i.x-o*i.y,n.y+o*i.x+r*i.y)},createVector$1=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},rectFitsInRect$1=function(t,e){var n=rectBounds$1(t),r=rectBounds$1(e);return n.left>=r.left&&n.top>=r.top&&n.bottom<=r.bottom&&n.right<=r.right},rotateRectCorners$1=function(t,e,n){return 0===e?{tl:t.tl,tr:t.tr,br:t.br,bl:t.bl}:{tl:vectorRotate$1(t.tl,e,n),tr:vectorRotate$1(t.tr,e,n),br:vectorRotate$1(t.br,e,n),bl:vectorRotate$1(t.bl,e,n)}},rectRotate$1=function(t,e,n){var r=rotateRectCorners$1(rectCorners$1(t),e,n),o=r.tl,i=r.tr,a=r.br,c=r.bl,s=Math.min(o.x,i.x,a.x,c.x),u=Math.min(o.y,i.y,a.y,c.y),l=Math.max(o.x,i.x,a.x,c.x),f=Math.max(o.y,i.y,a.y,c.y);return createRect$1(s,u,l-s,f-u)},rectScale$1=function(t,e,n){return createRect$1(e*(t.x-n.x)+n.x,e*(t.y-n.y)+n.y,e*t.width,e*t.height)},rectTranslate$1=function(t,e){return createRect$1(t.x+e.x,t.y+e.y,t.width,t.height)},TRANSFORM_MAP$1={translate:rectTranslate$1,rotate:rectRotate$1,scale:rectScale$1},rectTransform$1=function(t,e,n){return e.reduce(function(t,e){return(0,TRANSFORM_MAP$1[e[0]])(t,e[1],n)},t)},rectBounds$1=function(t){return{top:t.y,right:t.x+t.width,bottom:t.y+t.height,left:t.x}},rectCenter$1=function(t){return createVector$1(t.x+.5*t.width,t.y+.5*t.height)},toIninity$1=1e6,getInfiniteRectEdges$1=function(t){return[{start:{x:-toIninity$1,y:t.y},end:{x:+toIninity$1,y:t.y}},{start:{x:t.x+t.width,y:-toIninity$1},end:{x:t.x+t.width,y:+toIninity$1}},{start:{x:-toIninity$1,y:t.y+t.height},end:{x:toIninity$1,y:t.y+t.height}},{start:{x:t.x,y:-toIninity$1},end:{x:t.x,y:+toIninity$1}}]},rectFromPoints$1=function(t,e){var n=Math.min(t.x,e.x),r=Math.max(t.x,e.x),o=Math.min(t.y,e.y),i=Math.max(t.y,e.y);return createRect$1(n,o,r-n,i-o)},rectCorners$1=function(t){return{tl:{x:t.x,y:t.y},tr:{x:t.x+t.width,y:t.y},br:{x:t.x+t.width,y:t.y+t.height},bl:{x:t.x,y:t.y+t.height}}},createRect$1=function(t,e,n,r){return{x:t,y:e,width:n,height:r}},getCenteredCropRect=function(t,e){var n=t.width,r=n*e;r>t.height&&(n=(r=t.height)/e);var o=.5*(t.width-n),i=.5*(t.height-r);return createRect$1(o,i,n,r)},getOffsetPointOnEdge=function(t,e){var n=t,r=e,o=1.5707963267948966-e,i=Math.sin(1.5707963267948966),a=Math.sin(r),c=Math.sin(o),s=Math.cos(o),u=n/i;return createVector$1(s*(u*a),s*(u*c))},getRotatedRectSize=function(t,e){var n=t.width,r=t.height,o=getOffsetPointOnEdge(n,e),i=getOffsetPointOnEdge(r,e),a=rectCorners$1(t),c=createVector$1(a.tl.x+Math.abs(o.x),a.tl.y-Math.abs(o.y)),s=createVector$1(a.tr.x+Math.abs(i.y),a.tr.y+Math.abs(i.x)),u=createVector$1(a.bl.x-Math.abs(i.y),a.bl.y-Math.abs(i.x));return{width:vectorDistance$1(c,s),height:vectorDistance$1(c,u)}},getImageRectZoomFactor=function(t,e,n,r){var o=r.x>.5?1-r.x:r.x,i=r.y>.5?1-r.y:r.y,a=2*o*t.width,c=2*i*t.height,s=getRotatedRectSize(e,n);return Math.max(s.width/a,s.height/c)},getImageTransformsFromCrop=function(t,e,n){var r=t.center,o=t.zoom,i=t.aspectRatio,a=rectCenter$1(e),c={x:a.x-n.width*r.x,y:a.y-n.height*r.y},s=2*Math.PI+t.rotation%(2*Math.PI),u=getImageRectZoomFactor(n,getCenteredCropRect(e,i||n.height/n.width),s,r);return{origin:{x:r.x*n.width,y:r.y*n.height},translation:c,scale:o*u,rotation:t.rotation}},copyImageTransforms=function(t){return{origin:_objectSpread({},t.origin),translation:_objectSpread({},t.translation),rotation:t.rotation,scale:t.scale}},getAxisAlignedImageRect=function(t,e){var n=e.origin,r=e.translation,o=e.scale;return rectTransform$1(t,[["scale",o],["translate",r]],n)},getRotatedRectCorners=function(t,e){var n=t.width,r=t.height,o=e%(Math.PI/2),i=getOffsetPointOnEdge(n,o),a=getOffsetPointOnEdge(r,o),c=rectCorners$1(t);return{tl:createVector$1(c.tl.x+Math.abs(i.x),c.tl.y-Math.abs(i.y)),tr:createVector$1(c.tr.x+Math.abs(a.y),c.tr.y+Math.abs(a.x)),br:createVector$1(c.br.x-Math.abs(i.x),c.br.y+Math.abs(i.y)),bl:createVector$1(c.bl.x-Math.abs(a.y),c.bl.y-Math.abs(a.x))}},limitImageTransformsToCropRect=function(t,e,n,r){var o=n.translation,i=n.scale,a=n.rotation,c=n.origin,s={origin:_objectSpread({},c),translation:_objectSpread({},o),scale:i,rotation:2*Math.PI+a%(2*Math.PI)},u=t.height/t.width,l={x:c.x+o.x,y:c.y+o.y},f=getRotatedRectCorners(e,s.rotation),p=vectorRotate$1(f.tl,-s.rotation,l),d=vectorRotate$1(f.tr,-s.rotation,l),h=vectorRotate$1(f.br,-s.rotation,l),m=vectorRotate$1(f.bl,-s.rotation,l),g={x:Math.min(p.x,d.x,h.x,m.x),y:Math.min(p.y,d.y,h.y,m.y),width:Math.max(p.x,d.x,h.x,m.x)-Math.min(p.x,d.x,h.x,m.x),height:Math.max(p.y,d.y,h.y,m.y)-Math.min(p.y,d.y,h.y,m.y)},y=createRect$1(g.x,g.y,g.width,g.height),v=rectCenter$1(y),E=rectBounds$1(y),T=getAxisAlignedImageRect(t,n),R=rectCenter$1(T),w={x:T.x,y:T.y},_={x:R.x,y:R.y},x=v.x,I=v.y,C={x:w.x,y:w.y,width:T.width,height:T.height};if(!rectFitsInRect$1(y,T))if("moving"===r){C.y>y.y?C.y=y.y:C.y+C.height<E.bottom&&(C.y=E.bottom-C.height),C.x>y.x?C.x=y.x:C.x+C.width<E.right&&(C.x=E.right-C.width);var A=getAxisAlignedImageRect(t,_objectSpread({},n,{scale:s.scale})),O=rectCenter$1(A);_.x=O.x,_.y=O.y,w.x=A.x,w.y=A.y,C.x=_.x-.5*C.width,C.y=_.y-.5*C.height,C.y>y.y?C.y=y.y:C.y+C.height<E.bottom&&(C.y=E.bottom-C.height),C.x>y.x?C.x=y.x:C.x+C.width<E.right&&(C.x=E.right-C.width);var b={x:C.x-w.x,y:C.y-w.y},S={x:b.x*Math.cos(s.rotation)-b.y*Math.sin(s.rotation),y:b.x*Math.sin(s.rotation)+b.y*Math.cos(s.rotation)};s.translation.x+=S.x,s.translation.y+=S.y}else if("resizing"===r){T.width<y.width&&(C.width=y.width,C.height=C.width*u,C.height<y.height&&(C.height=y.height,C.width=C.height/u)),T.height<y.height&&(C.height=y.height,C.width=C.height/u,C.width<y.width&&(C.width=y.width,C.height=C.width*u)),C.x=_.x-.5*C.width,C.y=_.y-.5*C.height,C.y>y.y?C.y=y.y:C.y+C.height<E.bottom&&(C.y=E.bottom-C.height),C.x>y.x?C.x=y.x:C.x+C.width<E.right&&(C.x=E.right-C.width),s.scale=getImageRectZoomFactor(t,e,s.rotation,{x:(x-C.x)/C.width,y:(I-C.y)/C.height});var P=getAxisAlignedImageRect(t,_objectSpread({},n,{scale:s.scale})),M=rectCenter$1(P);_.x=M.x,_.y=M.y,w.x=P.x,w.y=P.y,C.x=_.x-.5*C.width,C.y=_.y-.5*C.height,C.y>y.y?C.y=y.y:C.y+C.height<E.bottom&&(C.y=E.bottom-C.height),C.x>y.x?C.x=y.x:C.x+C.width<E.right&&(C.x=E.right-C.width);var D={x:C.x-w.x,y:C.y-w.y},L={x:D.x*Math.cos(s.rotation)-D.y*Math.sin(s.rotation),y:D.x*Math.sin(s.rotation)+D.y*Math.cos(s.rotation)};s.translation.x+=L.x,s.translation.y+=L.y}else if("rotating"===r){var G=!1;if(C.y>y.y){var U=C.y-y.y;C.y=y.y,C.height+=2*U,G=!0}if(C.y+C.height<E.bottom){var V=E.bottom-(C.y+C.height);C.y=E.bottom-C.height,C.height+=2*V,G=!0}if(C.x>y.x){var $=C.x-y.x;C.x=y.x,C.width+=2*$,G=!0}if(C.x+C.width<E.right){var N=E.right-(C.x+C.width);C.x=E.right-C.width,C.width+=2*N,G=!0}G&&(s.scale=getImageRectZoomFactor(t,e,s.rotation,{x:(x-T.x)/T.width,y:(I-T.y)/T.height}))}return _objectSpread({},s,{rotation:n.rotation})},getTransformOrigin=function(t,e,n){var r=n.origin,o=n.translation,i=n.scale,a=2*Math.PI+n.rotation%(2*Math.PI),c={x:r.x+o.x,y:r.y+o.y},s=getRotatedRectCorners(e,a),u=vectorRotate$1(s.tl,-a,c),l=vectorRotate$1(s.tr,-a,c),f=vectorRotate$1(s.br,-a,c),p=vectorRotate$1(s.bl,-a,c),d=createRect$1(Math.min(u.x,l.x,f.x,p.x),Math.min(u.y,l.y,f.y,p.y),Math.max(u.x,l.x,f.x,p.x)-Math.min(u.x,l.x,f.x,p.x),Math.max(u.y,l.y,f.y,p.y)-Math.min(u.y,l.y,f.y,p.y)),h=createRect$1(d.x,d.y,d.width,d.height),m=getAxisAlignedImageRect(t,n),g=rectCorners$1(m),y=rectCenter$1(m),v=vectorRotate$1(g.tl,a,c),E=vectorRotate$1(g.br,a,c),T=v.x+.5*(E.x-v.x),R=v.y+.5*(E.y-v.y),w=rectTranslate$1(m,{x:T-y.x,y:R-y.y}),_=rectTranslate$1(h,{x:T-y.x,y:R-y.y}),x=rectCenter$1(_),I={x:w.x,y:w.y},C=w.width,A=w.height,O=(x.x-I.x)/C,b=(x.y-I.y)/A,S={x:O*t.width,y:b*t.height},P=1-i,M=S.x*P,D=S.y*P,L={x:I.x+C*O,y:I.y+A*b},G=vectorRotate$1(I,a,{x:I.x+.5*C,y:I.y+.5*A}),U=vectorRotate$1(I,a,L),V=G.x-U.x,$=G.y-U.y;return{origin:S,translation:{x:I.x-M+V,y:I.y-D+$}}},EdgeMap={n:function(t){return{x:t.x+.5*t.width,y:t.y}},e:function(t){return{x:t.x+t.width,y:t.y+.5*t.height}},s:function(t){return{x:t.x+.5*t.width,y:t.y+t.height}},w:function(t){return{x:t.x,y:t.y+.5*t.height}}},getEdgeCenterCoordinates=function(t,e){return EdgeMap[t](e)},getImageTransformsFromRect=function(t,e,n){var r=n.origin,o=n.translation,i=(n.scale,2*Math.PI+n.rotation%(2*Math.PI)),a=getAxisAlignedImageRect(t,n),c={x:r.x+o.x,y:r.y+o.y},s=getRotatedRectCorners(e,i),u=vectorRotate$1(s.tl,-i,c),l=vectorRotate$1(s.tr,-i,c),f=vectorRotate$1(s.br,-i,c),p={x:Math.min(u.x,l.x,f.x),y:Math.min(u.y,l.y,f.y),width:Math.max(u.x,l.x,f.x)-Math.min(u.x,l.x,f.x),height:Math.max(u.y,l.y,f.y)-Math.min(u.y,l.y,f.y)},d=createRect$1(p.x,p.y,p.width,p.height),h=rectBounds$1(d),m=rectBounds$1(a),g=a;if(h.top<m.top||h.right>m.right||h.bottom>m.bottom||h.left<m.left){var y=_objectSpread({},m);if(h.top<=y.top){var v=y.bottom-y.top,E=y.right-y.left,T=Math.max(1,d.height/v),R=v*T,w=E*T-E;y.bottom=h.top+R,y.top=h.top,y.left-=.5*w,y.right+=.5*w}if(h.bottom>=y.bottom){var _=y.bottom-y.top,x=y.right-y.left,I=Math.max(1,d.height/_),C=_*I,A=x*I-x;y.bottom=h.bottom,y.top=h.bottom-C,y.left-=.5*A,y.right+=.5*A}if(h.left<=y.left){var O=y.bottom-y.top,b=y.right-y.left,S=Math.max(1,d.width/b),P=b*S,M=O*S-O;y.right=h.left+P,y.left=h.left,y.top-=.5*M,y.bottom+=.5*M}if(h.right>=y.right){var D=y.bottom-y.top,L=y.right-y.left,G=Math.max(1,d.width/L),U=L*G,V=D*G-D;y.right=h.right,y.left=h.right-U,y.top-=.5*V,y.bottom+=.5*V}g=createRect$1(y.left,y.top,y.right-y.left,y.bottom-y.top)}var $=rectCorners$1(g),N=rectCenter$1(g),B=vectorRotate$1($.tl,i,c),j=vectorRotate$1($.br,i,c),F=B.x+.5*(j.x-B.x),Y=B.y+.5*(j.y-B.y),k=rectTranslate$1(g,{x:F-N.x,y:Y-N.y}),z=rectTranslate$1(d,{x:F-N.x,y:Y-N.y}),X=rectCenter$1(z),q={x:k.x,y:k.y},Z=k.width,H=k.height,W=(X.x-q.x)/Z,Q=(X.y-q.y)/H,K=Z/t.width,J={x:W*t.width,y:Q*t.height},tt=1-K,et=J.x*tt,nt=J.y*tt,rt={x:q.x+Z*W,y:q.y+H*Q},ot=vectorRotate$1(q,i,{x:q.x+.5*Z,y:q.y+.5*H}),it=vectorRotate$1(q,i,rt),at=ot.x-it.x,ct=ot.y-it.y;return{origin:J,translation:{x:q.x-et+at,y:q.y-nt+ct},scale:K,rotation:n.rotation}},getEdgeTargetRect=function(t,e,n,r,o,i){var a,c,s=r.left,u=r.right,l=r.top,f=r.bottom;if(e===Direction.VERTICAL?(l=Math.min(n.y,t.y),f=Math.max(n.y,t.y)):(s=Math.min(n.x,t.x),u=Math.max(n.x,t.x)),i)if(e===Direction.VERTICAL){a=(f-l)/i;var p=2*Math.min(n.x-o.left,o.right-n.x);a>p&&(c=(a=p)*i,n.y>t.y?l=n.y-c:f=n.y+c),s=n.x-.5*a,u=n.x+.5*a}else{c=(u-s)*i;var d=2*Math.min(n.y-o.top,o.bottom-n.y);c>d&&(a=(c=d)/i,n.x>t.x?s=n.x-a:u=n.x+a),l=n.y-.5*c,f=n.y+.5*c}return createRect$1(s,l,u-s,f-l)},CornerMap={nw:function(t){return{x:t.x,y:t.y}},ne:function(t){return{x:t.x+t.width,y:t.y}},se:function(t){return{x:t.x+t.width,y:t.y+t.height}},sw:function(t){return{x:t.x,y:t.y+t.height}}},getCornerCoordinates=function(t,e){return CornerMap[t](e)},getIntersection=function(t,e){var n,r,o,i,a,c={x:null,y:null,onLine1:!1,onLine2:!1};return 0==(n=(e.end.y-e.start.y)*(t.end.x-t.start.x)-(e.end.x-e.start.x)*(t.end.y-t.start.y))?c:(r=t.start.y-e.start.y,o=t.start.x-e.start.x,i=(e.end.x-e.start.x)*r-(e.end.y-e.start.y)*o,a=(t.end.x-t.start.x)*r-(t.end.y-t.start.y)*o,r=i/n,o=a/n,c.x=t.start.x+r*(t.end.x-t.start.x),c.y=t.start.y+r*(t.end.y-t.start.y),r>0&&r<=1&&(c.onLine1=!0),o>0&&o<1&&(c.onLine2=!0),c)},getCornerTargetRect=function(t,e,n,r){var o=vectorLimit$1({x:t.x,y:t.y},n),i=o.x-e.x,a=o.y-e.y,c=r?Math.sign(a/i)*r:null,s={start:e,end:c?{x:e.x+1e6*i,y:e.y+i*c*1e6}:{x:e.x+1e6*i,y:e.y+1e6*a}},u=getInfiniteRectEdges$1(n).map(function(t){return getIntersection(s,t)}).filter(function(t){return t.onLine1&&t.onLine2}).sort(function(t,n){return vectorDistance$1(t,e)<vectorDistance$1(n,e)?-1:1}).shift(),l=limit$1(vectorDistance$1(e,o)/vectorDistance$1(e,u),0,1);return rectScale$1(rectFromPoints$1(e,u),l,e)},getCropFromView=function(t,e,n){var r=n.origin,o=n.translation,i=getAxisAlignedImageRect(t,n),a={x:r.x+o.x,y:r.y+o.y},c=2*Math.PI+n.rotation%(2*Math.PI),s=getRotatedRectCorners(e,c),u=vectorRotate$1(s.tl,-c,a),l=vectorRotate$1(s.tr,-c,a),f=vectorRotate$1(s.br,-c,a),p={x:Math.min(u.x,l.x,f.x),y:Math.min(u.y,l.y,f.y),width:Math.max(u.x,l.x,f.x)-Math.min(u.x,l.x,f.x),height:Math.max(u.y,l.y,f.y)-Math.min(u.y,l.y,f.y)},d=createRect$1(p.x,p.y,p.width,p.height),h=rectCenter$1(d),m=e.height/e.width,g={x:(h.x-i.x)/i.width,y:(h.y-i.y)/i.height},y=g.y>.5?1-g.y:g.y,v=2*(g.x>.5?1-g.x:g.x)*i.width,E=2*y*i.height;return{center:g,zoom:Math.min(v/d.width,E/d.height),rotation:n.rotation,aspectRatio:m}},roundFloat=function(t){return parseFloat(t.toFixed(10))},TURN=Math.PI/2,PI_QUARTER=Math.PI/4,splitRotation=function(t){var e=roundFloat(PI_QUARTER),n=roundFloat(TURN),r=t/n,o=Math.floor(r)*n,i=t-o;return i>e&&(i-=n,o+=n),{main:o,sub:i}},roundFloat$1=function(t){return parseFloat(t.toFixed(10))},getImageSize=function(t){return new Promise(function(e,n){var r=new Image;r.src=URL.createObjectURL(t),r.onerror=function(t){clearInterval(o),n(t)};var o=setInterval(function(){r.naturalWidth&&r.naturalHeight&&(clearInterval(o),URL.revokeObjectURL(r.src),e({width:r.naturalWidth,height:r.naturalHeight}))},1)})},scaleImageSize=function(t,e){var n={width:t.width,height:t.height};if(t.width>e.width||t.height>e.height){var r=t.height/t.width,o=e.width/t.width,i=e.height/t.height;o<i?(n.width=t.width*o,n.height=n.width*r):(n.height=t.height*i,n.width=n.height/r)}return n},isImage=function(t){return/^image/.test(t.type)},MATRICES={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},getImageOrientationMatrix=function(t,e,n){return-1===n&&(n=1),MATRICES[n](t,e)},createVector$2=function(t,e){return{x:t,y:e}},vectorDot$2=function(t,e){return t.x*e.x+t.y*e.y},vectorSubtract$2=function(t,e){return createVector$2(t.x-e.x,t.y-e.y)},vectorDistanceSquared$2=function(t,e){return vectorDot$2(vectorSubtract$2(t,e),vectorSubtract$2(t,e))},vectorDistance$2=function(t,e){return Math.sqrt(vectorDistanceSquared$2(t,e))},getOffsetPointOnEdge$1=function(t,e){var n=t,r=e,o=1.5707963267948966-e,i=Math.sin(1.5707963267948966),a=Math.sin(r),c=Math.sin(o),s=Math.cos(o),u=n/i;return createVector$2(s*(u*a),s*(u*c))},getRotatedRectSize$1=function(t,e){var n=t.width,r=t.height,o=getOffsetPointOnEdge$1(n,e),i=getOffsetPointOnEdge$1(r,e),a=createVector$2(t.x+Math.abs(o.x),t.y-Math.abs(o.y)),c=createVector$2(t.x+t.width+Math.abs(i.y),t.y+Math.abs(i.x)),s=createVector$2(t.x-Math.abs(i.y),t.y+t.height-Math.abs(i.x));return{width:vectorDistance$2(a,c),height:vectorDistance$2(a,s)}},getImageRectZoomFactor$1=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:.5,y:.5},o=r.x>.5?1-r.x:r.x,i=r.y>.5?1-r.y:r.y,a=2*o*t.width,c=2*i*t.height,s=getRotatedRectSize$1(e,n);return Math.max(s.width/a,s.height/c)},getCenteredCropRect$1=function(t,e){var n=t.width,r=n*e;return r>t.height&&(n=(r=t.height)/e),{x:.5*(t.width-n),y:.5*(t.height-r),width:n,height:r}},calculateCanvasSize=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=t.height/t.width,o=e,i=1,a=r;a>o&&(i=(a=o)/r);var c=Math.max(1/i,o/a),s=t.width/(n*i*c),u=s*e;return{width:Math.round(s),height:Math.round(u)}},isFlipped=function(t){return t&&(t.horizontal||t.vertical)},getBitmap=function(t,e,n){if(!e&&!isFlipped(n))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;var r=document.createElement("canvas"),o=t.naturalWidth,i=t.naturalHeight,a=e>=5&&e<=8;a?(r.width=i,r.height=o):(r.width=o,r.height=i);var c=r.getContext("2d");if(e&&c.transform.apply(c,getImageOrientationMatrix(o,i,e)),isFlipped(n)){var s=[1,0,0,1,0,0];(!a&&n.horizontal||a&n.vertical)&&(s[0]=-1,s[4]=o),(!a&&n.vertical||a&&n.horizontal)&&(s[3]=-1,s[5]=i),c.transform.apply(c,s)}return c.drawImage(t,0,0,o,i),r},imageToImageData=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=getBitmap(t,e,n.flip),o={width:r.width,height:r.height},i=document.createElement("canvas"),a=n.aspectRatio||o.height/o.width,c=calculateCanvasSize(o,a,n.zoom);i.width=c.width,i.height=c.height;var s={x:.5*i.width,y:.5*i.height},u=s.x-o.width*(n.center?n.center.x:.5),l=s.y-o.height*(n.center?n.center.y:.5),f={x:0,y:0,width:i.width,height:i.height,center:s},p=getImageRectZoomFactor$1(o,getCenteredCropRect$1(f,a),n.rotation,n.center),d=(n.zoom||1)*p,h=i.getContext("2d");return h.translate(s.x,s.y),h.rotate(n.rotation||0),h.scale(d,d),h.drawImage(r,u-s.x,l-s.y,o.width,o.height),h.getImageData(0,0,i.width,i.height)};HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var r=this.toDataURL(e,n).split(",")[1];setTimeout(function(){for(var n=atob(r),o=n.length,i=new Uint8Array(o),a=0;a<o;a++)i[a]=n.charCodeAt(a);t(new Blob([i],{type:e||"image/png"}))})}});var imageDataToBlob=function(t,e){return new Promise(function(n,r){var o=document.createElement("canvas");o.width=t.width,o.height=t.height,o.getContext("2d").putImageData(t,0,0),o.toBlob(n,e.type,e.quality)})},cropSVG=function(t,e){return new Promise(function(n,r){var o=new FileReader;o.onloadend=function(){var r=o.result,i=document.createElement("div");i.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",i.innerHTML=r;var a=i.querySelector("svg");document.body.appendChild(i);var c=a.getBBox();i.parentNode.removeChild(i);var s=i.querySelector("title"),u=a.getAttribute("viewBox")||"",l=a.getAttribute("width")||"",f=a.getAttribute("height")||"",p=parseFloat(l)||null,d=parseFloat(f)||null,h=(l.match(/[a-z]+/)||[])[0]||"",m=(f.match(/[a-z]+/)||[])[0]||"",g=u.split(" ").map(parseFloat),y=g.length?{x:g[0],y:g[1],width:g[2],height:g[3]}:c,v=null!=p?p:y.width,E=null!=d?d:y.height;a.style.overflow="visible",a.setAttribute("width",v),a.setAttribute("height",E);var T=e.aspectRatio||E/v,R=v,w=R*T,_=getImageRectZoomFactor$1({width:v,height:E},getCenteredCropRect$1({width:R,height:w},T),e.rotation,e.center),x=e.zoom*_,I=e.rotation*(180/Math.PI),C={x:.5*R,y:.5*w},A={x:C.x-v*e.center.x,y:C.y-E*e.center.y},O=["rotate(".concat(I," ").concat(C.x," ").concat(C.y,")"),"translate(".concat(C.x," ").concat(C.y,")"),"scale(".concat(x,")"),"translate(".concat(-C.x," ").concat(-C.y,")"),"translate(".concat(A.x," ").concat(A.y,")")],b=["scale(".concat(e.flip.horizontal?-1:1," ").concat(e.flip.vertical?-1:1,")"),"translate(".concat(e.flip.horizontal?-v:0," ").concat(e.flip.vertical?-E:0,")")],S='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="'.concat(R).concat(h,'" height="').concat(w).concat(m,'" \nviewBox="0 0 ').concat(R," ").concat(w,'" \npreserveAspectRatio="xMinYMin"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generator: FilePond Image Transform Plugin - https://pqina.nl/filepond --\x3e\n<title>').concat(s?s.textContent:t.name,'</title>\n<desc>Cropped with FilePond.</desc>\n<g transform="').concat(O.join(" "),'">\n<g transform="').concat(b.join(" "),'">\n').concat(a.outerHTML,"\n</g>\n</g>\n</svg>");n(S)},o.readAsText(t)})},objectToImageData=function(t){var e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e},TransformWorker=function(){var t={resize:function(t,e){var n=e.mode,r=e.upscale,o=e.width,i=e.height;if(!o&&!i)return t;null===o?o=i:null===i&&(i=o);if("force"!==n){var a=o/t.width,c=i/t.height,s=1;if("cover"===n?s=Math.max(a,c):"contain"===n&&(s=Math.min(a,c)),s>1&&!1===r)return t;o=t.width*s,i=t.height*s}for(var u=t.width,l=t.height,f=Math.round(o),p=Math.round(i),d=t.data,h=new Uint8ClampedArray(f*p*4),m=u/f,g=l/p,y=Math.ceil(.5*m),v=Math.ceil(.5*g),E=0;E<p;E++)for(var T=0;T<f;T++){for(var R=4*(T+E*f),w=0,_=0,x=0,I=0,C=0,A=0,O=0,b=(E+.5)*g,S=Math.floor(E*g);S<(E+1)*g;S++)for(var P=Math.abs(b-(S+.5))/v,M=(T+.5)*m,D=P*P,L=Math.floor(T*m);L<(T+1)*m;L++){var G=Math.abs(M-(L+.5))/y,U=Math.sqrt(D+G*G);if(U>=-1&&U<=1&&(w=2*U*U*U-3*U*U+1)>0){var V=d[(G=4*(L+S*u))+3];O+=w*V,x+=w,V<255&&(w=w*V/250),I+=w*d[G],C+=w*d[G+1],A+=w*d[G+2],_+=w}}h[R]=I/_,h[R+1]=C/_,h[R+2]=A/_,h[R+3]=O/x}return{data:h,width:f,height:p}}},e=function(e,n){n(function(e,n){return e.forEach(function(e){n=t[e.type](n,e.data)}),n}(e.transforms,e.imageData))};self.onmessage=function(t){e(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e.data.buffer])})}},getExtensionFromFilename=function(t){return t.split(".").pop()},guesstimateExtension=function(t){if("string"!=typeof t)return"";var e=t.split("/").pop();return/svg/.test(e)?"svg":/zip|compressed/.test(e)?"zip":/plain/.test(e)?"txt":/msword/.test(e)?"doc":/[a-z]+/.test(e)?"jpeg"===e?"jpg":e:""},leftPad=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(e+t).slice(-e.length)},getDateString=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return"".concat(t.getFullYear(),"-").concat(leftPad(t.getMonth()+1,"00"),"-").concat(leftPad(t.getDate(),"00"),"_").concat(leftPad(t.getHours(),"00"),"-").concat(leftPad(t.getMinutes(),"00"),"-").concat(leftPad(t.getSeconds(),"00"))},getFileFromBlob=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o="string"==typeof n?t.slice(0,t.size,n):t.slice(0,t.size,t.type);return o.lastModifiedDate=new Date,isString(e)||(e=getDateString()),e&&null===r&&getExtensionFromFilename(e)?o.name=e:(r=r||guesstimateExtension(o.type),o.name=e+(r?"."+r:"")),o},getFilenameWithoutExtension=function(t){return t.substr(0,t.lastIndexOf("."))||t},createWorker=function(t){var e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),r=new Worker(n);return{transfer:function(t,e){},post:function(t,e,n){var o=getUniqueId();r.onmessage=function(t){t.data.id===o&&e(t.data.message)},r.postMessage({id:o,message:t},n)},terminate:function(){r.terminate(),URL.revokeObjectURL(n)}}},getBlobBuilder=function(){return window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder},createBlob=function(t,e){var n=getBlobBuilder();if(n){var r=new n;return r.append(t),r.getBlob(e)}return new Blob([t],{type:e})},renameFile=function(t,e){var n=t.slice(0,t.size,t.type);return n.lastModifiedDate=t.lastModifiedDate,n.name=e,n},loadImage=function(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=function(t){n(t)},r.src=t})},correctOrientation=function(t,e,n){if(1165519206===t.getUint32(e+4,!1)){e+=4;var r=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,r);var o=t.getUint16(e,r);e+=2;for(var i=0;i<o;i++)if(274===t.getUint16(e+12*i,r))return t.setUint16(e+12*i+8,1,r),!0;return!1}},readData$1=function(t){var e=new DataView(t);if(65496!==e.getUint16(0))return null;for(var n,r,o=2,i=!1;o<e.byteLength;){if(n=e.getUint16(o,!1),r=e.getUint16(o+2,!1)+2,!(n>=65504&&n<=65519||65534===n))break;if(i||(i=correctOrientation(e,o,r)),o+r>e.byteLength)break;o+=r}return t.slice(0,o)},getImageHead=function(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(){return e(readData$1(r.result)||null)},r.readAsArrayBuffer(t.slice(0,262144))})},renameFileToMatchMimeType=function(t,e){var n=getFilenameWithoutExtension(t),r="image/jpeg"===e?"jpg":e.split("/")[1];return"".concat(n,".").concat(r)},getOutputMimeType=function(t){return"image/jpeg"===t||"image/png"===t?t:"image/jpeg"},transformFile=function(t,e,n){return new Promise(function(r,o){if(!isImage(t))return o();var i=e.output.quality,a=null===i?null:i/100,c=e.output.type,s=e.crop,u=e.size,l=[];(u.width||u.height)&&l.push({type:"resize",data:u});var f=function(e){var n=getFileFromBlob(e,renameFileToMatchMimeType(t.name,getOutputMimeType(e.type)));r(n)},p=function(e,r){return imageDataToBlob(e,r).then(function(e){if(n)return f(e);getImageHead(t).then(function(t){null!==t&&(e=new Blob([t,e.slice(20)],{type:e.type})),f(e)})}).catch(function(t){o(t)})};if(/svg/.test(t.type)&&null===c)cropSVG(t,s).then(function(e){r(renameFile(createBlob(e,"image/svg+xml"),t.name))});else{var d=URL.createObjectURL(t);loadImage(d).then(function(n){URL.revokeObjectURL(d);var r=e.image.orientation,o=imageToImageData(n,r,s);if(l.length){var i=createWorker(TransformWorker);i.post({transforms:l,imageData:o},function(e){p(objectToImageData(e),{quality:a,type:c||t.type}),i.terminate()},[o.data.buffer])}else p(o,{quality:a,type:c||t.type})})}})},TURN$1=Math.PI/2,prepareOutput=function(t,e,n){return new Promise(function(r,o){var i={data:null,file:null},a={crop:getCropFromState(e),image:{orientation:e.file.orientation},size:{mode:n("GET_OUTPUT_FIT"),upscale:n("GET_OUTPUT_UPSCALE"),width:n("GET_OUTPUT_WIDTH"),height:n("GET_OUTPUT_HEIGHT")},output:{type:n("GET_OUTPUT_TYPE"),quality:n("GET_OUTPUT_QUALITY")}};t.data&&(i.data=a),t.file?transformFile(e.file.data,a,n("GET_OUTPUT_STRIP_IMAGE_HEAD")).then(function(t){i.file=t,r(i)}).catch(o):r(i)})},resetRotationScale=function(t){t.crop.draft.rotateMinScale=null},storeRotationScale=function(t){t.crop.draft.rotateMinScale||(t.crop.draft.rotateMinScale=t.crop.transforms.scale)},rotate=function(t,e){storeRotationScale(t);var n=_objectSpread({},t.crop.transforms,{scale:t.crop.draft.rotateMinScale});t.crop.rotation=e,t.crop.draft.transforms=getRotateTransforms(t.image,t.crop.rectangle,n,t.crop.rotation.main+t.crop.rotation.sub)},reset=function(t){clearCenterTimeout(),t.crop.rectangle=getCenteredCropRect(t.stage,t.crop.instructions.aspectRatio||t.image.aspectRatio),t.crop.draft.rectangle=null,t.crop.transforms=getImageTransformsFromCrop(t.crop.instructions,t.stage,t.image),t.crop.draft.transforms=null,t.crop.rotation=splitRotation(t.crop.instructions.rotation),t.crop.flip=_objectSpread({},t.crop.instructions.flip),t.crop.isDirty=!1,t.crop.aspectRatio=t.crop.instructions.aspectRatio,resetRotationScale(t)},recenter=function(t){clearTimeout(zoomTimeoutId);var e=t.crop.draft.transforms||t.crop.transforms,n=getCropFromView(t.image,t.crop.rectangle,e);t.crop.aspectRatio&&(n.aspectRatio=t.crop.aspectRatio),t.crop.transforms=getImageTransformsFromCrop(n,t.stage,t.image),t.crop.draft.transforms=null;var r=t.crop.aspectRatio||t.crop.rectangle.height/t.crop.rectangle.width;t.crop.rectangle=getCenteredCropRect(t.stage,r),t.crop.draft.rectangle=null,resetRotationScale(t)},confirmImageDraft=function(t){t.crop.draft.rectangle=null,t.crop.transforms=t.crop.draft.transforms,t.crop.draft.transforms=null,t.crop.transforms=_objectSpread({},t.crop.transforms,getTransformOrigin(t.image,t.crop.rectangle,t.crop.transforms)),t.crop.isRotating=!1,t.crop.isDirty=!0},zoomTimeoutId=null,startCenterTimeout=function(t,e){var n=t("GET_CROP_ZOOM_TIMEOUT");n&&(clearTimeout(zoomTimeoutId),zoomTimeoutId=setTimeout(function(){e("CROP_ZOOM")},n))},resetCenterTimeout=function(t,e){clearCenterTimeout(),startCenterTimeout(t,e)},clearCenterTimeout=function(){clearTimeout(zoomTimeoutId)},confirmCropDraft=function(t){t.crop.rectangle=t.crop.draft.rectangle,t.crop.draft.rectangle=null,confirmImageDraft(t),resetRotationScale(t)},copyConfirmed=function(t){t.crop.draft.transforms=copyImageTransforms(t.crop.transforms),t.crop.draft.rectangle=rectClone(t.crop.rectangle),clearCenterTimeout()},getRotateTransforms=function(t,e,n,r){return limitImageTransformsToCropRect(t,e,_objectSpread({},copyImageTransforms(n),{rotation:r}),"rotating")},getResizeTransforms=function(t,e,n,r){var o=Math.max(1e-10,r),i=limitImageTransformsToCropRect(t,e,_objectSpread({},copyImageTransforms(n),{scale:o}),"resizing");return i.interaction={scale:o},i},getTranslateTransforms=function(t,e,n,r){var o={x:n.translation.x+r.x,y:n.translation.y+r.y},i=limitImageTransformsToCropRect(t,e,_objectSpread({},copyImageTransforms(n),{translation:o}),"moving");return i.interaction={translation:o},i},getCropFromState=function(t){var e=getCropFromView(t.image,t.crop.rectangle,t.crop.transforms);return{center:{x:roundFloat$1(e.center.x),y:roundFloat$1(e.center.y)},rotation:roundFloat$1(e.rotation),zoom:roundFloat$1(e.zoom),aspectRatio:roundFloat$1(e.aspectRatio),flip:_objectSpread({},t.crop.flip)}},mergeCrop=function(t,e){return e?_objectSpread({},t,e,{center:_objectSpread({},t.center,e.center||{}),flip:_objectSpread({},t.flip,e.flip||{})}):t},loadImage$1=function(t){return new Promise(function(e,n){if(isString(t))fetch(t).then(function(t){return t.blob()}).then(function(t){return e(t)});else if(t instanceof Blob)e(t);else{if("IMG"===t.nodeName){var r=function(t){var n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight,n.getContext("2d").drawImage(t,0,0),n.toBlob(e)};return t.complete?void r(t):void(t.onload=function(){r(t)})}"CANVAS"!==t.nodeName?n(t):t.toBlob(e)}})},actions=function(t,e,n){return{EDIT_OPEN:function(){n.noImageTimeout=setTimeout(function(){t("AWAITING_IMAGE")},500)},REQUEST_LOAD_IMAGE:function(e){var r=e.source,o=e.success,i=void 0===o?function(){}:o,a=e.failure,c=void 0===a?function(t){}:a,s=e.options,u=e.resolveOnConfirm,l=void 0!==u&&u;if(clearTimeout(n.noImageTimeout),!r)return c();n.file?n.queue.push({source:r,success:i,failure:c,options:s,resolveOnConfirm:l}):(resetState(n),t("DID_REQUEST_LOAD_IMAGE"),loadImage$1(r).then(function(e){e.name||(e.name=getDateString()),n.file={orientation:-1,data:e},t("LOAD_IMAGE",{success:i,failure:c,options:s,resolveOnConfirm:l},!0),t("KICK")}).catch(c))},LOAD_IMAGE:function(r){var o=r.success,i=r.failure,a=r.options,c=void 0===a?{}:a,s=r.resolveOnConfirm,u=n.file.data;Promise.all([getImageSize(u),getImageOrientation(u)]).then(function(r){var a=r[0],u=r[1];n.file.orientation=u;var l=a.width,f=a.height;u>=5&&u<=8?(a.width=f,a.height=l):(a.width=l,a.height=f);var p=scaleImageSize(a,{width:e("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:e("GET_MAX_IMAGE_PREVIEW_HEIGHT")});n.image={x:0,y:0,width:p.width,height:p.height,naturalWidth:a.width,naturalHeight:a.height,aspectRatio:a.height/a.width},n.crop.instructions=mergeCrop({center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:n.options.cropAspectRatio},c.crop);var d=(n.options.cropAspectRatioOptions||[]).map(function(t){return t.value}).find(function(t){return t===n.crop.instructions.aspectRatio});n.crop.aspectRatio=d||void 0,t("DID_LOAD_IMAGE"),n.filePromise={resolveOnConfirm:s,success:o,failure:i}}).catch(function(e){t("DID_LOAD_IMAGE_ERROR"),resetState(n),i()})},DID_UPDATE_VIEWPORT:function(t){var e=t.rect;n.root=e},DID_RESIZE_STAGE:function(t){var r=t.size,o=r.width,i=r.height,a=null===n.stage;n.stage=createRect(0,0,o,i),a?(reset(n),n.filePromise.resolveOnConfirm||n.filePromise.success({crop:getCropFromState(n),image:{orientation:n.file.orientation},size:{mode:e("GET_OUTPUT_FIT"),upscale:e("GET_OUTPUT_UPSCALE"),width:e("GET_OUTPUT_WIDTH"),height:e("GET_OUTPUT_HEIGHT")},output:{type:e("GET_OUTPUT_TYPE"),quality:e("GET_OUTPUT_QUALITY")}})):(n.instantUpdate=!0,recenter(n),setTimeout(function(){n.instantUpdate=!1},16))},CROP_ZOOM:function(){clearCenterTimeout(),recenter(n)},CROP_SET_ASPECT_RATIO:function(t){var e=t.value;clearCenterTimeout(),n.crop.aspectRatio=e,recenter(n),n.crop.isDirty=!0},CROP_RECT_CORNER_DRAG_RELEASE:function(){return confirmCropDraft(n)||startCenterTimeout(e,t)},CROP_RECT_EDGE_DRAG_RELEASE:function(){return confirmCropDraft(n)||startCenterTimeout(e,t)},CROP_IMAGE_DRAG_GRAB:function(){return copyConfirmed(n)||clearCenterTimeout()},CROP_IMAGE_RESIZE_GRAB:function(){return copyConfirmed(n)||clearCenterTimeout()},CROP_IMAGE_ROTATE_GRAB:function(){copyConfirmed(n),clearCenterTimeout(),n.crop.isRotating=!0},CROP_RECT_EDGE_DRAG_GRAB:function(){return copyConfirmed(n)||clearCenterTimeout()},CROP_RECT_CORNER_DRAG_GRAB:function(){return copyConfirmed(n)||clearCenterTimeout()},CROP_RECT_EDGE_DRAG:function(t){var e=t.offset,r=t.origin,o=t.anchor,i=n.image,a=n.stage,c=/n|s/.test(r)?Direction.VERTICAL:Direction.HORIZONTAL,s=getEdgeCenterCoordinates(r,n.crop.rectangle),u=getEdgeCenterCoordinates(o,n.crop.rectangle),l=vectorLimit({x:s.x+(c===Direction.HORIZONTAL?e.x:0),y:s.y+(c===Direction.VERTICAL?e.y:0)},a);n.crop.draft.rectangle=getEdgeTargetRect(l,c,u,rectBounds(n.crop.rectangle),rectBounds(a),n.crop.aspectRatio),n.crop.draft.transforms=getImageTransformsFromRect(i,n.crop.draft.rectangle,n.crop.transforms)},CROP_RECT_CORNER_DRAG:function(t){var e=t.offset,r=t.origin,o=t.anchor,i=n.image,a=n.stage,c=getCornerCoordinates(r,n.crop.rectangle),s=getCornerCoordinates(o,n.crop.rectangle),u={x:c.x+e.x,y:c.y+e.y};n.crop.draft.rectangle=getCornerTargetRect(u,s,a,n.crop.aspectRatio),n.crop.draft.transforms=getImageTransformsFromRect(i,n.crop.draft.rectangle,n.crop.transforms)},CROP_IMAGE_DRAG_RELEASE:function(){confirmImageDraft(n),resetRotationScale(n),startCenterTimeout(e,t)},CROP_IMAGE_RESIZE_RELEASE:function(){confirmImageDraft(n),resetRotationScale(n),startCenterTimeout(e,t)},CROP_IMAGE_ROTATE_RELEASE:function(){confirmImageDraft(n),startCenterTimeout(e,t)},CROP_IMAGE_DRAG:function(t){var e=t.value;clearCenterTimeout(),n.crop.draft.transforms=getTranslateTransforms(n.image,n.crop.rectangle,n.crop.transforms,e)},CROP_IMAGE_RESIZE:function(t){var e=t.value;clearCenterTimeout();var r=n.crop.transforms;n.crop.draft.transforms=getResizeTransforms(n.image,n.crop.rectangle,r,r.scale+r.scale*e)},CROP_IMAGE_RESIZE_MULTIPLY:function(t){var e=t.value;clearCenterTimeout();var r=n.crop.transforms;n.crop.draft.transforms=getResizeTransforms(n.image,n.crop.rectangle,r,r.scale*e)},CROP_IMAGE_RESIZE_AMOUNT:function(t){var e=t.value;clearCenterTimeout();var r=n.crop.transforms;n.crop.draft.transforms=getResizeTransforms(n.image,n.crop.rectangle,r,(n.crop.draft.transforms?n.crop.draft.transforms.scale:r.scale)+e)},CROP_IMAGE_ROTATE:function(t){var e=t.value;clearCenterTimeout(),n.crop.isRotating=!0,rotate(n,{main:n.crop.rotation.main,sub:e})},CROP_IMAGE_ROTATE_ADJUST:function(t){var e=t.value;clearCenterTimeout(),rotate(n,{main:n.crop.rotation.main,sub:Math.min(Math.PI/4,Math.max(-Math.PI/4,n.crop.rotation.sub+e))}),confirmImageDraft(n)},CROP_IMAGE_ROTATE_CENTER:function(){clearCenterTimeout(),rotate(n,{main:n.crop.rotation.main,sub:0}),confirmImageDraft(n)},CROP_IMAGE_ROTATE_LEFT:function(){resetCenterTimeout(e,t),rotate(n,{main:n.crop.rotation.main-TURN$1,sub:n.crop.rotation.sub}),confirmImageDraft(n)},CROP_IMAGE_ROTATE_RIGHT:function(){resetCenterTimeout(e,t),rotate(n,{main:n.crop.rotation.main+TURN$1,sub:n.crop.rotation.sub}),confirmImageDraft(n)},CROP_IMAGE_FLIP_HORIZONTAL:function(){resetCenterTimeout(e,t),n.crop.rotation.main%Math.PI/2==0?n.crop.flip.horizontal=!n.crop.flip.horizontal:n.crop.flip.vertical=!n.crop.flip.vertical,n.crop.isDirty=!0},CROP_IMAGE_FLIP_VERTICAL:function(){resetCenterTimeout(e,t),n.crop.rotation.main%Math.PI/2==0?n.crop.flip.vertical=!n.crop.flip.vertical:n.crop.flip.horizontal=!n.crop.flip.horizontal,n.crop.isDirty=!0},SET_DATA:function(e){n.crop.instructions=mergeCrop({center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:n.options.cropAspectRatio},e.crop);var r=(n.options.cropAspectRatioOptions||[]).map(function(t){return t.value}).find(function(t){return t===n.crop.instructions.aspectRatio});n.crop.aspectRatio=r||null,t("EDIT_RESET")},GET_DATA:function(n){var r=n.success,o=n.failure,i=n.file,a=n.data;t("REQUEST_PREPARE_OUTPUT",{file:isBoolean(i)?i:e("GET_OUTPUT_FILE"),data:isBoolean(a)?a:e("GET_OUTPUT_DATA"),success:r,failure:o})},REQUEST_PREPARE_OUTPUT:function(e){var n=e.file,r=e.data,o=e.success,i=e.failure;t("PREPARE_OUTPUT",{file:n,data:r,success:o,failure:i},!!n)},PREPARE_OUTPUT:function(r){var o=r.file,i=r.data,a=r.success,c=r.failure;prepareOutput({file:o,data:i},n,e).then(function(e){t("DID_PREPARE_OUTPUT"),a(e)}).catch(c)},EDIT_RESET:function(){clearCenterTimeout(),reset(n)},EDIT_CONFIRM:function(r){var o=r.ready;clearCenterTimeout(),t("CROP_ZOOM"),t("REQUEST_PREPARE_OUTPUT",{file:e("GET_OUTPUT_FILE"),data:e("GET_OUTPUT_DATA"),success:function(e){o(),n.filePromise.resolveOnConfirm&&n.filePromise.success(e),t("DID_CONFIRM",{output:e})}})},EDIT_CANCEL:function(){n.filePromise&&n.filePromise.failure(),t("DID_CANCEL")},EDIT_CLOSE:function(){clearCenterTimeout()},EDIT_DESTROY:function(){resetState(n);var e=n.queue.shift();e?t("REQUEST_LOAD_IMAGE",e):t("DID_CLOSE")},SET_OPTIONS:function(e){var n=e.options;forin(n,function(e,n){t("SET_".concat(fromCamels(e,"_").toUpperCase()),{value:n})})}}},Interaction={down:null,move:null,up:null},buildInteractionTable=function(){Interaction.down=window.PointerEvent?["pointerdown"]:["touchstart","mousedown"],Interaction.move=window.PointerEvent?["pointermove"]:["touchmove","mousemove"],Interaction.up=window.PointerEvent?["pointerup"]:["touchend","touchcancel","mouseup"]},addEvent$1=function(t,e,n){Interaction.down||buildInteractionTable(),Interaction[e].forEach(function(e){t.addEventListener(e,n)})},removeEvent$1=function(t,e,n){Interaction[e].forEach(function(e){t.removeEventListener(e,n)})},createDragger=function(t,e,n,r){var o={x:0,y:0},i={parameters:null,isMultiTouching:!1,enabled:!0},a=function(t,e){return e.apply(null,[function(t){return{x:t.pageX-o.x,y:t.pageY-o.y}}(t)].concat(i.parameters))},c=function(t){i.isMultiTouching=!1,t.preventDefault(),o.x=t.pageX,o.y=t.pageY,addEvent$1(document.documentElement,"up",u),addEvent$1(document.documentElement,"move",s),i.parameters=e()||[]},s=function(t){t.touches&&t.touches.length>1?i.isMultiTouching=!0:(t.preventDefault(),a(t,n))},u=function t(e){removeEvent$1(document.documentElement,"up",t),removeEvent$1(document.documentElement,"move",s),i.isMultiTouching?i.isMultiTouching=!1:(e.preventDefault(),a(e,n),a(e,r))};return addEvent$1(t,"down",c),{enable:function(){i.enabled||addEvent$1(t,"down",c),i.enabled=!0},disable:function(){i.enabled&&removeEvent$1(t,"down",c),i.enabled=!1},destroy:function(){removeEvent$1(document.documentElement,"up",u),removeEvent$1(document.documentElement,"move",s),removeEvent$1(t,"down",c)}}},KEY_MAP={38:"up",40:"down",37:"left",39:"right",189:"minus",187:"plus",72:"h",76:"l",81:"q",82:"r",84:"t",86:"v",90:"z",219:"left_bracket",221:"right_bracket"},createKeyboard=function(t,e,n,r,o){var i=null,a=!0,c={enabled:!0},s=function(t){var o=KEY_MAP[t.keyCode]||t.keyCode;n[o]&&(t.stopPropagation(),a&&(i=e(o),a=!1),n[o](i),r(i))},u=function(t){var e=KEY_MAP[t.keyCode]||t.keyCode;n[e]&&(t.stopPropagation(),o(i),a=!0)};return t.addEventListener("keydown",s),t.addEventListener("keyup",u),{enable:function(){c.enabled||(t.addEventListener("keydown",s),t.addEventListener("keyup",u)),c.enabled=!0},disable:function(){c.enabled&&(t.removeEventListener("keydown",s),t.removeEventListener("keyup",u)),c.enabled=!1},destroy:function(){t.removeEventListener("keydown",s),t.removeEventListener("keyup",u)}}},MAGIC=312,createDiv=function(t,e){return createView({name:t,ignoreRect:!0,create:e})},cropRotatorLine=createView({name:"crop-rotator-line",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{styles:["translateX"],animations:{translateX:"spring"}},create:function(t){for(var e=t.root,n='<svg viewBox="-90 -5 180 10" xmlns="http://www.w3.org/2000/svg">',r=0;r<=180;r+=2){var o=r*(176/180)-90+2,i=r%10==0?.5:.2;if(n+='<circle fill="currentColor" cx="'.concat(o,'" cy="').concat(0,'" r="').concat(i,'"/>'),r%10==0)n+='<text fill="currentColor" x="'.concat(o+(o<0?-2.25:0===o?-.75:-1.5),'" y="').concat(3.5,'">').concat(-90+r,"°</text>")}n+="</svg>",e.element.innerHTML=n}}),cropRotator=createView({name:"crop-rotator",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",delay:250,duration:500}},apis:["rotation","animate"]},create:function(t){var e=t.root,n=t.props;e.element.setAttribute("tabindex",0);var r=document.createElement("button");r.innerHTML="<span>".concat(e.query("GET_LABEL_BUTTON_CROP_ROTATE_CENTER"),"</span>"),r.className="doka--crop-rotator-center",r.addEventListener("click",function(){e.dispatch("CROP_IMAGE_ROTATE_CENTER")}),e.appendChild(r);var o=null;e.appendChildView(e.createChildView(createDiv("crop-rotator-line-mask",function(t){var e=t.root,n=t.props;o=e.appendChildView(e.createChildView(cropRotatorLine,{translateX:Math.round(n.rotation*MAGIC)}))}),n)),e.ref.line=o;var i=document.createElement("div");i.className="doka--crop-rotator-bar",e.appendChild(i);var a=Math.PI/4,c=0;e.ref.dragger=createDragger(i,function(){c=o.translateX/MAGIC,e.dispatch("CROP_IMAGE_ROTATE_GRAB")},function(t){var n=t.x/e.rect.element.width*(Math.PI/2),r=limit$1(c+n,-a,a);e.dispatch("CROP_IMAGE_ROTATE",{value:-r})},function(){e.dispatch("CROP_IMAGE_ROTATE_RELEASE")}),e.ref.keyboard=createKeyboard(e.element,function(){c=0},{left:function(){c+=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})},right:function(){c-=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})}},function(){},function(){})},destroy:function(t){var e=t.root;e.ref.dragger.destroy(),e.ref.keyboard.destroy()},write:createRoute({REQUEST_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.dragger.disable(),e.ref.keyboard.disable()},DID_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.dragger.enable(),e.ref.keyboard.enable()}},function(t){var e=t.root,n=t.props,r=n.animate,o=n.rotation;r||0===o||(e.ref.line.translateX=null),e.ref.line.translateX=Math.round(-o*MAGIC)})}),BitmapWorker=function(){self.onmessage=function(t){createImageBitmap(t.data.message.file).then(function(e){self.postMessage({id:t.data.id,message:e},[e])})}},transforms={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},fixImageOrientation=function(t,e,n,r){-1!==r&&t.transform.apply(t,transforms[r](e,n))},createPreviewImage=function(t,e,n,r,o){e=Math.round(e),n=Math.round(n);var i=o||document.createElement("canvas"),a=i.getContext("2d");return r>=5&&r<=8?(i.width=n,i.height=e):(i.width=e,i.height=n),a.save(),fixImageOrientation(a,e,n,r),a.drawImage(t,0,0,e,n),a.restore(),i},isBitmap=function(t){return/^image/.test(t.type)&&!/svg/.test(t.type)},canCreateImageBitmap=function(t){return"createImageBitmap"in window&&isBitmap(t)},cropImage=createView({name:"subject-image",ignoreRect:!0,ignoreRectUpdate:!0,tag:"canvas",mixins:{styles:["perspective","rotateX","rotateY","rotateZ","scaleX","scaleY"],animations:{rotateX:{type:"spring",stiffness:.25,damping:.25,mass:2.5},rotateY:{type:"spring",stiffness:.25,damping:.25,mass:2.5},scaleX:{type:"spring",stiffness:.25,damping:.75,mass:15},scaleY:{type:"spring",stiffness:.25,damping:.75,mass:15}}},write:createRoute({DID_PRESENT_IMAGE:function(t){var e=t.root;e.scaleX=1,e.scaleY=1}}),create:function(t){var e=t.root;e.rotateZ=1e-5;var n="preview"!==e.query("GET_STYLE_LAYOUT_MODE");e.scaleX=n?1.15:1,e.scaleY=n?1.15:1,e.rotateX=n?1:null,e.rotateY=n?1:null;var r=e.query("GET_FILE"),o=URL.createObjectURL(r.data);!function(){var t=function(t){var n=scaleImageSize(t,{width:e.query("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:e.query("GET_MAX_IMAGE_PREVIEW_HEIGHT")});createPreviewImage(t,n.width,n.height,r.orientation,e.element),e.dispatch("DID_PRESENT_IMAGE")},n=function(){loadImage(o).then(t)};if(canCreateImageBitmap(r.data)){var i=createWorker(BitmapWorker);i.post({file:r.data},function(e){i.terminate(),e?t(e):n()})}else n()}()}}),cropImageContainer=createView({name:"subject-image-container",tag:"div",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{apis:["flipHorizontal","flipVertical","scale"],styles:["originX","originY","translateX","translateY","scaleX","scaleY","rotateZ","opacity"],animations:{opacity:{type:"tween",delay:150,duration:750},scaleX:{type:"spring",stiffness:.5,damping:.75,mass:15},scaleY:{type:"spring",stiffness:.5,damping:.75,mass:15},translateX:"spring",translateY:"spring",originX:"spring",originY:"spring",rotateZ:{type:"spring",stiffness:.25,damping:.25,mass:2.5}}},create:function(t){var e=t.root;e.element.setAttribute("tabindex",0),e.ref.image=e.appendChildView(e.createChildView(cropImage,{rotateX:0,rotateY:0,perspective:2e3})),e.ref.dragger=createDragger(e.element,function(){e.dispatch("CROP_IMAGE_DRAG_GRAB")},function(t){e.dispatch("CROP_IMAGE_DRAG",{value:t})},function(){e.dispatch("CROP_IMAGE_DRAG_RELEASE")})},destroy:function(t){t.root.ref.dragger.destroy()},write:createRoute({REQUEST_PREPARE_OUTPUT:function(t){t.root.ref.dragger.disable()},DID_PREPARE_OUTPUT:function(t){t.root.ref.dragger.enable()}},function(t){var e=t.root,n=t.props;e.ref.image.rotateX=n.flipVertical?Math.PI:0,e.ref.image.rotateY=n.flipHorizontal?Math.PI:0})}),corners=["nw","ne","se","sw"],getOppositeCorner=function(t){return corners[(corners.indexOf(t)+2)%corners.length]},edges=["n","e","s","w"],getOppositeEdge=function(t){return edges[(edges.indexOf(t)+2)%edges.length]},autoPrecision=1===window.devicePixelRatio?function(t){return Math.round(t)}:function(t){return t},line=createView({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect-focal-line",mixins:{styles:["translateX","translateY","scaleX","scaleY","opacity"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring",opacity:"spring"}}}),createEdge=function(t){return createView({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-edge-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring"}},create:function(e){var n=e.root;n.element.classList.add("doka--crop-rect-edge"),n.element.setAttribute("tabindex",0),n.element.setAttribute("role","button"),n.ref.dragger=createDragger(n.element,function(){return n.dispatch("CROP_RECT_EDGE_DRAG_GRAB"),[t,getOppositeEdge(t)]},function(t,e,r){n.dispatch("CROP_RECT_EDGE_DRAG",{offset:t,origin:e,anchor:r})},function(){n.dispatch("CROP_RECT_EDGE_DRAG_RELEASE")}),n.ref.keyboard=createKeyboard(n.element,function(){return{x:0,y:0}},{up:function(t){t.y-=20},down:function(t){t.y+=20},left:function(t){t.x-=20},right:function(t){t.x+=20}},function(e){n.dispatch("CROP_RECT_EDGE_DRAG",{offset:e,origin:t,anchor:getOppositeEdge(t)})},function(){n.dispatch("CROP_RECT_EDGE_DRAG_RELEASE")})},REQUEST_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.dragger.disable(),e.ref.keyboard.disable()},DID_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.dragger.enable(),e.ref.keyboard.enable()},destroy:function(t){var e=t.root;e.ref.keyboard.destroy(),e.ref.dragger.destroy()}})},createCorner=function(t,e){return createView({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-corner-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:"spring",translateY:"spring",scaleX:{type:"tween",duration:350,delay:e},scaleY:{type:"tween",duration:350,delay:e},opacity:{type:"tween",duration:350,delay:e}}},create:function(e){var n=e.root;n.element.classList.add("doka--crop-rect-corner"),n.element.setAttribute("role","button"),n.element.setAttribute("tabindex",-1),n.opacity=1,n.scaleX=1,n.scaleY=1,n.ref.dragger=createDragger(n.element,function(){return n.dispatch("CROP_RECT_CORNER_DRAG_GRAB"),[t,getOppositeCorner(t)]},function(t,e,r){n.dispatch("CROP_RECT_CORNER_DRAG",{offset:t,origin:e,anchor:r})},function(){n.dispatch("CROP_RECT_CORNER_DRAG_RELEASE")})},write:createRoute({REQUEST_PREPARE_OUTPUT:function(t){t.root.ref.dragger.disable()},DID_PREPARE_OUTPUT:function(t){t.root.ref.dragger.enable()}}),destroy:function(t){t.root.ref.dragger.destroy()}})},cropRect=createView({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",delay:250,duration:500}},apis:["rectangle","draft","rotating"]},create:function(t){var e=t.root;corners.forEach(function(t,n){e.ref[t]=e.appendChildView(e.createChildView(createCorner(t,50*(corners.length-n))))}),edges.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(createEdge(t)))}),e.ref.lines=[];for(var n=0;n<10;n++)e.ref.lines.push(e.appendChildView(e.createChildView(line,{opacity:0})))},write:function(t){var e=t.root,n=t.props,r=n.rectangle,o=n.draft,i=n.rotating;if(r){var a=e.ref,c=a.n,s=a.e,u=a.s,l=a.w,f=a.nw,p=a.ne,d=a.se,h=a.sw,m=a.lines,g=r.x,y=r.y,v=r.x+r.width,E=r.y+r.height,T=E-y,R=v-g;if(transformTranslate(o,f,g,y),transformTranslate(o,p,v,y),transformTranslate(o,d,v,E),transformTranslate(o,h,g,E),transformTranslateScale(o,c,g,y,R/100,1),transformTranslateScale(o,s,v,y,1,T/100),transformTranslateScale(o,u,g,E,R/100,1),transformTranslateScale(o,l,g,y,1,T/100),i){var w=m.slice(0,5),_=1/w.length;w.forEach(function(t,e){transformTranslateScale(o,t,g,y+T*(_+e*_),R/100,.01),t.opacity=.5});var x=m.slice(5);_=1/x.length,x.forEach(function(t,e){transformTranslateScale(o,t,g+R*(_+e*_),y,.01,T/100),t.opacity=.5})}else if(o){var I=m[0],C=m[1],A=m[2],O=m[3];transformTranslateScale(o,I,g,y+.333*T,R/100,.01),transformTranslateScale(o,C,g,y+.666*T,R/100,.01),transformTranslateScale(o,A,g+.333*R,y,.01,T/100),transformTranslateScale(o,O,g+.666*R,y,.01,T/100),I.opacity=.5,C.opacity=.5,A.opacity=.5,O.opacity=.5}else m.forEach(function(t){return t.opacity=0})}}}),transformTranslateScale=function(t,e,n,r,o,i){t&&(e.translateX=null,e.translateY=null,e.scaleX=null,e.scaleY=null),e.translateX=autoPrecision(n),e.translateY=autoPrecision(r),e.scaleX=o,e.scaleY=i},transformTranslate=function(t,e,n,r){t&&(e.translateX=null,e.translateY=null),e.translateX=autoPrecision(n),e.translateY=autoPrecision(r)},panels=["top","right","bottom","left"],transformTranslateScale$1=function(t,e,n,r,o,i){t||(e.translateX=null,e.translateY=null,e.scaleX=null,e.scaleY=null),e.translateX=n,e.translateY=r,e.scaleX=o,e.scaleY=i},smokePanel=function(t){return createView({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-smoke-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring"}}})},cropSmoke=createView({ignoreRect:!0,name:"crop-smoke",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",delay:0,duration:1e3}},apis:["rectangle","container","animate"]},create:function(t){var e=t.root;panels.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(smokePanel(t)))})},write:function(t){var e=t.root,n=t.props,r=e.ref,o=r.top,i=r.right,a=r.bottom,c=r.left,s=n.rectangle,u=n.container,l=n.animate,f=e.rect.element,p=u,d=s.x,h=s.y,m=p.top,g=p.left,y=h+m,v=p.width,E=d+g,T=d+s.width,R=h+s.height,w=p.height-(R+m),_=g+f.width-(d+s.width);transformTranslateScale$1(l,o,-g-2,-m-2,(v+4)/100,(y+2)/100),transformTranslateScale$1(l,c,-g-2,h-2,(E+2)/100,(s.height+4)/100),transformTranslateScale$1(l,i,T,h-2,(_+2)/100,(s.height+4)/100),transformTranslateScale$1(l,a,-g-2,R,(v+4)/100,(w+2)/100)}}),button=createView({ignoreRect:!0,ignoreRectUpdate:!0,name:"button",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}},listeners:!0},tag:"button",create:function(t){var e=t.root,n=t.props;e.element.innerHTML="".concat(n.icon||"","<span>").concat(n.label,"</span>"),n.name&&n.name.split(" ").forEach(function(t){e.element.className+=" doka--button-".concat(t)}),e.ref.handleClick=function(t){"string"==typeof n.action?e.dispatch(n.action):n.action()},e.element.addEventListener("click",e.ref.handleClick),n.create&&n.create({root:e,props:n})},destroy:function(t){var e=t.root;e.element.removeEventListener("click",e.ref.handleClick)}}),wrapper=function(t,e){return createView({ignoreRect:!0,name:t,mixins:e,create:function(t){var e=t.root,n=t.props;n.className&&e.element.classList.add(n.className),n.controls.map(function(t){var n=e.createChildView(t.view,t);t.didCreateView&&t.didCreateView(n),e.appendChildView(n)})}})},centerZoomButton=function(t){var e=t.root,n=t.props,r=t.timestamp,o=e.query("GET_CROP",n.id,r),i=e.ref.btnZoom;if(i){var a=o.rectangle;i.translateX=a.x+.5*a.width,i.translateY=a.y+.5*a.height}},cropSubject=createView({name:"crop-subject",ignoreRect:!0,mixins:{apis:["overlay"],styles:["opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root,n=t.props;n.id,n.file;e.opacity=1,e.ref.imageView=e.appendChildView(e.createChildView(cropImageContainer,{flip:{horizontal:!1,vertical:!1},translateX:null,translateY:null,rotateZ:null,scaleX:null,scaleY:null,opacity:0})),e.ref.cropView=e.appendChildView(e.createChildView(cropRect,{opacity:0})),e.ref.overlayView=e.appendChildView(e.createChildView(cropSmoke,{opacity:0})),e.query("GET_CROP_ZOOM_TIMEOUT")||(e.ref.btnZoom=e.appendChildView(e.createChildView(wrapper("zoom-wrapper",{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:250}}}),{opacity:0,controls:[{view:button,label:e.query("GET_LABEL_BUTTON_CROP_ZOOM"),name:"zoom",icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g fill="currentColor" fill-rule="nonzero"><path d="M12.5 19a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13zm0-2a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9z"/><path d="M15.765 17.18a1 1 0 1 1 1.415-1.415l3.527 3.528a1 1 0 0 1-1.414 1.414l-3.528-3.527z"/></g></svg>',action:function(){return e.dispatch("CROP_ZOOM")}}]}))),e.ref.state={size:null},e.ref.hasTroubleAnimatingTransformOrigin="safari"in window},write:createRoute({CROP_RECT_EDGE_DRAG_RELEASE:centerZoomButton,CROP_RECT_CORNER_DRAG_RELEASE:centerZoomButton,DID_PRESENT_IMAGE:function(t){var e=t.root;e.ref.imageView.opacity=1,e.ref.cropView.opacity=1}},function(t){var e=t.root,n=t.props,r=t.actions,o=t.timestamp;if(null===e.ref.state.size){if(!e.rect.element.width)return;e.ref.state.size={width:e.rect.element.width,height:e.rect.element.height},e.dispatch("DID_RESIZE_STAGE",{size:e.ref.state.size})}else if(e.ref.state.size.width!==e.rect.element.width||e.ref.state.size.height!==e.rect.element.height){var i=e.rect.element,a=i.width,c=i.height;e.ref.state.size={width:a,height:c},e.dispatch("DID_RESIZE_STAGE",{size:e.ref.state.size})}var s=e.query("GET_CROP",n.id,o);if(s){var u=e.ref,l=u.imageView,f=u.cropView,p=u.overlayView,d=u.btnZoom,h=s.isRotating,m=s.isDraft,g=s.origin,y=s.translation,v=s.scale,E=s.rotation,T=s.rectangle,R=s.flip;if(p.opacity=.8,m&&(l.originX=null,l.originY=null,l.translateX=null,l.translateY=null,l.scaleX=null,l.scaleY=null,l.rotateZ=null),l.perspective=100,e.ref.hasTroubleAnimatingTransformOrigin)!!r.find(function(t){return"CROP_IMAGE_DRAG_RELEASE"===t.type})&&(l.originX=null,l.originY=null,l.translateX=null,l.translateY=null);var w={x:0,y:0},_=0;if(m&&s.interaction){if(s.interaction.translation){var x=s.interaction.translation.x-y.x,I=s.interaction.translation.y-y.y;w={x:100*Math.sign(x)*Math.log10(1+Math.abs(x)/100),y:100*Math.sign(I)*Math.log10(1+Math.abs(I)/100)}}if(s.interaction.scale){var C=s.interaction.scale-v;_=.25*Math.sign(C)*Math.log10(1+Math.abs(C)/.25)}}l.originX=g.x,l.originY=g.y,l.translateX=y.x+w.x,l.translateY=y.y+w.y,l.scaleX=v+_,l.scaleY=v+_,l.rotateZ=E.main+E.sub,l.flipHorizontal=R.horizontal,l.flipVertical=R.vertical,f.draft=m,f.rotating=h,f.rectangle=T;var A=e.query("GET_ROOT");p.animate=!m,p.container={left:A.left+e.rect.element.left,top:A.top+e.rect.element.top,width:A.width,height:A.height},p.rectangle=T,d&&(d.opacity=s.canRecenter&&!s.isDraft?1:0)}})}),now=function(){return performance.now()},throttle=function(t,e){var n=null,r=null;return function(){var o=arguments;if(!r)return t.apply(null,Array.from(arguments)),void(r=now());clearTimeout(n),n=setTimeout(function(){now()-r>=e&&(t.apply(null,Array.from(o)),r=now())},e-(now()-r))}},climb=function(t,e){for(;1===t.nodeType&&!e(t);)t=t.parentNode;return 1===t.nodeType?t:null},isMyTarget=function(t,e){var n=climb(e,function(t){return t.classList.contains("doka--root")});return!!n&&n.contains(t)},updateIndicators=function(t){var e=t.root,n=t.props,r=t.action.position,o=n.pivotPoint,i=e.ref,a=i.indicatorA,c=i.indicatorB,s=o.x-r.x,u=o.y-r.y,l={x:o.x+s,y:o.y+u},f={x:o.x-s,y:o.y-u};a.style.cssText="transform: translate3d(".concat(l.x,"px, ").concat(l.y,"px, 0)"),c.style.cssText="transform: translate3d(".concat(f.x,"px, ").concat(f.y,"px, 0)")},getPositionFromEvent=function(t){return{x:t.pageX,y:t.pageY}},cropResize=createView({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-resizer",mixins:{apis:["pivotPoint"]},create:function(t){var e=t.root,n=t.props;e.ref.indicatorA=document.createElement("div"),e.appendChild(e.ref.indicatorA),e.ref.indicatorB=document.createElement("div"),e.appendChild(e.ref.indicatorB);var r=e.query("GET_CROP_RESIZE_KEY_CODES"),o={origin:{x:null,y:null},position:{x:null,y:null},selecting:!1,enabled:!1,scrollY:0,offsetX:0,offsetY:0},i=now();e.ref.state=o;var a=0;e.ref.touchStart=function(t){if(isMyTarget(e.element,t.target)&&!(t.touches.length<=1)){t.preventDefault();var n=getPositionFromEvent(t.touches[0]),r=getPositionFromEvent(t.touches[1]);a=vectorDistance$1(n,r),document.addEventListener("touchmove",e.ref.touchMove),document.addEventListener("touchend",e.ref.touchEnd)}},e.ref.touchMove=function(t){t.preventDefault();var n=getPositionFromEvent(t.touches[0]),r=getPositionFromEvent(t.touches[1]),o=(vectorDistance$1(n,r)-a)/a;e.dispatch("CROP_IMAGE_RESIZE",{value:o})},e.ref.touchEnd=function(t){t.preventDefault(),document.removeEventListener("touchmove",e.ref.touchMove),document.removeEventListener("touchend",e.ref.touchEnd),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},document.addEventListener("touchstart",e.ref.touchStart);var c=performance.now(),s=0,u=1,l=throttle(function(t){var n=Math.sign(t.wheelDelta||t.deltaY),r=now(),o=r-c;c=r,(o>750||s!==n)&&(u=1,s=n),u+=.05*n,e.dispatch("CROP_IMAGE_RESIZE_MULTIPLY",{value:Math.max(.1,u)}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},100);e.ref.wheel=function(t){/doka--/.test(t.target.className)&&isMyTarget(e.element,t.target)&&(t.preventDefault(),l(t))},document.addEventListener("wheel",e.ref.wheel),e.ref.move=function(t){if(t.preventDefault(),o.position.x=t.pageX-e.ref.state.offsetX,o.position.y=t.pageY-e.ref.state.scrollY-e.ref.state.offsetY,o.enabled)if(isMyTarget(e.element,t.target)){"idle"===e.element.dataset.state&&e.dispatch("RESIZER_SHOW",{position:_objectSpread({},o.position)}),e.dispatch("RESIZER_MOVE",{position:_objectSpread({},o.position)});var r=n.pivotPoint,c=r.x-o.position.x,s=r.y-o.position.y,u={x:r.x+c,y:r.y+s},l=_objectSpread({},o.position);if(o.selecting){var f=(vectorDistance$1(u,l)-a)/a,p=performance.now();p-i>25&&(i=p,e.dispatch("CROP_IMAGE_RESIZE",{value:f}))}}else e.dispatch("RESIZER_CANCEL")},e.ref.select=function(t){if(isMyTarget(e.element,t.target)){var r=n.pivotPoint,i=r.x-o.position.x,c=r.y-o.position.y,s={x:r.x+i,y:r.y+c},u=o.position;a=vectorDistance$1(s,u),o.selecting=!0,o.origin.x=t.pageX,o.origin.y=t.pageY,e.dispatch("CROP_IMAGE_RESIZE_GRAB")}},e.ref.confirm=function(t){isMyTarget(e.element,t.target)&&(o.selecting=!1,e.dispatch("CROP_IMAGE_RESIZE_RELEASE"))},e.ref.blur=function(t){o.selecting=!1,o.enabled=!1,document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_CANCEL")},window.addEventListener("blur",e.ref.blur),document.addEventListener("mousemove",e.ref.move),e.ref.keyDown=function(t){r.includes(t.keyCode)&&o.position&&(o.enabled=!0,document.addEventListener("mousedown",e.ref.select),document.addEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_SHOW",{position:_objectSpread({},o.position)}))},e.ref.keyUp=function(t){r.includes(t.keyCode)&&(o.enabled=!1,document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_CANCEL"))},document.body.addEventListener("keydown",e.ref.keyDown),document.body.addEventListener("keyup",e.ref.keyUp)},destroy:function(t){var e=t.root;document.removeEventListener("touchmove",e.ref.touchMove),document.removeEventListener("touchend",e.ref.touchEnd),document.removeEventListener("touchstart",e.ref.touchStart),document.removeEventListener("wheel",e.ref.wheel),document.removeEventListener("mousemove",e.ref.move),document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),document.body.removeEventListener("keydown",e.ref.keyDown),document.body.removeEventListener("keyup",e.ref.keyUp),window.removeEventListener("blur",e.ref.blur)},read:function(t){var e=t.root;e.ref.state.scrollY=window.scrollY;var n=e.element.getBoundingClientRect();e.ref.state.offsetX=n.x,e.ref.state.offsetY=n.y},write:createRoute({RESIZER_SHOW:function(t){var e=t.root,n=t.props,r=t.action;e.element.dataset.state="multi-touch",updateIndicators({root:e,props:n,action:r})},RESIZER_CANCEL:function(t){t.root.element.dataset.state="idle"},RESIZER_MOVE:updateIndicators})}),group=createView({ignoreRect:!0,name:"group",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",delay:0,duration:500}}},create:function(t){var e=t.root,n=t.props;n.className&&e.element.classList.add(n.className),n.controls.map(function(t){var n=e.createChildView(t.view,t);t.didCreateView&&t.didCreateView(n),e.appendChildView(n)})}}),list=createView({ignoreRect:!0,tag:"div",name:"dropdown-list",mixins:{styles:["translateY","opacity"],apis:["selectedValue"],animations:{translateY:"spring",opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root,n=t.props;n.options.map(function(t){var r=e.createChildView(button,_objectSpread({},t,{action:function(){return e.dispatch(n.optionAction,{value:t.value})}}));return e.appendChildView(r)}),e.element.setAttribute("role","list"),e.ref.handleClick=function(){return n.action&&n.action()},e.element.addEventListener("click",e.ref.handleClick)},write:function(t){var e=t.root,n=t.props,r=(t.actions,n.options.findIndex(function(t){return t.value===n.selectedValue}));e.childViews.forEach(function(t,e){t.element.setAttribute("aria-selected",e===r)})},destroy:function(t){var e=t.root;e.element.removeEventListener("click",e.ref.handleClick)}}),dropdown=createView({ignoreRect:!0,tag:"div",name:"dropdown",mixins:{apis:["selectedValue"]},create:function(t){var e=t.root,n=t.props;e.ref.open=!1;var r=function(t){e.ref.open=t,e.dispatch(n.buttonAction)};e.ref.button=e.appendChildView(e.createChildView(button,_objectSpread({},n,{action:function(){r(!e.ref.open)}}))),e.ref.list=e.appendChildView(e.createChildView(list,_objectSpread({},n,{action:function(){r(!1)}}))),e.ref.handleBodyClick=function(t){e.element.contains(t.target)||r(!1)},e.element.addEventListener("focusin",function(t){t.target!==e.ref.button.element&&r(!0)}),e.element.addEventListener("focusout",function(t){e.element.contains(t.relatedTarget)||r(!1)}),document.body.addEventListener("click",e.ref.handleBodyClick)},destroy:function(t){var e=t.root;document.body.removeEventListener("click",e.ref.handleBodyClick)},write:function(t){var e=t.root,n=t.props;e.ref.list.opacity=e.ref.open?1:0,e.ref.list.translateY=e.ref.open?0:-5,e.ref.list.selectedValue=n.selectedValue}}),updateAspectRatioIcon=function(t,e){var n=t.element.querySelectorAll(".doka--icon-aspect-ratio rect");if(n.length){if(!e)return n[0].style.opacity=.2,n[1].style.opacity=.3,void(n[2].style.opacity=.4);n[0].style.opacity=e>1?1:.3,n[1].style.opacity=1===e?.85:.5,n[2].style.opacity=e<1?1:.3}},updateTurnIcons=function(t,e){Array.from(t.element.querySelectorAll(".doka--icon-turn rect")).forEach(function(t){e>1&&(t.setAttribute("x",t.previousElementSibling?5:4),t.setAttribute("width",9)),e<1&&(t.setAttribute("y",11),t.setAttribute("height",10))})},createRectangle=function(t){var e,n;t>1?(n=14,e=Math.round(n/t)):(e=14,n=Math.round(e*t));var r=Math.round(.5*(23-e)),o=Math.round(.5*(23-n));return'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g  fill="currentColor"><rect x="'.concat(r,'" y="').concat(o,'" width="').concat(e,'" height="').concat(n,'" rx="2.5"/></g></svg>')},cropRoot=createView({name:"crop",ignoreRect:!0,create:function(t){var e=t.root,n=t.props,r=[{view:button,label:e.query("GET_LABEL_BUTTON_CROP_ROTATE_LEFT"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g transform="translate(3 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><rect y="9" width="12" height="12" rx="1"/><path d="M9.823 5H11a5 5 0 0 1 5 5 1 1 0 0 0 2 0 7 7 0 0 0-7-7H9.626l.747-.747A1 1 0 0 0 8.958.84L6.603 3.194a1 1 0 0 0 0 1.415l2.355 2.355a1 1 0 0 0 1.415-1.414L9.823 5z" fill-rule="nonzero" /></g></svg>',action:function(){return e.dispatch("CROP_IMAGE_ROTATE_LEFT")}},{view:button,label:e.query("GET_LABEL_BUTTON_CROP_FLIP_HORIZONTAL"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g fill="currentColor" fill-rule="evenodd" class="doka--icon-flip-horizontal"><path d="M11.93 7.007V20a1 1 0 0 1-1 1H5.78a1 1 0 0 1-.93-1.368l5.15-12.993a1 1 0 0 1 1.929.368z"/><path d="M14 7.007V20a1 1 0 0 0 1 1h5.149a1 1 0 0 0 .93-1.368l-5.15-12.993A1 1 0 0 0 14 7.007z" opacity=".6"/></g></svg>',action:function(){return e.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")}},{view:button,label:e.query("GET_LABEL_BUTTON_CROP_FLIP_VERTICAL"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="doka--icon-flip-vertical"><g fill="currentColor" fill-rule="evenodd"><path d="M19.993 12.143H7a1 1 0 0 1-1-1V5.994a1 1 0 0 1 1.368-.93l12.993 5.15a1 1 0 0 1-.368 1.93z"/><path d="M19.993 14a1 1 0 0 1 .368 1.93L7.368 21.078A1 1 0 0 1 6 20.148V15a1 1 0 0 1 1-1h12.993z" opacity=".6"/></g></svg>',action:function(){return e.dispatch("CROP_IMAGE_FLIP_VERTICAL")}}],o=e.query("GET_CROP_ASPECT_RATIO_OPTIONS");o&&r.push({view:dropdown,label:e.query("GET_LABEL_BUTTON_CROP_ASPECT_RATIO"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="doka--icon-aspect-ratio"><g fill="currentColor" fill-rule="evenodd"><rect x="2" y="4" opacity=".3" width="10" height="18" rx="1"/><rect opacity=".5" x="4" y="8" width="14" height="14" rx="1"/><rect x="6" y="12" width="17" height="10" rx="1"/></g></svg>',buttonAction:"TOGGLE_ASPECT_RATIO",optionAction:"CROP_SET_ASPECT_RATIO",options:o.map(function(t){return _objectSpread({},t,{icon:createRectangle(t.value)})}),didCreateView:function(t){e.ref.aspectRatioDropdown=t}}),e.query("GET_CROP_ALLOW_IMAGE_TURN_RIGHT")&&r.splice(1,0,{view:button,label:e.query("GET_LABEL_BUTTON_CROP_ROTATE_RIGHT"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g transform="translate(5 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><path d="M8.177 5H7a5 5 0 0 0-5 5 1 1 0 0 1-2 0 7 7 0 0 1 7-7h1.374l-.747-.747A1 1 0 0 1 9.042.84l2.355 2.355a1 1 0 0 1 0 1.415L9.042 6.964A1 1 0 0 1 7.627 5.55l.55-.55z" fill-rule="nonzero"/><rect x="6" y="9" width="12" height="12" rx="1"/></g></svg>',action:function(){return e.dispatch("CROP_IMAGE_ROTATE_RIGHT")}}),e.ref.menu=e.appendChildView(e.createChildView(group,{className:"doka--toolbar",opacity:0,controls:r})),e.menuItemsRequiredWidth=null,e.ref.subject=e.appendChildView(e.createChildView(cropSubject,_objectSpread({},n))),e.ref.rotator=e.appendChildView(e.createChildView(cropRotator,{rotation:0,opacity:0})),e.ref.resizer=e.appendChildView(e.createChildView(cropResize,{pivotPoint:{x:0,y:0}}));var i=0,a=0;e.ref.keyboard=createKeyboard(e.element,function(){return i=0,a=0,{x:0,y:0}},{up:function(t){t.y-=20},down:function(t){t.y+=20},left:function(t){t.x-=20},right:function(t){t.x+=20},plus:function(){i+=.1,e.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:i}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},minus:function(){i-=.1,e.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:i}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},left_bracket:function(){a-=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:a})},right_bracket:function(){a+=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:a})},h:function(){e.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")},l:function(){e.dispatch("CROP_IMAGE_ROTATE_LEFT")},q:function(){e.dispatch("CROP_RESET")},r:function(){e.dispatch("CROP_IMAGE_ROTATE_RIGHT")},v:function(){e.dispatch("CROP_IMAGE_FLIP_VERTICAL")},z:function(){e.dispatch("CROP_ZOOM")}},function(t){t&&e.dispatch("CROP_IMAGE_DRAG",{value:t})},function(t){t&&e.dispatch("CROP_IMAGE_DRAG_RELEASE")})},read:function(t){var e=t.root;if(null===e.menuItemsRequiredWidth){var n=e.ref.menu.childViews.reduce(function(t,e){return t+e.rect.outer.width},0);e.menuItemsRequiredWidth=0===n?null:n}},write:createRoute({REQUEST_PREPARE_OUTPUT:function(t){var e=t.root.ref,n=e.menu,r=e.rotator;n.opacity=0,r.opacity=0},DID_PREPARE_OUTPUT:function(t){var e=t.root.ref,n=e.menu,r=e.rotator;n.opacity=1,r.opacity=1},TOGGLE_ASPECT_RATIO:function(t){var e=t.root;updateAspectRatioIcon(e,e.query("GET_CROP_ASPECT_RATIO")),e.ref.aspectRatioDropdown&&(e.ref.aspectRatioDropdown.selectedValue=e.query("GET_CROP_ASPECT_RATIO"))},DID_LOAD_IMAGE:function(t){var e=t.root,n=e.query("GET_IMAGE").aspectRatio;updateAspectRatioIcon(e,e.query("GET_CROP_ASPECT_RATIO")),e.ref.aspectRatioDropdown&&(e.ref.aspectRatioDropdown.selectedValue=e.query("GET_CROP_ASPECT_RATIO")),1!==n&&updateTurnIcons(e,n)},DID_PRESENT_IMAGE:function(t){var e=t.root.ref,n=e.menu,r=e.rotator;n.opacity=1,r.opacity=1}},function(t){var e=t.root,n=t.props,r=t.timestamp,o=e.query("GET_CROP",n.id,r);if(o){var i=e.ref,a=i.resizer,c=i.subject,s=i.rotator,u=i.menu;a.pivotPoint={x:.5*a.rect.element.width,y:.5*a.rect.element.height},c.overlay=_objectSpread({},e.rect),s.animate=!o.isDraft,s.rotation=o.rotation.sub,u.element.dataset.layout=e.menuItemsRequiredWidth>e.ref.menu.rect.element.width?"compact":"spacious"}})}),editContent=createView({name:"content",ignoreRect:!0,create:function(t){t.root.ref.view=null},write:createRoute({DID_LOAD_IMAGE:function(t){var e=t.root,n=t.props;e.ref.view=e.appendChildView(e.createChildView(cropRoot,_objectSpread({},n)))}})}),textNode=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return createView({ignoreRect:!0,tag:t,create:function(t){t.root.element.textContent=e}})},addBusyIndicator=function(t,e){return t.appendChildView(t.createChildView(wrapper("processing-indicator",{styles:["opacity","translateY"],animations:{opacity:{type:"tween",duration:500},translateY:{type:"spring",mass:20}}}),{translateY:20,opacity:0,controls:[{view:textNode("p",e)}]}))},editContainer=createView({name:"container",create:function(t){var e,n=t.root,r=t.props,o=[(e={view:button,didCreateView:function(t){n.ref.btnReset=t},opacity:0,label:n.query("GET_LABEL_BUTTON_RESET")},_defineProperty(e,"didCreateView",function(t){return n.ref.btnReset=t}),_defineProperty(e,"name","menu menu-align-left menu-icon"),_defineProperty(e,"icon",'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g fill="currentColor" fill-rule="nonzero"><path d="M6.036 13.418L4.49 11.872A.938.938 0 1 0 3.163 13.2l2.21 2.209a.938.938 0 0 0 1.326 0l2.209-2.21a.938.938 0 0 0-1.327-1.326l-1.545 1.546zM12 10.216a1 1 0 0 1 2 0V13a1 1 0 0 1-2 0v-2.784z"/><path d="M15.707 14.293a1 1 0 0 1-1.414 1.414l-2-2a1 1 0 0 1 1.414-1.414l2 2z"/><path d="M8.084 19.312a1 1 0 0 1 1.23-1.577 6 6 0 1 0-2.185-3.488 1 1 0 0 1-1.956.412 8 8 0 1 1 2.912 4.653z"/></g></svg>'),_defineProperty(e,"action",function(){return n.dispatch("EDIT_RESET")}),e)];n.query("GET_ALLOW_BUTTON_CLOSE")&&o.unshift({view:button,label:n.query("GET_LABEL_BUTTON_CLOSE"),name:"menu",opacity:0,didCreateView:function(t){n.ref.btnCancel=t},action:function(){n.dispatch("EDIT_CANCEL"),n.dispatch("EDIT_CLOSE")}}),n.query("GET_ALLOW_BUTTON_CONFIRM")&&o.push({view:button,label:n.query("GET_LABEL_BUTTON_CONFIRM"),name:"menu menu-cta",opacity:0,didCreateView:function(t){n.ref.btnConfirm=t},action:function(){n.dispatch("EDIT_CONFIRM",{ready:function(){n.dispatch("EDIT_CLOSE")}})}}),n.ref.menu=n.appendChildView(n.createChildView(group,{className:"doka--menu",controls:o})),1===o.length&&n.ref.menu.element.classList.add("doka--menu-collapsed"),n.ref.content=n.appendChildView(n.createChildView(editContent,_objectSpread({},r))),n.ref.busyIndicators=[]},write:createRoute({AWAITING_IMAGE:function(t){var e=t.root;if(!e.rect.element.hidden){var n=addBusyIndicator(e,e.query("GET_LABEL_STATUS_AWAITING_IMAGE"));e.ref.busyIndicators.push(n),n.translateY=0,n.opacity=1}},DID_LOAD_IMAGE_ERROR:function(t){var e=t.root,n=addBusyIndicator(e,e.query("GET_LABEL_STATUS_LOAD_IMAGE_ERROR"));e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.busyIndicators.push(n),n.translateY=0,n.opacity=1},DID_REQUEST_LOAD_IMAGE:function(t){var e=t.root,n=addBusyIndicator(e,e.query("GET_LABEL_STATUS_LOADING_IMAGE"));e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.busyIndicators.push(n),n.translateY=0,n.opacity=1},REQUEST_PREPARE_OUTPUT:function(t){var e=t.root,n=addBusyIndicator(e,e.query("GET_LABEL_STATUS_PROCESSING_IMAGE"));e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.busyIndicators.push(n),n.translateY=0,n.opacity=1,e.ref.menu.opacity=0},DID_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.menu.opacity=1},DID_PRESENT_IMAGE:function(t){var e=t.root;e.ref.busyIndicators.forEach(function(t){t.opacity=0});var n=e.ref,r=n.btnConfirm,o=n.btnCancel;r&&(r.opacity=1),o&&(o.opacity=1)}},function(t){var e=t.root,n=t.props,r=t.timestamp,o=e.query("GET_CROP",n.id,r);o&&(e.ref.btnReset.opacity=o.canReset?1:0)})}),prevent=function(t){return t.preventDefault()},editor=createView({name:"editor",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}},apis:["markedForRemoval"]},create:function(t){var e=t.root,n=t.props;n.markedForRemoval=!1,e.element.addEventListener("touchmove",prevent,{passive:!1}),e.element.addEventListener("gesturestart",prevent),e.appendChildView(e.createChildView(editContainer,_objectSpread({},n)))},destroy:function(t){var e=t.root;e.element.removeEventListener("touchmove",prevent,!0),e.element.removeEventListener("gesturestart",prevent)}}),createTouchDetector=function(){var t=_objectSpread({},on());return window.addEventListener("touchstart",function e(){t.fire("touch-detected"),window.removeEventListener("touchstart",e,!1)},!1),t},createFileCatcher=function(t){var e=_objectSpread({},on(),{destroy:function(){t.removeEventListener("dragover",n),t.removeEventListener("drop",r)}}),n=function(t){return t.preventDefault()},r=function(t){t.preventDefault();var n=Array.from(t.dataTransfer.items||t.dataTransfer.files).map(function(t){return t.getAsFile&&"file"===t.kind?t.getAsFile():t});e.fire("drop",n)};return t.addEventListener("dragover",n),t.addEventListener("drop",r),e},root=createView({name:"root",ignoreRect:!0,mixins:{apis:["fullscreen"],styles:["opacity"],animations:{opacity:{type:"tween",duration:350}}},create:function(t){var e=t.root,n=t.props;if(e.element.id=e.query("GET_ID")||"doka-".concat(n.id),e.ref.environment=[],e.query("GET_ALLOW_DROP_FILES")&&(e.ref.catcher=createFileCatcher(e.element),e.ref.catcher.on("drop",function(t){t.forEach(function(t){e.dispatch("REQUEST_LOAD_IMAGE",{source:t})})})),e.ref.touchDetector=createTouchDetector(),e.ref.touchDetector.onOnce("touch-detected",function(){e.ref.environment.push("touch")}),e.query("GET_STYLES").filter(function(t){return!isEmpty(t.value)}).map(function(t){var n=t.name,r=t.value;e.element.dataset[n]=r}),n.fullscreen){var r=["fullscreen"],o=e.query("GET_STYLE_LAYOUT_MODE");"modal"===o&&r.push(o);var i=r.join(" ");e.dispatch("SET_STYLE_LAYOUT_MODE",{value:i}),e.element.dataset.styleLayoutMode=i,e.element.setAttribute("tabindex",-1),e.ref.initialScreenMeasureHeight=null,e.ref.fullscreenDetector=function(t){return e.element.dataset.styleFullscreen=window.innerHeight===e.ref.initialScreenMeasureHeight},e.ref.focusTrap=function(t){if(9===t.keyCode){var n=Array.from(e.element.querySelectorAll("button,[tabindex]")).filter(function(t){return"hidden"!==t.style.visibility}),r=n[0],o=n[n.length-1];t.shiftKey?document.activeElement===r&&(o.focus(),t.preventDefault()):document.activeElement===o&&(r.focus(),t.preventDefault())}},e.ref.escapeListener=function(t){27===t.keyCode&&(e.dispatch("EDIT_CANCEL"),e.dispatch("EDIT_CLOSE"))};var a=document.createDocumentFragment();a.appendChild(e.element);var c=document.createElement("div");c.style.cssText="position:fixed;height:100vh;top:0;",a.appendChild(c),e.ref.measure=c,document.body.appendChild(a)}e.ref.updateViewport=function(){e.dispatch("UPDATE_VIEWPORT")},window.addEventListener("resize",e.ref.updateViewport),e.ref.editor=e.appendChildView(e.createChildView(editor,{opacity:"preview"===e.query("GET_STYLE_LAYOUT_MODE")||n.fullscreen?0:1,id:n.id})),n.fullscreen||e.dispatch("EDIT_OPEN"),e.element.dataset.styleViewport=getViewportBySize(e.rect.element.width,e.rect.element.height)+" "+e.ref.environment.join(" ")},read:function(t){var e=t.root,n=e.ref.measure;n&&(e.ref.initialScreenMeasureHeight=n.offsetHeight,n.parentNode.removeChild(n),e.ref.measure=null)},destroy:function(t){var e=t.root;window.removeEventListener("resize",e.ref.updateViewport),window.removeEventListener("scroll",e.ref.updateViewport),e.ref.catcher&&e.ref.catcher.destroy()},write:createRoute({DID_SET_STYLE_LAYOUT_MODE:function(t){var e=t.root,n=t.action;e.element.dataset.styleLayoutMode=n.value},UPDATE_VIEWPORT:function(t){var e=t.root;t.props;e.dispatch("DID_UPDATE_VIEWPORT",{rect:{left:e.ref.editor.rect.element.left,top:e.ref.editor.rect.element.top,width:e.rect.element.width,height:e.rect.element.height}})},DID_REQUEST_LOAD_IMAGE:function(t){var e=t.root,n=t.props,r=e.element;e.ref.editor||(e.ref.editor=e.appendChildView(e.createChildView(editor,{opacity:0}))),e.ref.editor.opacity=1,n.fullscreen&&r.parentNode&&(document.body.classList.add("doka--parent"),r.dataset.styleFullscreen=window.innerHeight===e.ref.initialScreenMeasureHeight,window.addEventListener("resize",e.ref.fullscreenDetector),r.addEventListener("keydown",e.ref.focusTrap),r.addEventListener("keydown",e.ref.escapeListener),e.opacity=1,r.focus())},EDIT_CLOSE:function(t){var e=t.root,n=t.props,r=e.element,o=e.ref.editor;o.markedForRemoval=!0,e.query("HAS_EMPTY_QUEUE")?(n.fullscreen&&(window.removeEventListener("resize",e.ref.fullscreenDetector),r.removeEventListener("keydown",e.ref.focusTrap),r.removeEventListener("keydown",e.ref.escapeListener)),(n.fullscreen||"preview"===e.query("GET_STYLE_LAYOUT_MODE"))&&(e.opacity=0)):o.opacity=0}},function(t){var e=t.root;e.element.dataset.styleViewport=getViewportBySize(e.rect.element.width,e.rect.element.height)+" "+e.ref.environment.join(" "),e.query("GET_ROOT")||e.dispatch("UPDATE_VIEWPORT")}),didWriteView:function(t){var e=t.root,n=e.ref.editor;n&&n.markedForRemoval&&(0===e.opacity||0===n.opacity)&&(n._destroy(),e.removeChildView(n),e.ref.editor=null,e.dispatch("EDIT_DESTROY"),document.body.classList.remove("doka--parent"))}}),getViewportBySize=function(t,e){var n="";return n+=e>t?"portrait":"landscape",(n+=t<=600?" x-cramped":t<=1e3?" x-comfortable":" x-spacious").trim()},createApp=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a||(a=root(r,{id:o,fullscreen:e.fullscreen||!1}),t.src&&r.dispatch("REQUEST_LOAD_IMAGE",{source:t.src}))},n=getOptions(),r=createStore(createInitialState(n),[queries,createOptionQueries(n)],[actions,createOptionActions(n)]);r.dispatch("SET_OPTIONS",{options:t});var o=getUniqueId(),i=null,a=null,c=!1,s={_read:function(){a&&!c&&a._read()},_write:function(t){if(a){var e=r.processActionQueue().filter(function(t){return!/^SET_/.test(t.type)});c&&!e.length||(f(e),(c=a._write(t,e))&&r.processDispatchQueue(),e.find(function(t){return"DID_CLOSE"===t.type})&&(p.destroy(),a.element.parentNode.removeChild(a.element),a=null))}}},u=function(t){return function(e){var n={type:t};return e?(n.output=e.output,e.hasOwnProperty("error")&&(n.error=e.error?_objectSpread({},e.error):null),n):n}},l={DID_CONFIRM:u("confirm"),DID_CANCEL:u("cancel"),DID_CLOSE:u("close"),DID_DESTROY:u("destroy"),DID_INIT:u("init")},f=function(t){t.length&&t.forEach(function(t){if(l[t.type]){var e=l[t.type];(Array.isArray(e)?e:[e]).forEach(function(e){setTimeout(function(){!function(t){var e=_objectSpread({doka:p},t);delete e.type,a&&a.element.dispatchEvent(new CustomEvent("Doka:".concat(t.type),{detail:e,bubbles:!0,cancelable:!0,composed:!0}));var n=[];t.hasOwnProperty("error")&&n.push(t.error);var o=["type","error"];Object.keys(t).filter(function(t){return!o.includes(t)}).forEach(function(e){return n.push(t[e])}),p.fire.apply(p,[t.type].concat(n));var i=r.query("GET_ON".concat(t.type.toUpperCase()));i&&i.apply(void 0,n)}(e(t.data))},0)})}})},p=_objectSpread({},on(),s,createOptionAPI(r,n),{setOptions:function(t){return r.dispatch("SET_OPTIONS",{options:t})},setData:function(t){r.dispatch("SET_DATA",t)},getData:function(t){return new Promise(function(e,n){r.dispatch("GET_DATA",_objectSpread({},t,{success:e,failure:n}))})},open:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(o,i){e({fullscreen:!0}),t&&r.dispatch("REQUEST_LOAD_IMAGE",{source:t,options:n,success:o,failure:i,resolveOnConfirm:n.resolveOnConfirm||!1})})},edit:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p.open(t,_objectSpread({},e,{resolveOnConfirm:!0}))},clear:function(){return r.dispatch("REMOVE_IMAGE")},close:function(){return r.dispatch("EDIT_CLOSE")},destroy:function(){a&&(p.fire("destroy",a.element),a._destroy()),r.dispatch("DID_DESTROY")},insertBefore:function(t){e(),insertBefore(a.element,t)},insertAfter:function(t){e(),insertAfter(a.element,t)},appendTo:function(t){e(),t.appendChild(a.element)},replaceElement:function(t){e(),insertBefore(a.element,t),t.parentNode.removeChild(t),i=t},restoreElement:function(){i&&(insertAfter(i,a.element),a.element.parentNode.removeChild(a.element),i=null)},isAttachedTo:function(t){return!!a&&(a.element===t||i===t)},element:{get:function(){return a?a.element:null}}});return r.dispatch("DID_INIT"),createObject(p)},createAppObject=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};forin(getOptions(),function(t,n){e[t]=n[0]});var n=createApp(_objectSpread({},e,t));return n.src&&setTimeout(function(){n.open()},0),n},toCamels=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.replace(new RegExp("".concat(e,"."),"g"),function(t){return t.charAt(1).toUpperCase()})},lowerCaseFirstLetter=function(t){return t.charAt(0).toLowerCase()+t.slice(1)},isObject=function(t){return"object"===_typeof(t)&&null!==t},attributeNameToPropertyName=function(t){return toCamels(t.replace(/^data-/,""))},mapObject=function t(e,n){forin(n,function(n,r){forin(e,function(t,o){var i=new RegExp(n);if(i.test(t)&&(delete e[t],!1!==r))if(isString(r))e[r]=o;else{var a=r.group;isObject(r)&&!e[a]&&(e[a]={}),e[a][lowerCaseFirstLetter(t.replace(i,""))]=o}}),r.mapping&&t(e[r.group],r.mapping)})},getAttributesAsObject=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];forin(t.attributes,function(e){return n.push(t.attributes[e])});var r=n.filter(function(t){return t.name}).reduce(function(e,n){var r=attr(t,n.name);return e[attributeNameToPropertyName(n.name)]=r===n.name||r,e},{});return mapObject(r,e),r},filters=[],applyFilters=function(t,e,n){return filters.filter(function(e){return e.key===t}).map(function(t){return t.cb(e,n)})},createAppAtElement=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={"^class$":"className"};applyFilters("SET_ATTRIBUTE_TO_OPTION_MAP",n);var r=_objectSpread({},e),o=getAttributesAsObject(t,n);Object.keys(o).forEach(function(t){isObject(o[t])?(isObject(r[t])||(r[t]={}),Object.assign(r[t],o[t])):r[t]=o[t]}),"CANVAS"!==t.nodeName&&"IMG"!==t.nodeName||(r.src=t.dataset.dokaSrc?t.dataset.dokaSrc:t);var i=createAppObject(r);return i.replaceElement(t),i},createApp$1=function(){return isNode(arguments.length<=0?void 0:arguments[0])?createAppAtElement.apply(void 0,arguments):createAppObject.apply(void 0,arguments)},copyObjectPropertiesToObject=function(t,e,n){Object.getOwnPropertyNames(t).filter(function(t){return!n.includes(t)}).forEach(function(n){return Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})},PRIVATE_METHODS=["fire","_read","_write"],createAppAPI=function(t){var e={};return copyObjectPropertiesToObject(t,e,PRIVATE_METHODS),e},isOperaMini=function(){return"[object OperaMini]"===Object.prototype.toString.call(window.operamini)},hasPromises=function(){return"Promise"in window},hasBlobSlice=function(){return"slice"in Blob.prototype},hasCreateObjectURL=function(){return"URL"in window&&"createObjectURL"in window.URL},hasVisibility=function(){return"visibilityState"in document},hasTiming=function(){return"performance"in window},isBrowser=function(){return"undefined"!=typeof window&&void 0!==window.document},supported=function(){var t=isBrowser()&&!isOperaMini()&&hasVisibility()&&hasPromises()&&hasBlobSlice()&&hasCreateObjectURL()&&hasTiming();return function(){return t}}(),state={apps:[]},name="doka",fn=function(){},OptionTypes={},create=fn,destroy=fn,parse=fn,find=fn,getOptions$1=fn,setOptions$1=fn;if(supported()){createPainter(function(){state.apps.forEach(function(t){return t._read()})},function(t){state.apps.forEach(function(e){return e._write(t)})});var dispatch=function t(){document.dispatchEvent(new CustomEvent("doka:loaded",{detail:{supported:supported,create:create,destroy:destroy,parse:parse,find:find,setOptions:setOptions$1}})),document.removeEventListener("DOMContentLoaded",t)};"loading"!==document.readyState?setTimeout(function(){return dispatch()},0):document.addEventListener("DOMContentLoaded",dispatch);var updateOptionTypes=function(){return forin(getOptions(),function(t,e){OptionTypes[t]=e[1]})};OptionTypes={},updateOptionTypes(),create=function(){var t=createApp$1.apply(void 0,arguments);return t.on("destroy",destroy),state.apps.push(t),createAppAPI(t)},destroy=function(t){var e=state.apps.findIndex(function(e){return e.isAttachedTo(t)});return e>=0&&(state.apps.splice(e,1)[0].restoreElement(),!0)},parse=function(t){return Array.from(t.querySelectorAll(".".concat(name))).filter(function(t){return!state.apps.find(function(e){return e.isAttachedTo(t)})}).map(function(t){return create(t)})},find=function(t){var e=state.apps.find(function(e){return e.isAttachedTo(t)});return e?createAppAPI(e):null},getOptions$1=function(){var t={};return forin(getOptions(),function(e,n){t[e]=n[0]}),t},setOptions$1=function(t){return isObject(t)&&(state.apps.forEach(function(e){e.setOptions(t)}),setOptions(t)),getOptions$1()}}export{supported,OptionTypes,create,destroy,parse,find,getOptions$1 as getOptions,setOptions$1 as setOptions};
