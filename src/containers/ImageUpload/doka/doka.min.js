/* eslint-disable */

/*!
 * Doka 2.1.1
 * Copyright 2018 PQINA Inc - All Rights Reserved
 * Please visit https://pqina.nl/doka for further information
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Doka=e():t.Doka=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r=function(t,e){return e.parentNode.insertBefore(t,e)},o=function(t,e){return e.parentNode.insertBefore(t,e.nextSibling)};function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){a(t,e,n[e])})}return t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(t,e,n){"function"!=typeof n?Object.defineProperty(t,e,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){c(t,e,n[e])})}return t}({},n)):t[e]=n},l=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])},f=function(t){var e={};return l(t,function(n){u(e,n,t[n])}),e},s=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===n)return t.getAttribute(e)||t.hasAttribute(e);t.setAttribute(e,n)};function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var d=["svg","path"],h=function(t){return d.includes(t)};function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){m(t,e,n[e])})}return t}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var g=function(t,e,n,r){var o=n[0]||t.left,i=n[1]||t.top,a=o+t.width,c=i+t.height*(r[1]||1),u={element:y({},t),inner:{left:t.left,top:t.top,right:t.right,bottom:t.bottom},outer:{left:o,top:i,right:a,bottom:c}};return e.filter(function(t){return!t.isRectIgnored()}).map(function(t){return t.rect}).forEach(function(t){v(u.inner,y({},t.inner)),v(u.outer,y({},t.outer))}),E(u.inner),u.outer.bottom+=u.element.marginBottom,u.outer.right+=u.element.marginRight,E(u.outer),u},v=function(t,e){e.top+=t.top,e.right+=t.left,e.bottom+=t.top,e.left+=t.left,e.bottom>t.bottom&&(t.bottom=e.bottom),e.right>t.right&&(t.right=e.right)},E=function(t){t.width=t.right-t.left,t.height=t.bottom-t.top},w=function(t){return"number"==typeof t},b=function(t){return t<.5?2*t*t:(4-2*t)*t-1};function _(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var x={spring:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.stiffness,n=void 0===e?.5:e,r=t.damping,o=void 0===r?.75:r,i=t.mass,a=void 0===i?10:i,c=null,u=null,l=0,s=!1,p=f({interpolate:function(){if(!s){if(!w(c)||!w(u))return s=!0,void(l=0);!function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001;return Math.abs(t-e)<r&&Math.abs(n)<r}(u+=l+=-(u-c)*n/a,c,l*=o)?p.onupdate(u):(u=c,l=0,s=!0,p.onupdate(u),p.oncomplete(u))}},target:{set:function(t){if(w(t)&&!w(u)&&(u=t),null===c&&(c=t,u=t),u===(c=t)||void 0===c)return s=!0,l=0,p.onupdate(u),void p.oncomplete(u);s=!1},get:function(){return c}},resting:{get:function(){return s}},onupdate:function(t){},oncomplete:function(t){}});return p},tween:function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.duration,o=void 0===r?500:r,i=n.easing,a=void 0===i?b:i,c=n.delay,u=void 0===c?0:c,l=null,s=!0,p=!1,d=null,h=f({interpolate:function(n){s||null===d||(null===l&&(l=n),n-l<u||((t=n-l-u)<o?(e=t/o,h.onupdate((t>=0?a(p?1-e:e):0)*d)):(t=1,e=p?0:1,h.onupdate(e*d),h.oncomplete(e*d),s=!0)))},target:{get:function(){return p?0:d},set:function(t){if(null===d)return d=t,h.onupdate(t),void h.oncomplete(t);t<d?(d=1,p=!0):(p=!1,d=t),s=!1,l=null}},resting:{get:function(){return s}},onupdate:function(t){},oncomplete:function(t){}});return h}},R=function(t,e,n){var r=t[e]&&"object"===O(t[e][n])?t[e][n]:t[e]||t,o="string"==typeof r?r:r.type,i="object"===O(r)?function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){_(t,e,n[e])})}return t}({},r):{};return x[o]?x[o](i):null};function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var P=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(e=Array.isArray(e)?e:[e]).forEach(function(e){t.forEach(function(t){var o=t,i=function(){return n[t]},a=function(e){return n[t]=e};"object"===T(t)&&(o=t.key,i=t.getter||i,a=t.setter||a),e[o]&&!r||(e[o]={get:i,set:a})})})},A=function(t){return null!=t};function C(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){M(t,e,n[e])})}return t}function M(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var S={opacity:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotateX:0,rotateY:0,rotateZ:0,originX:0,originY:0},L=function(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!0;for(var n in e)if(e[n]!==t[n])return!0;return!1},D=function(t,e){var n=e.opacity,r=e.perspective,o=e.translateX,i=e.translateY,a=e.scaleX,c=e.scaleY,u=e.rotateX,l=e.rotateY,f=e.rotateZ,s=e.originX,p=e.originY,d=e.width,h=e.height,y="",m="";(A(s)||A(p))&&(m+="transform-origin: ".concat(s||0,"px ").concat(p||0,"px;")),A(r)&&(y+="perspective(".concat(r,"px) ")),(A(o)||A(i))&&(y+="translate3d(".concat(o||0,"px, ").concat(i||0,"px, 0) ")),(A(a)||A(c))&&(y+="scale3d(".concat(A(a)?a:1,", ").concat(A(c)?c:1,", 1) ")),A(f)&&(y+="rotateZ(".concat(f,"rad) ")),A(u)&&(y+="rotateX(".concat(u,"rad) ")),A(l)&&(y+="rotateY(".concat(l,"rad) ")),y.length&&(m+="transform:".concat(y,";")),A(n)&&(m+="opacity:".concat(n,";"),0===n&&"BUTTON"===t.nodeName&&(m+="visibility:hidden;"),n<1&&(m+="pointer-events:none;")),A(h)&&(m+="height:".concat(h,"px;")),A(d)&&(m+="width:".concat(d,"px;"));var g=t.elementCurrentStyle||"";m.length===g.length&&m===g||(t.setAttribute("style",m),t.elementCurrentStyle=m)},G={styles:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewInternalAPI,o=t.viewExternalAPI,i=t.view,a=I({},n),c={};P(e,[r,o],n);var u=function(){return i.rect?g(i.rect,i.childViews,[n.translateX||0,n.translateY||0],[n.scaleX||0,n.scaleY||0]):null};return r.rect={get:u},o.rect={get:u},e.forEach(function(t){n[t]=void 0===a[t]?S[t]:a[t]}),{write:function(){if(L(c,n))return D(i.element,n),Object.assign(c,I({},n)),!0},destroy:function(){}}},listeners:function(t){t.mixinConfig,t.viewProps,t.viewInternalAPI;var e=t.viewExternalAPI,n=(t.viewState,t.view),r=[],o=function(t){return function(e,n){t.addEventListener(e,n)}}(n.element),i=function(t){return function(e,n){t.removeEventListener(e,n)}}(n.element);return e.on=function(t,e){r.push({type:t,fn:e}),o(t,e)},e.off=function(t,e){r.splice(r.findIndex(function(n){return n.type===t&&n.fn===e}),1),i(t,e)},{write:function(){return!0},destroy:function(){r.forEach(function(t){i(t.type,t.fn)})}}},animations:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewInternalAPI,o=t.viewExternalAPI,i=(t.viewState,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){C(t,e,n[e])})}return t}({},n)),a=[];return l(e,function(t,e){var c=R(e);c&&(c.onupdate=function(e){n[t]=e},c.target=i[t],P([{key:t,setter:function(t){c.target!==t&&(c.target=t)},getter:function(){return n[t]}}],[r,o],n,!0),a.push(c))}),{write:function(t){var e=!0;return a.forEach(function(n){n.resting||(e=!1),n.interpolate(t)}),e},destroy:function(){}}},apis:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewExternalAPI;P(e,r,n)}},U=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.layoutCalculated||(t.paddingTop=parseInt(n.paddingTop,10)||0,t.marginTop=parseInt(n.marginTop,10)||0,t.marginRight=parseInt(n.marginRight,10)||0,t.marginBottom=parseInt(n.marginBottom,10)||0,t.marginLeft=parseInt(n.marginLeft,10)||0,e.layoutCalculated=!0),t.left=e.offsetLeft||0,t.top=e.offsetTop||0,t.width=e.offsetWidth||0,t.height=e.offsetHeight||0,t.right=t.left+t.width,t.bottom=t.top+t.height,t.scrollTop=e.scrollTop,t.hidden=null===e.offsetParent&&"fixed"!==n.position,t};function j(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){k(t,e,n[e])})}return t}function k(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var V=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.tag,n=void 0===e?"div":e,r=t.name,o=void 0===r?null:r,i=t.attributes,a=void 0===i?{}:i,c=t.read,u=void 0===c?function(){}:c,d=t.write,y=void 0===d?function(){}:d,m=t.create,v=void 0===m?function(){}:m,E=t.destroy,w=void 0===E?function(){}:E,b=t.filterFrameActionsForChild,_=void 0===b?function(t,e){return e}:b,O=t.didCreateView,x=void 0===O?function(){}:O,R=t.didWriteView,T=void 0===R?function(){}:R,P=t.ignoreRect,A=void 0!==P&&P,C=t.ignoreRectUpdate,I=void 0!==C&&C,M=t.mixins,S=void 0===M?[]:M;return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"===p(e)&&(n=e,e=null);var r=h(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);return e&&(h(t)?s(r,"class",e):r.className=e),l(n,function(t,e){s(r,t,e)}),r}(n,o?"doka--".concat(o):null,a),i=window.getComputedStyle(r,null),c=U(),d=null,m=!1,E=[],b=[],O={},R={},P=[y],C=[u],M=[w],L=function(){return r},D=function(){return E.concat()},k=function(){return d||(d=g(c,E,[0,0],[1,1]))},V=function(){return r.layoutCalculated=!1},Y={element:{get:L},style:{get:function(){return i}},childViews:{get:D}},B=j({},Y,{rect:{get:k},ref:{get:function(){return O}},is:function(t){return o===t},appendChild:function(t){return function(e,n){void 0!==n&&t.children[n]?t.insertBefore(e,t.children[n]):t.appendChild(e)}}(r),createChildView:function(t){return function(e,n){return e(t,n)}}(t),linkView:function(t){return E.push(t),t},unlinkView:function(t){E.splice(E.indexOf(t),1)},appendChildView:function(t,e){return function(t,n){return void 0!==n?e.splice(n,0,t):e.push(t),t}}(0,E),removeChildView:function(t,e){return function(n){return e.splice(e.indexOf(n),1),n.element.parentNode&&t.removeChild(n.element),n}}(r,E),registerWriter:function(t){return P.push(t)},registerReader:function(t){return C.push(t)},registerDestroyer:function(t){return M.push(t)},invalidateLayout:V,dispatch:t.dispatch,query:t.query}),N={element:{get:L},childViews:{get:D},rect:{get:k},resting:{get:function(){return m}},isRectIgnored:function(){return A},invalidateLayout:V,_read:function(){d=null,E.forEach(function(t){return t._read()}),!(I&&c.width&&c.height)&&U(c,r,i);var t={root:X,props:e,rect:c};C.forEach(function(e){return e(t)})},_write:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=0===n.length;return P.forEach(function(o){!1===o({props:e,root:X,actions:n,timestamp:t})&&(r=!1)}),b.forEach(function(e){!1===e.write(t)&&(r=!1)}),E.filter(function(t){return!!t.element.parentNode}).forEach(function(e){e._write(t,_(e,n))||(r=!1)}),E.forEach(function(e,o){e.element.parentNode||(X.appendChild(e.element,o),e._read(),e._write(t,_(e,n)),r=!1)}),m=r,T({props:e,root:X,actions:n,timestamp:t}),r},_destroy:function(){b.forEach(function(t){return t.destroy()}),M.forEach(function(t){t({root:X})}),E.forEach(function(t){return t._destroy()})}},z=j({},Y,{rect:{get:function(){return c}}});Object.keys(S).sort(function(t,e){return"styles"===t?1:"styles"===e?-1:0}).forEach(function(t){var n=G[t]({mixinConfig:S[t],viewProps:e,viewState:R,viewInternalAPI:B,viewExternalAPI:N,view:f(z)});n&&b.push(n)});var X=f(B);v({root:X,props:e});var q=r.children.length;return E.forEach(function(t,e){X.appendChild(t.element,q+e)}),x(X),f(N)}},Y=function(t,e){return function(n){var r=n.root,o=n.props,i=n.actions,a=void 0===i?[]:i,c=n.timestamp;a.filter(function(e){return t[e.type]}).forEach(function(e){return t[e.type]({root:r,props:o,action:e.data,timestamp:c})}),e&&e({root:r,props:o,actions:a,timestamp:c})}},B=function(t){return Array.isArray(t)},N=function(t){return null==t},z=function(t){return t.trim()},X=function(t){return""+t},q=function(t){return"boolean"==typeof t},F=function(t){return"string"==typeof t},H=function(t){return w(t)?t:F(t)?X(t).replace(/[a-z]+/gi,""):0},Z=function(t){return parseInt(H(t),10)},W=function(t){return w(t)&&isFinite(t)&&Math.floor(t)===t},Q=function(t){if(W(t))return t;var e=X(t).trim();return/MB$/i.test(e)?(e=e.replace(/MB$i/,"").trim(),1e3*Z(e)*1e3):/KB/i.test(e)?(e=e.replace(/KB$i/,"").trim(),1e3*Z(e)):Z(e)};function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var J=function(t){return B(t)?"array":function(t){return null===t}(t)?"null":W(t)?"int":/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(t)?"bytes":K(t)},$={array:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return N(t)?[]:B(t)?t:X(t).split(e).map(z).filter(function(t){return t.length})},boolean:function(t){return q(t)?t:"true"===t},int:function(t){return"bytes"===J(t)?Q(t):Z(t)},float:function(t){return parseFloat(H(t))},bytes:Q,string:function(t){return function(t){return"function"==typeof t}(t)?t:X(t)},object:function(t){try{return JSON.parse(function(t){return t.replace(/{\s*'/g,'{"').replace(/'\s*}/g,'"}').replace(/'\s*:/g,'":').replace(/:\s*'/g,':"').replace(/,\s*'/g,',"').replace(/'\s*,/g,'",')}(t))}catch(t){return null}},function:function(t){return function(t){for(var e=self,n=t.split("."),r=null;r=n.shift();)if(!(e=e[r]))return null;return e}(t)}},tt=function(t,e,n){if(t===e)return t;var r=J(t);if(r!==n){var o=function(t,e){return $[e](t)}(t,n);if(r=J(o),null===o)throw'Trying to assign value with incorrect type to "'.concat(option,'", allowed type: "').concat(n,'"');t=o}return t},et=function(t){var e={};return l(t,function(n){var r=t[n];e[n]=function(t,e){var n=t;return{enumerable:!0,get:function(){return n},set:function(r){n=tt(r,t,e)}}}(r[0],r[1])}),f(e)},nt=function(t){t.file=null,t.rootRect=null,t.stage=null,t.image=null,t.instantUpdate=!1,t.filePromise=null,t.crop={rectangle:null,transforms:null,rotation:null,flip:null,aspectRatio:null,isRotating:!1,isDirty:!1,instructions:null,draft:{rectangle:null,transforms:null}}},rt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.split(/(?=[A-Z])/).map(function(t){return t.toLowerCase()}).join(e)},ot=function(){return Math.random().toString(36).substr(2,9)},it=function(){var t=[],e=function(e,n){!function(t,e){t.splice(e,1)}(t,t.findIndex(function(t){return t.event===e&&(t.cb===n||!n)}))};return{fire:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];t.filter(function(t){return t.event===e}).map(function(t){return t.cb}).forEach(function(t){setTimeout(function(){t.apply(void 0,r)},0)})},on:function(e,n){t.push({event:e,cb:n})},onOnce:function(n,r){t.push({event:n,cb:function(){e(n,r),r.apply(void 0,arguments)}})},off:e}},at="boolean",ct="int",ut="string",lt="array",ft="function";function st(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var pt=function(){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){st(t,e,n[e])})}return t}({},dt)},dt={id:[null,ut],className:[null,ut],src:[null,ut],maxImagePreviewWidth:[1500,ct],maxImagePreviewHeight:[1500,ct],allowButtonClose:[!0,at],allowButtonConfirm:[!0,at],allowDropFiles:[!1,at],outputData:[!1,at],outputFile:[!0,at],outputWidth:[null,ct],outputHeight:[null,ct],outputFit:["cover",ut],outputUpscale:[!0,at],outputStripImageHead:[!0,at],outputType:[null,ut],outputQuality:[null,ct],cropZoomTimeout:[null,ct],cropAllowImageTurnRight:[!1,at],cropResizeKeyCodes:[[18,91,92,93],lt],cropAspectRatio:[null,ut],cropAspectRatioOptions:[null,lt],onconfirm:[null,ft],oncancel:[null,ft],onclose:[null,ft],labelButtonReset:["Reset",ut],labelButtonClose:["Cancel",ut],labelButtonConfirm:["Done",ut],labelStatusAwaitingImage:["Waiting for image…",ut],labelStatusLoadImageError:["Error loading image…",ut],labelStatusLoadingImage:["Loading image…",ut],labelStatusProcessingImage:["Processing image…",ut],labelButtonCropZoom:["Zoom",ut],labelButtonCropRotateLeft:["Rotate left",ut],labelButtonCropRotateRight:["Rotate right",ut],labelButtonCropRotateCenter:["Center rotation",ut],labelButtonCropFlipHorizontal:["Flip horizontal",ut],labelButtonCropFlipVertical:["Flip vertical",ut],labelButtonCropAspectRatio:["Aspect ratio",ut],styleFullscreenSafeArea:[/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"bottom":"none",ut],styleLayoutMode:[null,ut]},ht=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(n,Math.max(e,t))},yt=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},mt=function(t){return{top:t.y,right:t.x+t.width,bottom:t.y+t.height,left:t.x}},gt=function(t){return yt(t.x+.5*t.width,t.y+.5*t.height)},vt=function(t,e,n,r){return{x:t,y:e,width:n,height:r}},Et=function(t){if(N(t))return t;if(/:/.test(t)){var e=t.split(":"),n=e[0];return e[1]/n}return parseFloat(t)};function wt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){bt(t,e,n[e])})}return t}function bt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _t=[],Ot=function(t){return{GET_STYLES:function(){return Object.keys(t.options).filter(function(t){return/^style/.test(t)}).map(function(e){return{name:e,value:t.options[e]}})},HAS_EMPTY_QUEUE:function(){return 0===t.queue.length},GET_FILE:function(){return t.file},GET_IMAGE:function(){return t.image},GET_STAGE:function(){return t.stage},GET_ROOT:function(){return t.root},GET_CROP_ASPECT_RATIO_OPTIONS:function(){return t.options.cropAspectRatioOptions?t.options.cropAspectRatioOptions.map(function(t){return{label:t.label,value:t.value?Et(t.value):null}}):null},GET_CROP_ASPECT_RATIO:function(){return Et(void 0===t.crop.aspectRatio?t.options.cropAspectRatio:t.crop.aspectRatio)},GET_CROP_FLIP:function(){return t.crop.flip?wt({},t.crop.flip):wt({},t.crop.instructions.flip)},GET_CROP_ROTATION:function(){return wt({},t.crop.rotation)},GET_CROP:function(e,n){var r=n+"",o=_t[e]?_t[e][r]:null;if(o)return o;_t[e]||(_t[e]=[]);var i=xt(t);return _t[e][r]=i,i}}},xt=function(t){if(!t.stage||!t.image)return null;var e=t.crop.draft.rectangle||t.crop.rectangle,n=t.crop.draft.transforms||t.crop.transforms,r=n.origin,o=n.translation,i=n.scale,a=n.interaction,c=t.crop.rotation,u=t.crop.flip,l=!(!t.crop.draft.rectangle&&!t.crop.draft.transforms),f=l||t.instantUpdate;return{canRecenter:function(t,e){if(t.height<e.height&&t.width<e.width)return!0;var n=gt(e),r=gt(t);return r.x!==n.x||r.y!==n.y}(e,t.stage),canReset:t.crop.isDirty||l,isDraft:f,isRotating:t.crop.isRotating,rectangle:e,origin:r,translation:o,scale:i,rotation:c,flip:u,interaction:a}},Rt=function(t,e){if(1165519206!==t.getUint32(e+=2,!1))return-1;var n=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,n);var r=t.getUint16(e,n);e+=2;for(var o=0;o<r;o++)if(274===t.getUint16(e+12*o,n))return t.getUint16(e+12*o+8,n)},Tt=function(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(){return e(function(t){var e=new DataView(t);if(65496!=e.getUint16(0,!1))return null;for(var n,r=e.byteLength,o=2;o<r;){if(e.getUint16(o+2,!1)<=8)return-1;if(n=e.getUint16(o,!1),o+=2,65505===n)return Rt(e,o);if(65280!=(65280&n))return null;o+=e.getUint16(o,!1)}}(r.result)||-1)},r.readAsArrayBuffer(t.slice(0,262144))})},Pt=1,At=2,Ct=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(n,Math.max(e,t))},It=function(t,e){return Lt(t.x-e.x,t.y-e.y)},Mt=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(It(t,e),It(t,e))}(t,e))},St=function(t,e,n){var r=Math.cos(e),o=Math.sin(e),i=Lt(t.x-n.x,t.y-n.y);return Lt(n.x+r*i.x-o*i.y,n.y+o*i.x+r*i.y)},Lt=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},Dt=function(t,e,n){return Yt(e*(t.x-n.x)+n.x,e*(t.y-n.y)+n.y,e*t.width,e*t.height)},Gt=function(t,e){return Yt(t.x+e.x,t.y+e.y,t.width,t.height)},Ut={translate:Gt,rotate:function(t,e,n){var r=function(t,e,n){return 0===e?{tl:t.tl,tr:t.tr,br:t.br,bl:t.bl}:{tl:St(t.tl,e,n),tr:St(t.tr,e,n),br:St(t.br,e,n),bl:St(t.bl,e,n)}}(Vt(t),e,n),o=r.tl,i=r.tr,a=r.br,c=r.bl,u=Math.min(o.x,i.x,a.x,c.x),l=Math.min(o.y,i.y,a.y,c.y),f=Math.max(o.x,i.x,a.x,c.x),s=Math.max(o.y,i.y,a.y,c.y);return Yt(u,l,f-u,s-l)},scale:Dt},jt=function(t){return{top:t.y,right:t.x+t.width,bottom:t.y+t.height,left:t.x}},kt=function(t){return Lt(t.x+.5*t.width,t.y+.5*t.height)},Vt=function(t){return{tl:{x:t.x,y:t.y},tr:{x:t.x+t.width,y:t.y},br:{x:t.x+t.width,y:t.y+t.height},bl:{x:t.x,y:t.y+t.height}}},Yt=function(t,e,n,r){return{x:t,y:e,width:n,height:r}},Bt=function(t,e){var n=t.width,r=n*e;r>t.height&&(n=(r=t.height)/e);var o=.5*(t.width-n),i=.5*(t.height-r);return Yt(o,i,n,r)},Nt=function(t,e){var n=t,r=e,o=1.5707963267948966-e,i=Math.sin(1.5707963267948966),a=Math.sin(r),c=Math.sin(o),u=Math.cos(o),l=n/i;return Lt(u*(l*a),u*(l*c))},zt=function(t,e,n,r){var o=r.x>.5?1-r.x:r.x,i=r.y>.5?1-r.y:r.y,a=2*o*t.width,c=2*i*t.height,u=function(t,e){var n=t.width,r=t.height,o=Nt(n,e),i=Nt(r,e),a=Vt(t),c=Lt(a.tl.x+Math.abs(o.x),a.tl.y-Math.abs(o.y)),u=Lt(a.tr.x+Math.abs(i.y),a.tr.y+Math.abs(i.x)),l=Lt(a.bl.x-Math.abs(i.y),a.bl.y-Math.abs(i.x));return{width:Mt(c,u),height:Mt(c,l)}}(e,n);return Math.max(u.width/a,u.height/c)},Xt=function(t,e,n){var r=t.center,o=t.zoom,i=t.aspectRatio,a=kt(e),c={x:a.x-n.width*r.x,y:a.y-n.height*r.y},u=2*Math.PI+t.rotation%(2*Math.PI),l=zt(n,Bt(e,i||n.height/n.width),u,r);return{origin:{x:r.x*n.width,y:r.y*n.height},translation:c,scale:o*l,rotation:t.rotation}};function qt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Ft(t,e,n[e])})}return t}function Ft(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ht=function(t){return{origin:qt({},t.origin),translation:qt({},t.translation),rotation:t.rotation,scale:t.scale}},Zt=function(t,e){var n=e.origin,r=e.translation;return function(t,e,n){return e.reduce(function(t,e){return(0,Ut[e[0]])(t,e[1],n)},t)}(t,[["scale",e.scale],["translate",r]],n)},Wt=function(t,e){var n=t.width,r=t.height,o=e%(Math.PI/2),i=Nt(n,o),a=Nt(r,o),c=Vt(t);return{tl:Lt(c.tl.x+Math.abs(i.x),c.tl.y-Math.abs(i.y)),tr:Lt(c.tr.x+Math.abs(a.y),c.tr.y+Math.abs(a.x)),br:Lt(c.br.x-Math.abs(i.x),c.br.y+Math.abs(i.y)),bl:Lt(c.bl.x-Math.abs(a.y),c.bl.y-Math.abs(a.x))}};function Qt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Kt(t,e,n[e])})}return t}function Kt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Jt=function(t,e,n,r){var o=n.translation,i=n.scale,a=n.rotation,c=n.origin,u={origin:Qt({},c),translation:Qt({},o),scale:i,rotation:2*Math.PI+a%(2*Math.PI)},l=t.height/t.width,f={x:c.x+o.x,y:c.y+o.y},s=Wt(e,u.rotation),p=St(s.tl,-u.rotation,f),d=St(s.tr,-u.rotation,f),h=St(s.br,-u.rotation,f),y=St(s.bl,-u.rotation,f),m={x:Math.min(p.x,d.x,h.x,y.x),y:Math.min(p.y,d.y,h.y,y.y),width:Math.max(p.x,d.x,h.x,y.x)-Math.min(p.x,d.x,h.x,y.x),height:Math.max(p.y,d.y,h.y,y.y)-Math.min(p.y,d.y,h.y,y.y)},g=Yt(m.x,m.y,m.width,m.height),v=kt(g),E=jt(g),w=Zt(t,n),b=kt(w),_={x:w.x,y:w.y},O={x:b.x,y:b.y},x=v.x,R=v.y,T={x:_.x,y:_.y,width:w.width,height:w.height};if(!function(t,e){var n=jt(t),r=jt(e);return n.left>=r.left&&n.top>=r.top&&n.bottom<=r.bottom&&n.right<=r.right}(g,w))if("moving"===r){T.y>g.y?T.y=g.y:T.y+T.height<E.bottom&&(T.y=E.bottom-T.height),T.x>g.x?T.x=g.x:T.x+T.width<E.right&&(T.x=E.right-T.width);var P=Zt(t,Qt({},n,{scale:u.scale})),A=kt(P);O.x=A.x,O.y=A.y,_.x=P.x,_.y=P.y,T.x=O.x-.5*T.width,T.y=O.y-.5*T.height,T.y>g.y?T.y=g.y:T.y+T.height<E.bottom&&(T.y=E.bottom-T.height),T.x>g.x?T.x=g.x:T.x+T.width<E.right&&(T.x=E.right-T.width);var C={x:T.x-_.x,y:T.y-_.y},I={x:C.x*Math.cos(u.rotation)-C.y*Math.sin(u.rotation),y:C.x*Math.sin(u.rotation)+C.y*Math.cos(u.rotation)};u.translation.x+=I.x,u.translation.y+=I.y}else if("resizing"===r){w.width<g.width&&(T.width=g.width,T.height=T.width*l,T.height<g.height&&(T.height=g.height,T.width=T.height/l)),w.height<g.height&&(T.height=g.height,T.width=T.height/l,T.width<g.width&&(T.width=g.width,T.height=T.width*l)),T.x=O.x-.5*T.width,T.y=O.y-.5*T.height,T.y>g.y?T.y=g.y:T.y+T.height<E.bottom&&(T.y=E.bottom-T.height),T.x>g.x?T.x=g.x:T.x+T.width<E.right&&(T.x=E.right-T.width),u.scale=zt(t,e,u.rotation,{x:(x-T.x)/T.width,y:(R-T.y)/T.height});var M=Zt(t,Qt({},n,{scale:u.scale})),S=kt(M);O.x=S.x,O.y=S.y,_.x=M.x,_.y=M.y,T.x=O.x-.5*T.width,T.y=O.y-.5*T.height,T.y>g.y?T.y=g.y:T.y+T.height<E.bottom&&(T.y=E.bottom-T.height),T.x>g.x?T.x=g.x:T.x+T.width<E.right&&(T.x=E.right-T.width);var L={x:T.x-_.x,y:T.y-_.y},D={x:L.x*Math.cos(u.rotation)-L.y*Math.sin(u.rotation),y:L.x*Math.sin(u.rotation)+L.y*Math.cos(u.rotation)};u.translation.x+=D.x,u.translation.y+=D.y}else if("rotating"===r){var G=!1;if(T.y>g.y){var U=T.y-g.y;T.y=g.y,T.height+=2*U,G=!0}if(T.y+T.height<E.bottom){var j=E.bottom-(T.y+T.height);T.y=E.bottom-T.height,T.height+=2*j,G=!0}if(T.x>g.x){var k=T.x-g.x;T.x=g.x,T.width+=2*k,G=!0}if(T.x+T.width<E.right){var V=E.right-(T.x+T.width);T.x=E.right-T.width,T.width+=2*V,G=!0}G&&(u.scale=zt(t,e,u.rotation,{x:(x-w.x)/w.width,y:(R-w.y)/w.height}))}return Qt({},u,{rotation:n.rotation})},$t={n:function(t){return{x:t.x+.5*t.width,y:t.y}},e:function(t){return{x:t.x+t.width,y:t.y+.5*t.height}},s:function(t){return{x:t.x+.5*t.width,y:t.y+t.height}},w:function(t){return{x:t.x,y:t.y+.5*t.height}}},te=function(t,e){return $t[t](e)};function ee(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ne=function(t,e,n){var r=n.origin,o=n.translation,i=(n.scale,2*Math.PI+n.rotation%(2*Math.PI)),a=Zt(t,n),c={x:r.x+o.x,y:r.y+o.y},u=Wt(e,i),l=St(u.tl,-i,c),f=St(u.tr,-i,c),s=St(u.br,-i,c),p={x:Math.min(l.x,f.x,s.x),y:Math.min(l.y,f.y,s.y),width:Math.max(l.x,f.x,s.x)-Math.min(l.x,f.x,s.x),height:Math.max(l.y,f.y,s.y)-Math.min(l.y,f.y,s.y)},d=Yt(p.x,p.y,p.width,p.height),h=jt(d),y=jt(a),m=a;if(h.top<y.top||h.right>y.right||h.bottom>y.bottom||h.left<y.left){var g=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ee(t,e,n[e])})}return t}({},y);if(h.top<=g.top){var v=g.bottom-g.top,E=g.right-g.left,w=Math.max(1,d.height/v),b=v*w,_=E*w-E;g.bottom=h.top+b,g.top=h.top,g.left-=.5*_,g.right+=.5*_}if(h.bottom>=g.bottom){var O=g.bottom-g.top,x=g.right-g.left,R=Math.max(1,d.height/O),T=O*R,P=x*R-x;g.bottom=h.bottom,g.top=h.bottom-T,g.left-=.5*P,g.right+=.5*P}if(h.left<=g.left){var A=g.bottom-g.top,C=g.right-g.left,I=Math.max(1,d.width/C),M=C*I,S=A*I-A;g.right=h.left+M,g.left=h.left,g.top-=.5*S,g.bottom+=.5*S}if(h.right>=g.right){var L=g.bottom-g.top,D=g.right-g.left,G=Math.max(1,d.width/D),U=D*G,j=L*G-L;g.right=h.right,g.left=h.right-U,g.top-=.5*j,g.bottom+=.5*j}m=Yt(g.left,g.top,g.right-g.left,g.bottom-g.top)}var k=Vt(m),V=kt(m),Y=St(k.tl,i,c),B=St(k.br,i,c),N=Y.x+.5*(B.x-Y.x),z=Y.y+.5*(B.y-Y.y),X=Gt(m,{x:N-V.x,y:z-V.y}),q=Gt(d,{x:N-V.x,y:z-V.y}),F=kt(q),H={x:X.x,y:X.y},Z=X.width,W=X.height,Q=(F.x-H.x)/Z,K=(F.y-H.y)/W,J=Z/t.width,$={x:Q*t.width,y:K*t.height},tt=1-J,et=$.x*tt,nt=$.y*tt,rt={x:H.x+Z*Q,y:H.y+W*K},ot=St(H,i,{x:H.x+.5*Z,y:H.y+.5*W}),it=St(H,i,rt),at=ot.x-it.x,ct=ot.y-it.y;return{origin:$,translation:{x:H.x-et+at,y:H.y-nt+ct},scale:J,rotation:n.rotation}},re={nw:function(t){return{x:t.x,y:t.y}},ne:function(t){return{x:t.x+t.width,y:t.y}},se:function(t){return{x:t.x+t.width,y:t.y+t.height}},sw:function(t){return{x:t.x,y:t.y+t.height}}},oe=function(t,e){return re[t](e)},ie=function(t,e,n,r){var o=function(t,e){return Lt(Ct(t.x,e.x,e.x+e.width),Ct(t.y,e.y,e.y+e.height))}({x:t.x,y:t.y},n),i=o.x-e.x,a=o.y-e.y,c=r?Math.sign(a/i)*r:null,u={start:e,end:c?{x:e.x+1e6*i,y:e.y+i*c*1e6}:{x:e.x+1e6*i,y:e.y+1e6*a}},l=function(t){return[{start:{x:-1e6,y:t.y},end:{x:1e6,y:t.y}},{start:{x:t.x+t.width,y:-1e6},end:{x:t.x+t.width,y:1e6}},{start:{x:-1e6,y:t.y+t.height},end:{x:1e6,y:t.y+t.height}},{start:{x:t.x,y:-1e6},end:{x:t.x,y:1e6}}]}(n).map(function(t){return function(t,e){var n,r,o,i,a,c={x:null,y:null,onLine1:!1,onLine2:!1};return 0==(n=(e.end.y-e.start.y)*(t.end.x-t.start.x)-(e.end.x-e.start.x)*(t.end.y-t.start.y))?c:(r=t.start.y-e.start.y,o=t.start.x-e.start.x,i=(e.end.x-e.start.x)*r-(e.end.y-e.start.y)*o,a=(t.end.x-t.start.x)*r-(t.end.y-t.start.y)*o,r=i/n,o=a/n,c.x=t.start.x+r*(t.end.x-t.start.x),c.y=t.start.y+r*(t.end.y-t.start.y),r>0&&r<=1&&(c.onLine1=!0),o>0&&o<1&&(c.onLine2=!0),c)}(u,t)}).filter(function(t){return t.onLine1&&t.onLine2}).sort(function(t,n){return Mt(t,e)<Mt(n,e)?-1:1}).shift(),f=Ct(Mt(e,o)/Mt(e,l),0,1);return Dt(function(t,e){var n=Math.min(t.x,e.x),r=Math.max(t.x,e.x),o=Math.min(t.y,e.y),i=Math.max(t.y,e.y);return Yt(n,o,r-n,i-o)}(e,l),f,e)},ae=function(t,e,n){var r=n.origin,o=n.translation,i=Zt(t,n),a={x:r.x+o.x,y:r.y+o.y},c=2*Math.PI+n.rotation%(2*Math.PI),u=Wt(e,c),l=St(u.tl,-c,a),f=St(u.tr,-c,a),s=St(u.br,-c,a),p={x:Math.min(l.x,f.x,s.x),y:Math.min(l.y,f.y,s.y),width:Math.max(l.x,f.x,s.x)-Math.min(l.x,f.x,s.x),height:Math.max(l.y,f.y,s.y)-Math.min(l.y,f.y,s.y)},d=Yt(p.x,p.y,p.width,p.height),h=kt(d),y=e.height/e.width,m={x:(h.x-i.x)/i.width,y:(h.y-i.y)/i.height},g=m.y>.5?1-m.y:m.y,v=2*(m.x>.5?1-m.x:m.x)*i.width,E=2*g*i.height;return{center:m,zoom:Math.min(v/d.width,E/d.height),rotation:n.rotation,aspectRatio:y}},ce=function(t){return parseFloat(t.toFixed(10))},ue=Math.PI/2,le=Math.PI/4,fe=function(t){return parseFloat(t.toFixed(10))},se=function(t,e){var n={width:t.width,height:t.height};if(t.width>e.width||t.height>e.height){var r=t.height/t.width,o=e.width/t.width,i=e.height/t.height;o<i?(n.width=t.width*o,n.height=n.width*r):(n.height=t.height*i,n.width=n.height/r)}return n},pe={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},de=function(t,e){return{x:t,y:e}},he=function(t,e){return de(t.x-e.x,t.y-e.y)},ye=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(he(t,e),he(t,e))}(t,e))},me=function(t,e){var n=t,r=e,o=1.5707963267948966-e,i=Math.sin(1.5707963267948966),a=Math.sin(r),c=Math.sin(o),u=Math.cos(o),l=n/i;return de(u*(l*a),u*(l*c))},ge=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:.5,y:.5},o=r.x>.5?1-r.x:r.x,i=r.y>.5?1-r.y:r.y,a=2*o*t.width,c=2*i*t.height,u=function(t,e){var n=t.width,r=t.height,o=me(n,e),i=me(r,e),a=de(t.x+Math.abs(o.x),t.y-Math.abs(o.y)),c=de(t.x+t.width+Math.abs(i.y),t.y+Math.abs(i.x)),u=de(t.x-Math.abs(i.y),t.y+t.height-Math.abs(i.x));return{width:ye(a,c),height:ye(a,u)}}(e,n);return Math.max(u.width/a,u.height/c)},ve=function(t,e){var n=t.width,r=n*e;return r>t.height&&(n=(r=t.height)/e),{x:.5*(t.width-n),y:.5*(t.height-r),width:n,height:r}},Ee=function(t){return t&&(t.horizontal||t.vertical)},we=function(t,e,n){if(!e&&!Ee(n))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;var r=document.createElement("canvas"),o=t.naturalWidth,i=t.naturalHeight,a=e>=5&&e<=8;a?(r.width=i,r.height=o):(r.width=o,r.height=i);var c=r.getContext("2d");if(e&&c.transform.apply(c,function(t,e,n){return-1===n&&(n=1),pe[n](t,e)}(o,i,e)),Ee(n)){var u=[1,0,0,1,0,0];(!a&&n.horizontal||a&n.vertical)&&(u[0]=-1,u[4]=o),(!a&&n.vertical||a&&n.horizontal)&&(u[3]=-1,u[5]=i),c.transform.apply(c,u)}return c.drawImage(t,0,0,o,i),r},be=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=we(t,e,n.flip),o={width:r.width,height:r.height},i=document.createElement("canvas"),a=n.aspectRatio||o.height/o.width,c=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=t.height/t.width,o=e,i=1,a=r;a>o&&(i=(a=o)/r);var c=Math.max(1/i,o/a),u=t.width/(n*i*c),l=u*e;return{width:Math.round(u),height:Math.round(l)}}(o,a,n.zoom);i.width=c.width,i.height=c.height;var u={x:.5*i.width,y:.5*i.height},l=u.x-o.width*(n.center?n.center.x:.5),f=u.y-o.height*(n.center?n.center.y:.5),s={x:0,y:0,width:i.width,height:i.height,center:u},p=ge(o,ve(s,a),n.rotation,n.center),d=(n.zoom||1)*p,h=i.getContext("2d");return h.translate(u.x,u.y),h.rotate(n.rotation||0),h.scale(d,d),h.drawImage(r,l-u.x,f-u.y,o.width,o.height),h.getImageData(0,0,i.width,i.height)};HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var r=this.toDataURL(e,n).split(",")[1];setTimeout(function(){for(var n=atob(r),o=n.length,i=new Uint8Array(o),a=0;a<o;a++)i[a]=n.charCodeAt(a);t(new Blob([i],{type:e||"image/png"}))})}});var _e=function(){var t={resize:function(t,e){var n=e.mode,r=e.upscale,o=e.width,i=e.height;if(!o&&!i)return t;null===o?o=i:null===i&&(i=o);if("force"!==n){var a=o/t.width,c=i/t.height,u=1;if("cover"===n?u=Math.max(a,c):"contain"===n&&(u=Math.min(a,c)),u>1&&!1===r)return t;o=t.width*u,i=t.height*u}for(var l=t.width,f=t.height,s=Math.round(o),p=Math.round(i),d=t.data,h=new Uint8ClampedArray(s*p*4),y=l/s,m=f/p,g=Math.ceil(.5*y),v=Math.ceil(.5*m),E=0;E<p;E++)for(var w=0;w<s;w++){for(var b=4*(w+E*s),_=0,O=0,x=0,R=0,T=0,P=0,A=0,C=(E+.5)*m,I=Math.floor(E*m);I<(E+1)*m;I++)for(var M=Math.abs(C-(I+.5))/v,S=(w+.5)*y,L=M*M,D=Math.floor(w*y);D<(w+1)*y;D++){var G=Math.abs(S-(D+.5))/g,U=Math.sqrt(L+G*G);if(U>=-1&&U<=1&&(_=2*U*U*U-3*U*U+1)>0){var j=d[(G=4*(D+I*l))+3];A+=_*j,x+=_,j<255&&(_=_*j/250),R+=_*d[G],T+=_*d[G+1],P+=_*d[G+2],O+=_}}h[b]=R/O,h[b+1]=T/O,h[b+2]=P/O,h[b+3]=A/x}return{data:h,width:s,height:p}}},e=function(e,n){n(function(e,n){return e.forEach(function(e){n=t[e.type](n,e.data)}),n}(e.transforms,e.imageData))};self.onmessage=function(t){e(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e.data.buffer])})}},Oe=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(e+t).slice(-e.length)},xe=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return"".concat(t.getFullYear(),"-").concat(Oe(t.getMonth()+1,"00"),"-").concat(Oe(t.getDate(),"00"),"_").concat(Oe(t.getHours(),"00"),"-").concat(Oe(t.getMinutes(),"00"),"-").concat(Oe(t.getSeconds(),"00"))},Re=function(t){var e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),r=new Worker(n);return{transfer:function(t,e){},post:function(t,e,n){var o=ot();r.onmessage=function(t){t.data.id===o&&e(t.data.message)},r.postMessage({id:o,message:t},n)},terminate:function(){r.terminate(),URL.revokeObjectURL(n)}}},Te=function(t,e){var n=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(n){var r=new n;return r.append(t),r.getBlob(e)}return new Blob([t],{type:e})},Pe=function(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=function(t){n(t)},r.src=t})},Ae=function(t,e,n){if(1165519206===t.getUint32(e+4,!1)){e+=4;var r=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,r);var o=t.getUint16(e,r);e+=2;for(var i=0;i<o;i++)if(274===t.getUint16(e+12*i,r))return t.setUint16(e+12*i+8,1,r),!0;return!1}},Ce=function(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(){return e(function(t){var e=new DataView(t);if(65496!==e.getUint16(0))return null;for(var n,r,o=2,i=!1;o<e.byteLength&&(n=e.getUint16(o,!1),r=e.getUint16(o+2,!1)+2,n>=65504&&n<=65519||65534===n)&&(i||(i=Ae(e,o)),!(o+r>e.byteLength));)o+=r;return t.slice(0,o)}(r.result)||null)},r.readAsArrayBuffer(t.slice(0,262144))})},Ie=function(t,e,n){return new Promise(function(r,o){if(!function(t){return/^image/.test(t.type)}(t))return o();var i=e.output.quality,a=null===i?null:i/100,c=e.output.type,u=e.crop,l=e.size,f=[];(l.width||l.height)&&f.push({type:"resize",data:l});var s=function(e){var n=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o="string"==typeof n?t.slice(0,t.size,n):t.slice(0,t.size,t.type);return o.lastModifiedDate=new Date,F(e)||(e=xe()),e&&null===r&&function(t){return t.split(".").pop()}(e)?o.name=e:(r=r||function(t){if("string"!=typeof t)return"";var e=t.split("/").pop();return/svg/.test(e)?"svg":/zip|compressed/.test(e)?"zip":/plain/.test(e)?"txt":/msword/.test(e)?"doc":/[a-z]+/.test(e)?"jpeg"===e?"jpg":e:""}(o.type),o.name=e+(r?"."+r:"")),o}(e,function(t,e){var n=function(t){return t.substr(0,t.lastIndexOf("."))||t}(t),r="image/jpeg"===e?"jpg":e.split("/")[1];return"".concat(n,".").concat(r)}(t.name,function(t){return"image/jpeg"===t||"image/png"===t?t:"image/jpeg"}(e.type)));r(n)},p=function(e,r){return function(t,e){return new Promise(function(n,r){var o=document.createElement("canvas");o.width=t.width,o.height=t.height,o.getContext("2d").putImageData(t,0,0),o.toBlob(n,e.type,e.quality)})}(e,r).then(function(e){if(n)return s(e);Ce(t).then(function(t){null!==t&&(e=new Blob([t,e.slice(20)],{type:e.type})),s(e)})}).catch(function(t){o(t)})};if(/svg/.test(t.type)&&null===c)(function(t,e){return new Promise(function(n,r){var o=new FileReader;o.onloadend=function(){var r=o.result,i=document.createElement("div");i.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",i.innerHTML=r;var a=i.querySelector("svg");document.body.appendChild(i);var c=a.getBBox();i.parentNode.removeChild(i);var u=i.querySelector("title"),l=a.getAttribute("viewBox")||"",f=a.getAttribute("width")||"",s=a.getAttribute("height")||"",p=parseFloat(f)||null,d=parseFloat(s)||null,h=(f.match(/[a-z]+/)||[])[0]||"",y=(s.match(/[a-z]+/)||[])[0]||"",m=l.split(" ").map(parseFloat),g=m.length?{x:m[0],y:m[1],width:m[2],height:m[3]}:c,v=null!=p?p:g.width,E=null!=d?d:g.height;a.style.overflow="visible",a.setAttribute("width",v),a.setAttribute("height",E);var w=e.aspectRatio||E/v,b=v,_=b*w,O=ge({width:v,height:E},ve({width:b,height:_},w),e.rotation,e.center),x=e.zoom*O,R=e.rotation*(180/Math.PI),T={x:.5*b,y:.5*_},P={x:T.x-v*e.center.x,y:T.y-E*e.center.y},A=["rotate(".concat(R," ").concat(T.x," ").concat(T.y,")"),"translate(".concat(T.x," ").concat(T.y,")"),"scale(".concat(x,")"),"translate(".concat(-T.x," ").concat(-T.y,")"),"translate(".concat(P.x," ").concat(P.y,")")],C=["scale(".concat(e.flip.horizontal?-1:1," ").concat(e.flip.vertical?-1:1,")"),"translate(".concat(e.flip.horizontal?-v:0," ").concat(e.flip.vertical?-E:0,")")],I='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="'.concat(b).concat(h,'" height="').concat(_).concat(y,'" \nviewBox="0 0 ').concat(b," ").concat(_,'" \npreserveAspectRatio="xMinYMin"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generator: FilePond Image Transform Plugin - https://pqina.nl/filepond --\x3e\n<title>').concat(u?u.textContent:t.name,'</title>\n<desc>Cropped with FilePond.</desc>\n<g transform="').concat(A.join(" "),'">\n<g transform="').concat(C.join(" "),'">\n').concat(a.outerHTML,"\n</g>\n</g>\n</svg>");n(I)},o.readAsText(t)})})(t,u).then(function(e){r(function(t,e){var n=t.slice(0,t.size,t.type);return n.lastModifiedDate=t.lastModifiedDate,n.name=e,n}(Te(e,"image/svg+xml"),t.name))});else{var d=URL.createObjectURL(t);Pe(d).then(function(n){URL.revokeObjectURL(d);var r=e.image.orientation,o=be(n,r,u);if(f.length){var i=Re(_e);i.post({transforms:f,imageData:o},function(e){p(function(t){var e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e}(e),{quality:a,type:c||t.type}),i.terminate()},[o.data.buffer])}else p(o,{quality:a,type:c||t.type})})}})};function Me(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Se(t,e,n[e])})}return t}function Se(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Le=Math.PI/2,De=function(t){t.crop.draft.rotateMinScale=null},Ge=function(t,e){!function(t){t.crop.draft.rotateMinScale||(t.crop.draft.rotateMinScale=t.crop.transforms.scale)}(t);var n=Me({},t.crop.transforms,{scale:t.crop.draft.rotateMinScale});t.crop.rotation=e,t.crop.draft.transforms=qe(t.image,t.crop.rectangle,n,t.crop.rotation.main+t.crop.rotation.sub)},Ue=function(t){Ne(),t.crop.rectangle=Bt(t.stage,t.crop.instructions.aspectRatio||t.image.aspectRatio),t.crop.draft.rectangle=null,t.crop.transforms=Xt(t.crop.instructions,t.stage,t.image),t.crop.draft.transforms=null,t.crop.rotation=function(t){var e=ce(le),n=ce(ue),r=t/n,o=Math.floor(r)*n,i=t-o;return i>e&&(i-=n,o+=n),{main:o,sub:i}}(t.crop.instructions.rotation),t.crop.flip=Me({},t.crop.instructions.flip),t.crop.isDirty=!1,t.crop.aspectRatio=t.crop.instructions.aspectRatio,De(t)},je=function(t){clearTimeout(Ve);var e=t.crop.draft.transforms||t.crop.transforms,n=ae(t.image,t.crop.rectangle,e);t.crop.aspectRatio&&(n.aspectRatio=t.crop.aspectRatio),t.crop.transforms=Xt(n,t.stage,t.image),t.crop.draft.transforms=null;var r=t.crop.aspectRatio||t.crop.rectangle.height/t.crop.rectangle.width;t.crop.rectangle=Bt(t.stage,r),t.crop.draft.rectangle=null,De(t)},ke=function(t){t.crop.draft.rectangle=null,t.crop.transforms=t.crop.draft.transforms,t.crop.draft.transforms=null,t.crop.transforms=Me({},t.crop.transforms,function(t,e,n){var r=n.origin,o=n.translation,i=n.scale,a=2*Math.PI+n.rotation%(2*Math.PI),c={x:r.x+o.x,y:r.y+o.y},u=Wt(e,a),l=St(u.tl,-a,c),f=St(u.tr,-a,c),s=St(u.br,-a,c),p=St(u.bl,-a,c),d=Yt(Math.min(l.x,f.x,s.x,p.x),Math.min(l.y,f.y,s.y,p.y),Math.max(l.x,f.x,s.x,p.x)-Math.min(l.x,f.x,s.x,p.x),Math.max(l.y,f.y,s.y,p.y)-Math.min(l.y,f.y,s.y,p.y)),h=Yt(d.x,d.y,d.width,d.height),y=Zt(t,n),m=Vt(y),g=kt(y),v=St(m.tl,a,c),E=St(m.br,a,c),w=v.x+.5*(E.x-v.x),b=v.y+.5*(E.y-v.y),_=Gt(y,{x:w-g.x,y:b-g.y}),O=Gt(h,{x:w-g.x,y:b-g.y}),x=kt(O),R={x:_.x,y:_.y},T=_.width,P=_.height,A=(x.x-R.x)/T,C=(x.y-R.y)/P,I={x:A*t.width,y:C*t.height},M=1-i,S=I.x*M,L=I.y*M,D={x:R.x+T*A,y:R.y+P*C},G=St(R,a,{x:R.x+.5*T,y:R.y+.5*P}),U=St(R,a,D),j=G.x-U.x,k=G.y-U.y;return{origin:I,translation:{x:R.x-S+j,y:R.y-L+k}}}(t.image,t.crop.rectangle,t.crop.transforms)),t.crop.isRotating=!1,t.crop.isDirty=!0},Ve=null,Ye=function(t,e){var n=t("GET_CROP_ZOOM_TIMEOUT");n&&(clearTimeout(Ve),Ve=setTimeout(function(){e("CROP_ZOOM")},n))},Be=function(t,e){Ne(),Ye(t,e)},Ne=function(){clearTimeout(Ve)},ze=function(t){t.crop.rectangle=t.crop.draft.rectangle,t.crop.draft.rectangle=null,ke(t),De(t)},Xe=function(t){t.crop.draft.transforms=Ht(t.crop.transforms),t.crop.draft.rectangle=function(t){return vt(t.x,t.y,t.width,t.height)}(t.crop.rectangle),Ne()},qe=function(t,e,n,r){return Jt(t,e,Me({},Ht(n),{rotation:r}),"rotating")},Fe=function(t,e,n,r){var o=Math.max(1e-10,r),i=Jt(t,e,Me({},Ht(n),{scale:o}),"resizing");return i.interaction={scale:o},i},He=function(t){var e=ae(t.image,t.crop.rectangle,t.crop.transforms);return{center:{x:fe(e.center.x),y:fe(e.center.y)},rotation:fe(e.rotation),zoom:fe(e.zoom),aspectRatio:fe(e.aspectRatio),flip:Me({},t.crop.flip)}},Ze=function(t,e){return e?Me({},t,e,{center:Me({},t.center,e.center||{}),flip:Me({},t.flip,e.flip||{})}):t},We=function(t,e,n){return{EDIT_OPEN:function(){n.noImageTimeout=setTimeout(function(){t("AWAITING_IMAGE")},500)},REQUEST_LOAD_IMAGE:function(e){var r=e.source,o=e.success,i=void 0===o?function(){}:o,a=e.failure,c=void 0===a?function(t){}:a,u=e.options,l=e.resolveOnConfirm,f=void 0!==l&&l;if(clearTimeout(n.noImageTimeout),!r)return c();n.file?n.queue.push({source:r,success:i,failure:c,options:u,resolveOnConfirm:f}):(nt(n),t("DID_REQUEST_LOAD_IMAGE"),function(t){return new Promise(function(e,n){if(F(t))fetch(t).then(function(t){return t.blob()}).then(function(t){return e(t)});else if(t instanceof Blob)e(t);else{if("IMG"===t.nodeName){var r=function(t){var n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight,n.getContext("2d").drawImage(t,0,0),n.toBlob(e)};return t.complete?void r(t):void(t.onload=function(){r(t)})}"CANVAS"!==t.nodeName?n(t):t.toBlob(e)}})}(r).then(function(e){e.name||(e.name=xe()),n.file={orientation:-1,data:e},t("LOAD_IMAGE",{success:i,failure:c,options:u,resolveOnConfirm:f},!0),t("KICK")}).catch(c))},LOAD_IMAGE:function(r){var o=r.success,i=r.failure,a=r.options,c=void 0===a?{}:a,u=r.resolveOnConfirm,l=n.file.data;Promise.all([function(t){return new Promise(function(e,n){var r=new Image;r.src=URL.createObjectURL(t),r.onerror=function(t){clearInterval(o),n(t)};var o=setInterval(function(){r.naturalWidth&&r.naturalHeight&&(clearInterval(o),URL.revokeObjectURL(r.src),e({width:r.naturalWidth,height:r.naturalHeight}))},1)})}(l),Tt(l)]).then(function(r){var a=r[0],l=r[1];n.file.orientation=l;var f=a.width,s=a.height;l>=5&&l<=8?(a.width=s,a.height=f):(a.width=f,a.height=s);var p=se(a,{width:e("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:e("GET_MAX_IMAGE_PREVIEW_HEIGHT")});n.image={x:0,y:0,width:p.width,height:p.height,naturalWidth:a.width,naturalHeight:a.height,aspectRatio:a.height/a.width},n.crop.instructions=Ze({center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:n.options.cropAspectRatio},c.crop);var d=(n.options.cropAspectRatioOptions||[]).map(function(t){return t.value}).find(function(t){return t===n.crop.instructions.aspectRatio});n.crop.aspectRatio=d||void 0,t("DID_LOAD_IMAGE"),n.filePromise={resolveOnConfirm:u,success:o,failure:i}}).catch(function(e){t("DID_LOAD_IMAGE_ERROR"),nt(n),i()})},DID_UPDATE_VIEWPORT:function(t){var e=t.rect;n.root=e},DID_RESIZE_STAGE:function(t){var r=t.size,o=r.width,i=r.height,a=null===n.stage;n.stage=vt(0,0,o,i),a?(Ue(n),n.filePromise.resolveOnConfirm||n.filePromise.success({crop:He(n),image:{orientation:n.file.orientation},size:{mode:e("GET_OUTPUT_FIT"),upscale:e("GET_OUTPUT_UPSCALE"),width:e("GET_OUTPUT_WIDTH"),height:e("GET_OUTPUT_HEIGHT")},output:{type:e("GET_OUTPUT_TYPE"),quality:e("GET_OUTPUT_QUALITY")}})):(n.instantUpdate=!0,je(n),setTimeout(function(){n.instantUpdate=!1},16))},CROP_ZOOM:function(){Ne(),je(n)},CROP_SET_ASPECT_RATIO:function(t){var e=t.value;Ne(),n.crop.aspectRatio=e,je(n),n.crop.isDirty=!0},CROP_RECT_CORNER_DRAG_RELEASE:function(){return ze(n)||Ye(e,t)},CROP_RECT_EDGE_DRAG_RELEASE:function(){return ze(n)||Ye(e,t)},CROP_IMAGE_DRAG_GRAB:function(){return Xe(n)||Ne()},CROP_IMAGE_RESIZE_GRAB:function(){return Xe(n)||Ne()},CROP_IMAGE_ROTATE_GRAB:function(){Xe(n),Ne(),n.crop.isRotating=!0},CROP_RECT_EDGE_DRAG_GRAB:function(){return Xe(n)||Ne()},CROP_RECT_CORNER_DRAG_GRAB:function(){return Xe(n)||Ne()},CROP_RECT_EDGE_DRAG:function(t){var e=t.offset,r=t.origin,o=t.anchor,i=n.image,a=n.stage,c=/n|s/.test(r)?At:Pt,u=te(r,n.crop.rectangle),l=te(o,n.crop.rectangle),f=function(t,e){return yt(ht(t.x,e.x,e.x+e.width),ht(t.y,e.y,e.y+e.height))}({x:u.x+(c===Pt?e.x:0),y:u.y+(c===At?e.y:0)},a);n.crop.draft.rectangle=function(t,e,n,r,o,i){var a,c,u=r.left,l=r.right,f=r.top,s=r.bottom;if(e===At?(f=Math.min(n.y,t.y),s=Math.max(n.y,t.y)):(u=Math.min(n.x,t.x),l=Math.max(n.x,t.x)),i)if(e===At){a=(s-f)/i;var p=2*Math.min(n.x-o.left,o.right-n.x);a>p&&(c=(a=p)*i,n.y>t.y?f=n.y-c:s=n.y+c),u=n.x-.5*a,l=n.x+.5*a}else{c=(l-u)*i;var d=2*Math.min(n.y-o.top,o.bottom-n.y);c>d&&(a=(c=d)/i,n.x>t.x?u=n.x-a:l=n.x+a),f=n.y-.5*c,s=n.y+.5*c}return Yt(u,f,l-u,s-f)}(f,c,l,mt(n.crop.rectangle),mt(a),n.crop.aspectRatio),n.crop.draft.transforms=ne(i,n.crop.draft.rectangle,n.crop.transforms)},CROP_RECT_CORNER_DRAG:function(t){var e=t.offset,r=t.origin,o=t.anchor,i=n.image,a=n.stage,c=oe(r,n.crop.rectangle),u=oe(o,n.crop.rectangle),l={x:c.x+e.x,y:c.y+e.y};n.crop.draft.rectangle=ie(l,u,a,n.crop.aspectRatio),n.crop.draft.transforms=ne(i,n.crop.draft.rectangle,n.crop.transforms)},CROP_IMAGE_DRAG_RELEASE:function(){ke(n),De(n),Ye(e,t)},CROP_IMAGE_RESIZE_RELEASE:function(){ke(n),De(n),Ye(e,t)},CROP_IMAGE_ROTATE_RELEASE:function(){ke(n),Ye(e,t)},CROP_IMAGE_DRAG:function(t){var e=t.value;Ne(),n.crop.draft.transforms=function(t,e,n,r){var o={x:n.translation.x+r.x,y:n.translation.y+r.y},i=Jt(t,e,Me({},Ht(n),{translation:o}),"moving");return i.interaction={translation:o},i}(n.image,n.crop.rectangle,n.crop.transforms,e)},CROP_IMAGE_RESIZE:function(t){var e=t.value;Ne();var r=n.crop.transforms;n.crop.draft.transforms=Fe(n.image,n.crop.rectangle,r,r.scale+r.scale*e)},CROP_IMAGE_RESIZE_MULTIPLY:function(t){var e=t.value;Ne();var r=n.crop.transforms;n.crop.draft.transforms=Fe(n.image,n.crop.rectangle,r,r.scale*e)},CROP_IMAGE_RESIZE_AMOUNT:function(t){var e=t.value;Ne();var r=n.crop.transforms;n.crop.draft.transforms=Fe(n.image,n.crop.rectangle,r,(n.crop.draft.transforms?n.crop.draft.transforms.scale:r.scale)+e)},CROP_IMAGE_ROTATE:function(t){var e=t.value;Ne(),n.crop.isRotating=!0,Ge(n,{main:n.crop.rotation.main,sub:e})},CROP_IMAGE_ROTATE_ADJUST:function(t){var e=t.value;Ne(),Ge(n,{main:n.crop.rotation.main,sub:Math.min(Math.PI/4,Math.max(-Math.PI/4,n.crop.rotation.sub+e))}),ke(n)},CROP_IMAGE_ROTATE_CENTER:function(){Ne(),Ge(n,{main:n.crop.rotation.main,sub:0}),ke(n)},CROP_IMAGE_ROTATE_LEFT:function(){Be(e,t),Ge(n,{main:n.crop.rotation.main-Le,sub:n.crop.rotation.sub}),ke(n)},CROP_IMAGE_ROTATE_RIGHT:function(){Be(e,t),Ge(n,{main:n.crop.rotation.main+Le,sub:n.crop.rotation.sub}),ke(n)},CROP_IMAGE_FLIP_HORIZONTAL:function(){Be(e,t),n.crop.rotation.main%Math.PI/2==0?n.crop.flip.horizontal=!n.crop.flip.horizontal:n.crop.flip.vertical=!n.crop.flip.vertical,n.crop.isDirty=!0},CROP_IMAGE_FLIP_VERTICAL:function(){Be(e,t),n.crop.rotation.main%Math.PI/2==0?n.crop.flip.vertical=!n.crop.flip.vertical:n.crop.flip.horizontal=!n.crop.flip.horizontal,n.crop.isDirty=!0},SET_DATA:function(e){n.crop.instructions=Ze({center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:n.options.cropAspectRatio},e.crop);var r=(n.options.cropAspectRatioOptions||[]).map(function(t){return t.value}).find(function(t){return t===n.crop.instructions.aspectRatio});n.crop.aspectRatio=r||null,t("EDIT_RESET")},GET_DATA:function(n){var r=n.success,o=n.failure,i=n.file,a=n.data;t("REQUEST_PREPARE_OUTPUT",{file:q(i)?i:e("GET_OUTPUT_FILE"),data:q(a)?a:e("GET_OUTPUT_DATA"),success:r,failure:o})},REQUEST_PREPARE_OUTPUT:function(e){var n=e.file,r=e.data,o=e.success,i=e.failure;t("PREPARE_OUTPUT",{file:n,data:r,success:o,failure:i},!!n)},PREPARE_OUTPUT:function(r){var o=r.file,i=r.data,a=r.success,c=r.failure;(function(t,e,n){return new Promise(function(r,o){var i={data:null,file:null},a={crop:He(e),image:{orientation:e.file.orientation},size:{mode:n("GET_OUTPUT_FIT"),upscale:n("GET_OUTPUT_UPSCALE"),width:n("GET_OUTPUT_WIDTH"),height:n("GET_OUTPUT_HEIGHT")},output:{type:n("GET_OUTPUT_TYPE"),quality:n("GET_OUTPUT_QUALITY")}};t.data&&(i.data=a),t.file?Ie(e.file.data,a,n("GET_OUTPUT_STRIP_IMAGE_HEAD")).then(function(t){i.file=t,r(i)}).catch(o):r(i)})})({file:o,data:i},n,e).then(function(e){t("DID_PREPARE_OUTPUT"),a(e)}).catch(c)},EDIT_RESET:function(){Ne(),Ue(n)},EDIT_CONFIRM:function(r){var o=r.ready;Ne(),t("CROP_ZOOM"),t("REQUEST_PREPARE_OUTPUT",{file:e("GET_OUTPUT_FILE"),data:e("GET_OUTPUT_DATA"),success:function(e){o(),n.filePromise.resolveOnConfirm&&n.filePromise.success(e),t("DID_CONFIRM",{output:e})}})},EDIT_CANCEL:function(){n.filePromise&&n.filePromise.failure(),t("DID_CANCEL")},EDIT_CLOSE:function(){Ne()},EDIT_DESTROY:function(){nt(n);var e=n.queue.shift();e?t("REQUEST_LOAD_IMAGE",e):t("DID_CLOSE")},SET_OPTIONS:function(e){var n=e.options;l(n,function(e,n){t("SET_".concat(rt(e,"_").toUpperCase()),{value:n})})}}},Qe={down:null,move:null,up:null},Ke=function(t,e,n){Qe.down||(Qe.down=window.PointerEvent?["pointerdown"]:["touchstart","mousedown"],Qe.move=window.PointerEvent?["pointermove"]:["touchmove","mousemove"],Qe.up=window.PointerEvent?["pointerup"]:["touchend","touchcancel","mouseup"]),Qe[e].forEach(function(e){t.addEventListener(e,n)})},Je=function(t,e,n){Qe[e].forEach(function(e){t.removeEventListener(e,n)})},$e=function(t,e,n,r){var o={x:0,y:0},i={parameters:null,isMultiTouching:!1,enabled:!0},a=function(t,e){return e.apply(null,[function(t){return{x:t.pageX-o.x,y:t.pageY-o.y}}(t)].concat(i.parameters))},c=function(t){i.isMultiTouching=!1,t.preventDefault(),o.x=t.pageX,o.y=t.pageY,Ke(document.documentElement,"up",l),Ke(document.documentElement,"move",u),i.parameters=e()||[]},u=function(t){t.touches&&t.touches.length>1?i.isMultiTouching=!0:(t.preventDefault(),a(t,n))},l=function t(e){Je(document.documentElement,"up",t),Je(document.documentElement,"move",u),i.isMultiTouching?i.isMultiTouching=!1:(e.preventDefault(),a(e,n),a(e,r))};return Ke(t,"down",c),{enable:function(){i.enabled||Ke(t,"down",c),i.enabled=!0},disable:function(){i.enabled&&Je(t,"down",c),i.enabled=!1},destroy:function(){Je(document.documentElement,"up",l),Je(document.documentElement,"move",u),Je(t,"down",c)}}},tn={38:"up",40:"down",37:"left",39:"right",189:"minus",187:"plus",72:"h",76:"l",81:"q",82:"r",84:"t",86:"v",90:"z",219:"left_bracket",221:"right_bracket"},en=function(t,e,n,r,o){var i=null,a=!0,c={enabled:!0},u=function(t){var o=tn[t.keyCode]||t.keyCode;n[o]&&(t.stopPropagation(),a&&(i=e(o),a=!1),n[o](i),r(i))},l=function(t){var e=tn[t.keyCode]||t.keyCode;n[e]&&(t.stopPropagation(),o(i),a=!0)};return t.addEventListener("keydown",u),t.addEventListener("keyup",l),{enable:function(){c.enabled||(t.addEventListener("keydown",u),t.addEventListener("keyup",l)),c.enabled=!0},disable:function(){c.enabled&&(t.removeEventListener("keydown",u),t.removeEventListener("keyup",l)),c.enabled=!1},destroy:function(){t.removeEventListener("keydown",u),t.removeEventListener("keyup",l)}}},nn=V({name:"crop-rotator-line",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{styles:["translateX"],animations:{translateX:"spring"}},create:function(t){for(var e=t.root,n='<svg viewBox="-90 -5 180 10" xmlns="http://www.w3.org/2000/svg">',r=0;r<=180;r+=2){var o=r*(176/180)-90+2,i=r%10==0?.5:.2;if(n+='<circle fill="currentColor" cx="'.concat(o,'" cy="').concat(0,'" r="').concat(i,'"/>'),r%10==0)n+='<text fill="currentColor" x="'.concat(o+(o<0?-2.25:0===o?-.75:-1.5),'" y="').concat(3.5,'">').concat(-90+r,"°</text>")}n+="</svg>",e.element.innerHTML=n}}),rn=V({name:"crop-rotator",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",delay:250,duration:500}},apis:["rotation","animate"]},create:function(t){var e=t.root,n=t.props;e.element.setAttribute("tabindex",0);var r=document.createElement("button");r.innerHTML="<span>".concat(e.query("GET_LABEL_BUTTON_CROP_ROTATE_CENTER"),"</span>"),r.className="doka--crop-rotator-center",r.addEventListener("click",function(){e.dispatch("CROP_IMAGE_ROTATE_CENTER")}),e.appendChild(r);var o=null;e.appendChildView(e.createChildView(function(t,e){return V({name:t,ignoreRect:!0,create:e})}("crop-rotator-line-mask",function(t){var e=t.root,n=t.props;o=e.appendChildView(e.createChildView(nn,{translateX:Math.round(312*n.rotation)}))}),n)),e.ref.line=o;var i=document.createElement("div");i.className="doka--crop-rotator-bar",e.appendChild(i);var a=Math.PI/4,c=0;e.ref.dragger=$e(i,function(){c=o.translateX/312,e.dispatch("CROP_IMAGE_ROTATE_GRAB")},function(t){var n=t.x/e.rect.element.width*(Math.PI/2),r=Ct(c+n,-a,a);e.dispatch("CROP_IMAGE_ROTATE",{value:-r})},function(){e.dispatch("CROP_IMAGE_ROTATE_RELEASE")}),e.ref.keyboard=en(e.element,function(){c=0},{left:function(){c+=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})},right:function(){c-=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})}},function(){},function(){})},destroy:function(t){var e=t.root;e.ref.dragger.destroy(),e.ref.keyboard.destroy()},write:Y({REQUEST_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.dragger.disable(),e.ref.keyboard.disable()},DID_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.dragger.enable(),e.ref.keyboard.enable()}},function(t){var e=t.root,n=t.props,r=n.animate,o=n.rotation;r||0===o||(e.ref.line.translateX=null),e.ref.line.translateX=Math.round(312*-o)})}),on=function(){self.onmessage=function(t){createImageBitmap(t.data.message.file).then(function(e){self.postMessage({id:t.data.id,message:e},[e])})}},an={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},cn=function(t,e,n,r,o){e=Math.round(e),n=Math.round(n);var i=o||document.createElement("canvas"),a=i.getContext("2d");return r>=5&&r<=8?(i.width=n,i.height=e):(i.width=e,i.height=n),a.save(),function(t,e,n,r){-1!==r&&t.transform.apply(t,an[r](e,n))}(a,e,n,r),a.drawImage(t,0,0,e,n),a.restore(),i},un=V({name:"subject-image",ignoreRect:!0,ignoreRectUpdate:!0,tag:"canvas",mixins:{styles:["perspective","rotateX","rotateY","rotateZ","scaleX","scaleY"],animations:{rotateX:{type:"spring",stiffness:.25,damping:.25,mass:2.5},rotateY:{type:"spring",stiffness:.25,damping:.25,mass:2.5},scaleX:{type:"spring",stiffness:.25,damping:.75,mass:15},scaleY:{type:"spring",stiffness:.25,damping:.75,mass:15}}},write:Y({DID_PRESENT_IMAGE:function(t){var e=t.root;e.scaleX=1,e.scaleY=1}}),create:function(t){var e=t.root;e.rotateZ=1e-5;var n="preview"!==e.query("GET_STYLE_LAYOUT_MODE");e.scaleX=n?1.15:1,e.scaleY=n?1.15:1,e.rotateX=n?1:null,e.rotateY=n?1:null;var r=e.query("GET_FILE"),o=URL.createObjectURL(r.data);!function(){var t=function(t){var n=se(t,{width:e.query("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:e.query("GET_MAX_IMAGE_PREVIEW_HEIGHT")});cn(t,n.width,n.height,r.orientation,e.element),e.dispatch("DID_PRESENT_IMAGE")},n=function(){Pe(o).then(t)};if(function(t){return"createImageBitmap"in window&&function(t){return/^image/.test(t.type)&&!/svg/.test(t.type)}(t)}(r.data)){var i=Re(on);i.post({file:r.data},function(e){i.terminate(),e?t(e):n()})}else n()}()}}),ln=V({name:"subject-image-container",tag:"div",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{apis:["flipHorizontal","flipVertical","scale"],styles:["originX","originY","translateX","translateY","scaleX","scaleY","rotateZ","opacity"],animations:{opacity:{type:"tween",delay:150,duration:750},scaleX:{type:"spring",stiffness:.5,damping:.75,mass:15},scaleY:{type:"spring",stiffness:.5,damping:.75,mass:15},translateX:"spring",translateY:"spring",originX:"spring",originY:"spring",rotateZ:{type:"spring",stiffness:.25,damping:.25,mass:2.5}}},create:function(t){var e=t.root;e.element.setAttribute("tabindex",0),e.ref.image=e.appendChildView(e.createChildView(un,{rotateX:0,rotateY:0,perspective:2e3})),e.ref.dragger=$e(e.element,function(){e.dispatch("CROP_IMAGE_DRAG_GRAB")},function(t){e.dispatch("CROP_IMAGE_DRAG",{value:t})},function(){e.dispatch("CROP_IMAGE_DRAG_RELEASE")})},destroy:function(t){t.root.ref.dragger.destroy()},write:Y({REQUEST_PREPARE_OUTPUT:function(t){t.root.ref.dragger.disable()},DID_PREPARE_OUTPUT:function(t){t.root.ref.dragger.enable()}},function(t){var e=t.root,n=t.props;e.ref.image.rotateX=n.flipVertical?Math.PI:0,e.ref.image.rotateY=n.flipHorizontal?Math.PI:0})}),fn=["nw","ne","se","sw"],sn=["n","e","s","w"],pn=function(t){return sn[(sn.indexOf(t)+2)%sn.length]},dn=1===window.devicePixelRatio?function(t){return Math.round(t)}:function(t){return t},hn=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect-focal-line",mixins:{styles:["translateX","translateY","scaleX","scaleY","opacity"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring",opacity:"spring"}}}),yn=function(t,e){return V({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-corner-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:"spring",translateY:"spring",scaleX:{type:"tween",duration:350,delay:e},scaleY:{type:"tween",duration:350,delay:e},opacity:{type:"tween",duration:350,delay:e}}},create:function(e){var n=e.root;n.element.classList.add("doka--crop-rect-corner"),n.element.setAttribute("role","button"),n.element.setAttribute("tabindex",-1),n.opacity=1,n.scaleX=1,n.scaleY=1,n.ref.dragger=$e(n.element,function(){return n.dispatch("CROP_RECT_CORNER_DRAG_GRAB"),[t,function(t){return fn[(fn.indexOf(t)+2)%fn.length]}(t)]},function(t,e,r){n.dispatch("CROP_RECT_CORNER_DRAG",{offset:t,origin:e,anchor:r})},function(){n.dispatch("CROP_RECT_CORNER_DRAG_RELEASE")})},write:Y({REQUEST_PREPARE_OUTPUT:function(t){t.root.ref.dragger.disable()},DID_PREPARE_OUTPUT:function(t){t.root.ref.dragger.enable()}}),destroy:function(t){t.root.ref.dragger.destroy()}})},mn=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",delay:250,duration:500}},apis:["rectangle","draft","rotating"]},create:function(t){var e=t.root;fn.forEach(function(t,n){e.ref[t]=e.appendChildView(e.createChildView(yn(t,50*(fn.length-n))))}),sn.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(function(t){return V({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-edge-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring"}},create:function(e){var n=e.root;n.element.classList.add("doka--crop-rect-edge"),n.element.setAttribute("tabindex",0),n.element.setAttribute("role","button"),n.ref.dragger=$e(n.element,function(){return n.dispatch("CROP_RECT_EDGE_DRAG_GRAB"),[t,pn(t)]},function(t,e,r){n.dispatch("CROP_RECT_EDGE_DRAG",{offset:t,origin:e,anchor:r})},function(){n.dispatch("CROP_RECT_EDGE_DRAG_RELEASE")}),n.ref.keyboard=en(n.element,function(){return{x:0,y:0}},{up:function(t){t.y-=20},down:function(t){t.y+=20},left:function(t){t.x-=20},right:function(t){t.x+=20}},function(e){n.dispatch("CROP_RECT_EDGE_DRAG",{offset:e,origin:t,anchor:pn(t)})},function(){n.dispatch("CROP_RECT_EDGE_DRAG_RELEASE")})},REQUEST_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.dragger.disable(),e.ref.keyboard.disable()},DID_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.dragger.enable(),e.ref.keyboard.enable()},destroy:function(t){var e=t.root;e.ref.keyboard.destroy(),e.ref.dragger.destroy()}})}(t)))}),e.ref.lines=[];for(var n=0;n<10;n++)e.ref.lines.push(e.appendChildView(e.createChildView(hn,{opacity:0})))},write:function(t){var e=t.root,n=t.props,r=n.rectangle,o=n.draft,i=n.rotating;if(r){var a=e.ref,c=a.n,u=a.e,l=a.s,f=a.w,s=a.nw,p=a.ne,d=a.se,h=a.sw,y=a.lines,m=r.x,g=r.y,v=r.x+r.width,E=r.y+r.height,w=E-g,b=v-m;if(vn(o,s,m,g),vn(o,p,v,g),vn(o,d,v,E),vn(o,h,m,E),gn(o,c,m,g,b/100,1),gn(o,u,v,g,1,w/100),gn(o,l,m,E,b/100,1),gn(o,f,m,g,1,w/100),i){var _=y.slice(0,5),O=1/_.length;_.forEach(function(t,e){gn(o,t,m,g+w*(O+e*O),b/100,.01),t.opacity=.5});var x=y.slice(5);O=1/x.length,x.forEach(function(t,e){gn(o,t,m+b*(O+e*O),g,.01,w/100),t.opacity=.5})}else if(o){var R=y[0],T=y[1],P=y[2],A=y[3];gn(o,R,m,g+.333*w,b/100,.01),gn(o,T,m,g+.666*w,b/100,.01),gn(o,P,m+.333*b,g,.01,w/100),gn(o,A,m+.666*b,g,.01,w/100),R.opacity=.5,T.opacity=.5,P.opacity=.5,A.opacity=.5}else y.forEach(function(t){return t.opacity=0})}}}),gn=function(t,e,n,r,o,i){t&&(e.translateX=null,e.translateY=null,e.scaleX=null,e.scaleY=null),e.translateX=dn(n),e.translateY=dn(r),e.scaleX=o,e.scaleY=i},vn=function(t,e,n,r){t&&(e.translateX=null,e.translateY=null),e.translateX=dn(n),e.translateY=dn(r)},En=["top","right","bottom","left"],wn=function(t,e,n,r,o,i){t||(e.translateX=null,e.translateY=null,e.scaleX=null,e.scaleY=null),e.translateX=n,e.translateY=r,e.scaleX=o,e.scaleY=i},bn=V({ignoreRect:!0,name:"crop-smoke",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",delay:0,duration:1e3}},apis:["rectangle","container","animate"]},create:function(t){var e=t.root;En.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(function(t){return V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-smoke-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring"}}})}(t)))})},write:function(t){var e=t.root,n=t.props,r=e.ref,o=r.top,i=r.right,a=r.bottom,c=r.left,u=n.rectangle,l=n.container,f=n.animate,s=e.rect.element,p=l,d=u.x,h=u.y,y=p.top,m=p.left,g=h+y,v=p.width,E=d+m,w=d+u.width,b=h+u.height,_=p.height-(b+y),O=m+s.width-(d+u.width);wn(f,o,-m-2,-y-2,(v+4)/100,(g+2)/100),wn(f,c,-m-2,h-2,(E+2)/100,(u.height+4)/100),wn(f,i,w,h-2,(O+2)/100,(u.height+4)/100),wn(f,a,-m-2,b,(v+4)/100,(_+2)/100)}}),_n=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"button",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}},listeners:!0},tag:"button",create:function(t){var e=t.root,n=t.props;e.element.innerHTML="".concat(n.icon||"","<span>").concat(n.label,"</span>"),n.name&&n.name.split(" ").forEach(function(t){e.element.className+=" doka--button-".concat(t)}),e.ref.handleClick=function(t){"string"==typeof n.action?e.dispatch(n.action):n.action()},e.element.addEventListener("click",e.ref.handleClick),n.create&&n.create({root:e,props:n})},destroy:function(t){var e=t.root;e.element.removeEventListener("click",e.ref.handleClick)}}),On=function(t,e){return V({ignoreRect:!0,name:t,mixins:e,create:function(t){var e=t.root,n=t.props;n.className&&e.element.classList.add(n.className),n.controls.map(function(t){var n=e.createChildView(t.view,t);t.didCreateView&&t.didCreateView(n),e.appendChildView(n)})}})},xn=function(t){var e=t.root,n=t.props,r=t.timestamp,o=e.query("GET_CROP",n.id,r),i=e.ref.btnZoom;if(i){var a=o.rectangle;i.translateX=a.x+.5*a.width,i.translateY=a.y+.5*a.height}},Rn=V({name:"crop-subject",ignoreRect:!0,mixins:{apis:["overlay"],styles:["opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root,n=t.props;n.id,n.file;e.opacity=1,e.ref.imageView=e.appendChildView(e.createChildView(ln,{flip:{horizontal:!1,vertical:!1},translateX:null,translateY:null,rotateZ:null,scaleX:null,scaleY:null,opacity:0})),e.ref.cropView=e.appendChildView(e.createChildView(mn,{opacity:0})),e.ref.overlayView=e.appendChildView(e.createChildView(bn,{opacity:0})),e.query("GET_CROP_ZOOM_TIMEOUT")||(e.ref.btnZoom=e.appendChildView(e.createChildView(On("zoom-wrapper",{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:250}}}),{opacity:0,controls:[{view:_n,label:e.query("GET_LABEL_BUTTON_CROP_ZOOM"),name:"zoom",icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g fill="currentColor" fill-rule="nonzero"><path d="M12.5 19a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13zm0-2a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9z"/><path d="M15.765 17.18a1 1 0 1 1 1.415-1.415l3.527 3.528a1 1 0 0 1-1.414 1.414l-3.528-3.527z"/></g></svg>',action:function(){return e.dispatch("CROP_ZOOM")}}]}))),e.ref.state={size:null},e.ref.hasTroubleAnimatingTransformOrigin="safari"in window},write:Y({CROP_RECT_EDGE_DRAG_RELEASE:xn,CROP_RECT_CORNER_DRAG_RELEASE:xn,DID_PRESENT_IMAGE:function(t){var e=t.root;e.ref.imageView.opacity=1,e.ref.cropView.opacity=1}},function(t){var e=t.root,n=t.props,r=t.actions,o=t.timestamp;if(null===e.ref.state.size){if(!e.rect.element.width)return;e.ref.state.size={width:e.rect.element.width,height:e.rect.element.height},e.dispatch("DID_RESIZE_STAGE",{size:e.ref.state.size})}else if(e.ref.state.size.width!==e.rect.element.width||e.ref.state.size.height!==e.rect.element.height){var i=e.rect.element,a=i.width,c=i.height;e.ref.state.size={width:a,height:c},e.dispatch("DID_RESIZE_STAGE",{size:e.ref.state.size})}var u=e.query("GET_CROP",n.id,o);if(u){var l=e.ref,f=l.imageView,s=l.cropView,p=l.overlayView,d=l.btnZoom,h=u.isRotating,y=u.isDraft,m=u.origin,g=u.translation,v=u.scale,E=u.rotation,w=u.rectangle,b=u.flip;if(p.opacity=.8,y&&(f.originX=null,f.originY=null,f.translateX=null,f.translateY=null,f.scaleX=null,f.scaleY=null,f.rotateZ=null),f.perspective=100,e.ref.hasTroubleAnimatingTransformOrigin)!!r.find(function(t){return"CROP_IMAGE_DRAG_RELEASE"===t.type})&&(f.originX=null,f.originY=null,f.translateX=null,f.translateY=null);var _={x:0,y:0},O=0;if(y&&u.interaction){if(u.interaction.translation){var x=u.interaction.translation.x-g.x,R=u.interaction.translation.y-g.y;_={x:100*Math.sign(x)*Math.log10(1+Math.abs(x)/100),y:100*Math.sign(R)*Math.log10(1+Math.abs(R)/100)}}if(u.interaction.scale){var T=u.interaction.scale-v;O=.25*Math.sign(T)*Math.log10(1+Math.abs(T)/.25)}}f.originX=m.x,f.originY=m.y,f.translateX=g.x+_.x,f.translateY=g.y+_.y,f.scaleX=v+O,f.scaleY=v+O,f.rotateZ=E.main+E.sub,f.flipHorizontal=b.horizontal,f.flipVertical=b.vertical,s.draft=y,s.rotating=h,s.rectangle=w;var P=e.query("GET_ROOT");p.animate=!y,p.container={left:P.left+e.rect.element.left,top:P.top+e.rect.element.top,width:P.width,height:P.height},p.rectangle=w,d&&(d.opacity=u.canRecenter&&!u.isDraft?1:0)}})}),Tn=function(){return performance.now()};function Pn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){An(t,e,n[e])})}return t}function An(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Cn=function(t,e){var n=function(t,e){for(;1===t.nodeType&&!e(t);)t=t.parentNode;return 1===t.nodeType?t:null}(e,function(t){return t.classList.contains("doka--root")});return!!n&&n.contains(t)},In=function(t){var e=t.root,n=t.props,r=t.action.position,o=n.pivotPoint,i=e.ref,a=i.indicatorA,c=i.indicatorB,u=o.x-r.x,l=o.y-r.y,f={x:o.x+u,y:o.y+l},s={x:o.x-u,y:o.y-l};a.style.cssText="transform: translate3d(".concat(f.x,"px, ").concat(f.y,"px, 0)"),c.style.cssText="transform: translate3d(".concat(s.x,"px, ").concat(s.y,"px, 0)")},Mn=function(t){return{x:t.pageX,y:t.pageY}},Sn=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-resizer",mixins:{apis:["pivotPoint"]},create:function(t){var e=t.root,n=t.props;e.ref.indicatorA=document.createElement("div"),e.appendChild(e.ref.indicatorA),e.ref.indicatorB=document.createElement("div"),e.appendChild(e.ref.indicatorB);var r=e.query("GET_CROP_RESIZE_KEY_CODES"),o={origin:{x:null,y:null},position:{x:null,y:null},selecting:!1,enabled:!1,scrollY:0,offsetX:0,offsetY:0},i=Tn();e.ref.state=o;var a=0;e.ref.touchStart=function(t){if(Cn(e.element,t.target)&&!(t.touches.length<=1)){t.preventDefault();var n=Mn(t.touches[0]),r=Mn(t.touches[1]);a=Mt(n,r),document.addEventListener("touchmove",e.ref.touchMove),document.addEventListener("touchend",e.ref.touchEnd)}},e.ref.touchMove=function(t){t.preventDefault();var n=Mn(t.touches[0]),r=Mn(t.touches[1]),o=(Mt(n,r)-a)/a;e.dispatch("CROP_IMAGE_RESIZE",{value:o})},e.ref.touchEnd=function(t){t.preventDefault(),document.removeEventListener("touchmove",e.ref.touchMove),document.removeEventListener("touchend",e.ref.touchEnd),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},document.addEventListener("touchstart",e.ref.touchStart);var c=performance.now(),u=0,l=1,f=function(t,e){var n=null,r=null;return function(){var o=arguments;if(!r)return t.apply(null,Array.from(arguments)),void(r=Tn());clearTimeout(n),n=setTimeout(function(){Tn()-r>=e&&(t.apply(null,Array.from(o)),r=Tn())},e-(Tn()-r))}}(function(t){var n=Math.sign(t.wheelDelta||t.deltaY),r=Tn(),o=r-c;c=r,(o>750||u!==n)&&(l=1,u=n),l+=.05*n,e.dispatch("CROP_IMAGE_RESIZE_MULTIPLY",{value:Math.max(.1,l)}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},100);e.ref.wheel=function(t){/doka--/.test(t.target.className)&&Cn(e.element,t.target)&&(t.preventDefault(),f(t))},document.addEventListener("wheel",e.ref.wheel),e.ref.move=function(t){if(t.preventDefault(),o.position.x=t.pageX-e.ref.state.offsetX,o.position.y=t.pageY-e.ref.state.scrollY-e.ref.state.offsetY,o.enabled)if(Cn(e.element,t.target)){"idle"===e.element.dataset.state&&e.dispatch("RESIZER_SHOW",{position:Pn({},o.position)}),e.dispatch("RESIZER_MOVE",{position:Pn({},o.position)});var r=n.pivotPoint,c=r.x-o.position.x,u=r.y-o.position.y,l={x:r.x+c,y:r.y+u},f=Pn({},o.position);if(o.selecting){var s=(Mt(l,f)-a)/a,p=performance.now();p-i>25&&(i=p,e.dispatch("CROP_IMAGE_RESIZE",{value:s}))}}else e.dispatch("RESIZER_CANCEL")},e.ref.select=function(t){if(Cn(e.element,t.target)){var r=n.pivotPoint,i=r.x-o.position.x,c=r.y-o.position.y,u={x:r.x+i,y:r.y+c},l=o.position;a=Mt(u,l),o.selecting=!0,o.origin.x=t.pageX,o.origin.y=t.pageY,e.dispatch("CROP_IMAGE_RESIZE_GRAB")}},e.ref.confirm=function(t){Cn(e.element,t.target)&&(o.selecting=!1,e.dispatch("CROP_IMAGE_RESIZE_RELEASE"))},e.ref.blur=function(t){o.selecting=!1,o.enabled=!1,document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_CANCEL")},window.addEventListener("blur",e.ref.blur),document.addEventListener("mousemove",e.ref.move),e.ref.keyDown=function(t){r.includes(t.keyCode)&&o.position&&(o.enabled=!0,document.addEventListener("mousedown",e.ref.select),document.addEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_SHOW",{position:Pn({},o.position)}))},e.ref.keyUp=function(t){r.includes(t.keyCode)&&(o.enabled=!1,document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_CANCEL"))},document.body.addEventListener("keydown",e.ref.keyDown),document.body.addEventListener("keyup",e.ref.keyUp)},destroy:function(t){var e=t.root;document.removeEventListener("touchmove",e.ref.touchMove),document.removeEventListener("touchend",e.ref.touchEnd),document.removeEventListener("touchstart",e.ref.touchStart),document.removeEventListener("wheel",e.ref.wheel),document.removeEventListener("mousemove",e.ref.move),document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),document.body.removeEventListener("keydown",e.ref.keyDown),document.body.removeEventListener("keyup",e.ref.keyUp),window.removeEventListener("blur",e.ref.blur)},read:function(t){var e=t.root;e.ref.state.scrollY=window.scrollY;var n=e.element.getBoundingClientRect();e.ref.state.offsetX=n.x,e.ref.state.offsetY=n.y},write:Y({RESIZER_SHOW:function(t){var e=t.root,n=t.props,r=t.action;e.element.dataset.state="multi-touch",In({root:e,props:n,action:r})},RESIZER_CANCEL:function(t){t.root.element.dataset.state="idle"},RESIZER_MOVE:In})}),Ln=V({ignoreRect:!0,name:"group",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",delay:0,duration:500}}},create:function(t){var e=t.root,n=t.props;n.className&&e.element.classList.add(n.className),n.controls.map(function(t){var n=e.createChildView(t.view,t);t.didCreateView&&t.didCreateView(n),e.appendChildView(n)})}});function Dn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Gn(t,e,n[e])})}return t}function Gn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Un=V({ignoreRect:!0,tag:"div",name:"dropdown-list",mixins:{styles:["translateY","opacity"],apis:["selectedValue"],animations:{translateY:"spring",opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root,n=t.props;n.options.map(function(t){var r=e.createChildView(_n,Dn({},t,{action:function(){return e.dispatch(n.optionAction,{value:t.value})}}));return e.appendChildView(r)}),e.element.setAttribute("role","list"),e.ref.handleClick=function(){return n.action&&n.action()},e.element.addEventListener("click",e.ref.handleClick)},write:function(t){var e=t.root,n=t.props,r=(t.actions,n.options.findIndex(function(t){return t.value===n.selectedValue}));e.childViews.forEach(function(t,e){t.element.setAttribute("aria-selected",e===r)})},destroy:function(t){var e=t.root;e.element.removeEventListener("click",e.ref.handleClick)}}),jn=V({ignoreRect:!0,tag:"div",name:"dropdown",mixins:{apis:["selectedValue"]},create:function(t){var e=t.root,n=t.props;e.ref.open=!1;var r=function(t){e.ref.open=t,e.dispatch(n.buttonAction)};e.ref.button=e.appendChildView(e.createChildView(_n,Dn({},n,{action:function(){r(!e.ref.open)}}))),e.ref.list=e.appendChildView(e.createChildView(Un,Dn({},n,{action:function(){r(!1)}}))),e.ref.handleBodyClick=function(t){e.element.contains(t.target)||r(!1)},e.element.addEventListener("focusin",function(t){t.target!==e.ref.button.element&&r(!0)}),e.element.addEventListener("focusout",function(t){e.element.contains(t.relatedTarget)||r(!1)}),document.body.addEventListener("click",e.ref.handleBodyClick)},destroy:function(t){var e=t.root;document.body.removeEventListener("click",e.ref.handleBodyClick)},write:function(t){var e=t.root,n=t.props;e.ref.list.opacity=e.ref.open?1:0,e.ref.list.translateY=e.ref.open?0:-5,e.ref.list.selectedValue=n.selectedValue}});function kn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Vn(t,e,n[e])})}return t}function Vn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Yn=function(t,e){var n=t.element.querySelectorAll(".doka--icon-aspect-ratio rect");if(n.length){if(!e)return n[0].style.opacity=.2,n[1].style.opacity=.3,void(n[2].style.opacity=.4);n[0].style.opacity=e>1?1:.3,n[1].style.opacity=1===e?.85:.5,n[2].style.opacity=e<1?1:.3}},Bn=V({name:"crop",ignoreRect:!0,create:function(t){var e=t.root,n=t.props,r=[{view:_n,label:e.query("GET_LABEL_BUTTON_CROP_ROTATE_LEFT"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g transform="translate(3 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><rect y="9" width="12" height="12" rx="1"/><path d="M9.823 5H11a5 5 0 0 1 5 5 1 1 0 0 0 2 0 7 7 0 0 0-7-7H9.626l.747-.747A1 1 0 0 0 8.958.84L6.603 3.194a1 1 0 0 0 0 1.415l2.355 2.355a1 1 0 0 0 1.415-1.414L9.823 5z" fill-rule="nonzero" /></g></svg>',action:function(){return e.dispatch("CROP_IMAGE_ROTATE_LEFT")}},{view:_n,label:e.query("GET_LABEL_BUTTON_CROP_FLIP_HORIZONTAL"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g fill="currentColor" fill-rule="evenodd" class="doka--icon-flip-horizontal"><path d="M11.93 7.007V20a1 1 0 0 1-1 1H5.78a1 1 0 0 1-.93-1.368l5.15-12.993a1 1 0 0 1 1.929.368z"/><path d="M14 7.007V20a1 1 0 0 0 1 1h5.149a1 1 0 0 0 .93-1.368l-5.15-12.993A1 1 0 0 0 14 7.007z" opacity=".6"/></g></svg>',action:function(){return e.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")}},{view:_n,label:e.query("GET_LABEL_BUTTON_CROP_FLIP_VERTICAL"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="doka--icon-flip-vertical"><g fill="currentColor" fill-rule="evenodd"><path d="M19.993 12.143H7a1 1 0 0 1-1-1V5.994a1 1 0 0 1 1.368-.93l12.993 5.15a1 1 0 0 1-.368 1.93z"/><path d="M19.993 14a1 1 0 0 1 .368 1.93L7.368 21.078A1 1 0 0 1 6 20.148V15a1 1 0 0 1 1-1h12.993z" opacity=".6"/></g></svg>',action:function(){return e.dispatch("CROP_IMAGE_FLIP_VERTICAL")}}],o=e.query("GET_CROP_ASPECT_RATIO_OPTIONS");o&&r.push({view:jn,label:e.query("GET_LABEL_BUTTON_CROP_ASPECT_RATIO"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="doka--icon-aspect-ratio"><g fill="currentColor" fill-rule="evenodd"><rect x="2" y="4" opacity=".3" width="10" height="18" rx="1"/><rect opacity=".5" x="4" y="8" width="14" height="14" rx="1"/><rect x="6" y="12" width="17" height="10" rx="1"/></g></svg>',buttonAction:"TOGGLE_ASPECT_RATIO",optionAction:"CROP_SET_ASPECT_RATIO",options:o.map(function(t){return kn({},t,{icon:function(t){var e,n;t>1?(n=14,e=Math.round(n/t)):(e=14,n=Math.round(e*t));var r=Math.round(.5*(23-e)),o=Math.round(.5*(23-n));return'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g  fill="currentColor"><rect x="'.concat(r,'" y="').concat(o,'" width="').concat(e,'" height="').concat(n,'" rx="2.5"/></g></svg>')}(t.value)})}),didCreateView:function(t){e.ref.aspectRatioDropdown=t}}),e.query("GET_CROP_ALLOW_IMAGE_TURN_RIGHT")&&r.splice(1,0,{view:_n,label:e.query("GET_LABEL_BUTTON_CROP_ROTATE_RIGHT"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g transform="translate(5 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><path d="M8.177 5H7a5 5 0 0 0-5 5 1 1 0 0 1-2 0 7 7 0 0 1 7-7h1.374l-.747-.747A1 1 0 0 1 9.042.84l2.355 2.355a1 1 0 0 1 0 1.415L9.042 6.964A1 1 0 0 1 7.627 5.55l.55-.55z" fill-rule="nonzero"/><rect x="6" y="9" width="12" height="12" rx="1"/></g></svg>',action:function(){return e.dispatch("CROP_IMAGE_ROTATE_RIGHT")}}),e.ref.menu=e.appendChildView(e.createChildView(Ln,{className:"doka--toolbar",opacity:0,controls:r})),e.menuItemsRequiredWidth=null,e.ref.subject=e.appendChildView(e.createChildView(Rn,kn({},n))),e.ref.rotator=e.appendChildView(e.createChildView(rn,{rotation:0,opacity:0})),e.ref.resizer=e.appendChildView(e.createChildView(Sn,{pivotPoint:{x:0,y:0}}));var i=0,a=0;e.ref.keyboard=en(e.element,function(){return i=0,a=0,{x:0,y:0}},{up:function(t){t.y-=20},down:function(t){t.y+=20},left:function(t){t.x-=20},right:function(t){t.x+=20},plus:function(){i+=.1,e.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:i}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},minus:function(){i-=.1,e.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:i}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},left_bracket:function(){a-=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:a})},right_bracket:function(){a+=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:a})},h:function(){e.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")},l:function(){e.dispatch("CROP_IMAGE_ROTATE_LEFT")},q:function(){e.dispatch("CROP_RESET")},r:function(){e.dispatch("CROP_IMAGE_ROTATE_RIGHT")},v:function(){e.dispatch("CROP_IMAGE_FLIP_VERTICAL")},z:function(){e.dispatch("CROP_ZOOM")}},function(t){t&&e.dispatch("CROP_IMAGE_DRAG",{value:t})},function(t){t&&e.dispatch("CROP_IMAGE_DRAG_RELEASE")})},read:function(t){var e=t.root;if(null===e.menuItemsRequiredWidth){var n=e.ref.menu.childViews.reduce(function(t,e){return t+e.rect.outer.width},0);e.menuItemsRequiredWidth=0===n?null:n}},write:Y({REQUEST_PREPARE_OUTPUT:function(t){var e=t.root.ref,n=e.menu,r=e.rotator;n.opacity=0,r.opacity=0},DID_PREPARE_OUTPUT:function(t){var e=t.root.ref,n=e.menu,r=e.rotator;n.opacity=1,r.opacity=1},TOGGLE_ASPECT_RATIO:function(t){var e=t.root;Yn(e,e.query("GET_CROP_ASPECT_RATIO")),e.ref.aspectRatioDropdown&&(e.ref.aspectRatioDropdown.selectedValue=e.query("GET_CROP_ASPECT_RATIO"))},DID_LOAD_IMAGE:function(t){var e=t.root,n=e.query("GET_IMAGE").aspectRatio;Yn(e,e.query("GET_CROP_ASPECT_RATIO")),e.ref.aspectRatioDropdown&&(e.ref.aspectRatioDropdown.selectedValue=e.query("GET_CROP_ASPECT_RATIO")),1!==n&&function(t,e){Array.from(t.element.querySelectorAll(".doka--icon-turn rect")).forEach(function(t){e>1&&(t.setAttribute("x",t.previousElementSibling?5:4),t.setAttribute("width",9)),e<1&&(t.setAttribute("y",11),t.setAttribute("height",10))})}(e,n)},DID_PRESENT_IMAGE:function(t){var e=t.root.ref,n=e.menu,r=e.rotator;n.opacity=1,r.opacity=1}},function(t){var e=t.root,n=t.props,r=t.timestamp,o=e.query("GET_CROP",n.id,r);if(o){var i=e.ref,a=i.resizer,c=i.subject,u=i.rotator,l=i.menu;a.pivotPoint={x:.5*a.rect.element.width,y:.5*a.rect.element.height},c.overlay=kn({},e.rect),u.animate=!o.isDraft,u.rotation=o.rotation.sub,l.element.dataset.layout=e.menuItemsRequiredWidth>e.ref.menu.rect.element.width?"compact":"spacious"}})});function Nn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var zn=V({name:"content",ignoreRect:!0,create:function(t){t.root.ref.view=null},write:Y({DID_LOAD_IMAGE:function(t){var e=t.root,n=t.props;e.ref.view=e.appendChildView(e.createChildView(Bn,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Nn(t,e,n[e])})}return t}({},n)))}})});function Xn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var qn=function(t,e){return t.appendChildView(t.createChildView(On("processing-indicator",{styles:["opacity","translateY"],animations:{opacity:{type:"tween",duration:500},translateY:{type:"spring",mass:20}}}),{translateY:20,opacity:0,controls:[{view:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return V({ignoreRect:!0,tag:t,create:function(t){t.root.element.textContent=e}})}("p",e)}]}))},Fn=V({name:"container",create:function(t){var e,n=t.root,r=t.props,o=[(e={view:_n,didCreateView:function(t){n.ref.btnReset=t},opacity:0,label:n.query("GET_LABEL_BUTTON_RESET")},Xn(e,"didCreateView",function(t){return n.ref.btnReset=t}),Xn(e,"name","menu menu-align-left menu-icon"),Xn(e,"icon",'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g fill="currentColor" fill-rule="nonzero"><path d="M6.036 13.418L4.49 11.872A.938.938 0 1 0 3.163 13.2l2.21 2.209a.938.938 0 0 0 1.326 0l2.209-2.21a.938.938 0 0 0-1.327-1.326l-1.545 1.546zM12 10.216a1 1 0 0 1 2 0V13a1 1 0 0 1-2 0v-2.784z"/><path d="M15.707 14.293a1 1 0 0 1-1.414 1.414l-2-2a1 1 0 0 1 1.414-1.414l2 2z"/><path d="M8.084 19.312a1 1 0 0 1 1.23-1.577 6 6 0 1 0-2.185-3.488 1 1 0 0 1-1.956.412 8 8 0 1 1 2.912 4.653z"/></g></svg>'),Xn(e,"action",function(){return n.dispatch("EDIT_RESET")}),e)];n.query("GET_ALLOW_BUTTON_CLOSE")&&o.unshift({view:_n,label:n.query("GET_LABEL_BUTTON_CLOSE"),name:"menu",opacity:0,didCreateView:function(t){n.ref.btnCancel=t},action:function(){n.dispatch("EDIT_CANCEL"),n.dispatch("EDIT_CLOSE")}}),n.query("GET_ALLOW_BUTTON_CONFIRM")&&o.push({view:_n,label:n.query("GET_LABEL_BUTTON_CONFIRM"),name:"menu menu-cta",opacity:0,didCreateView:function(t){n.ref.btnConfirm=t},action:function(){n.dispatch("EDIT_CONFIRM",{ready:function(){n.dispatch("EDIT_CLOSE")}})}}),n.ref.menu=n.appendChildView(n.createChildView(Ln,{className:"doka--menu",controls:o})),1===o.length&&n.ref.menu.element.classList.add("doka--menu-collapsed"),n.ref.content=n.appendChildView(n.createChildView(zn,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Xn(t,e,n[e])})}return t}({},r))),n.ref.busyIndicators=[]},write:Y({AWAITING_IMAGE:function(t){var e=t.root;if(!e.rect.element.hidden){var n=qn(e,e.query("GET_LABEL_STATUS_AWAITING_IMAGE"));e.ref.busyIndicators.push(n),n.translateY=0,n.opacity=1}},DID_LOAD_IMAGE_ERROR:function(t){var e=t.root,n=qn(e,e.query("GET_LABEL_STATUS_LOAD_IMAGE_ERROR"));e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.busyIndicators.push(n),n.translateY=0,n.opacity=1},DID_REQUEST_LOAD_IMAGE:function(t){var e=t.root,n=qn(e,e.query("GET_LABEL_STATUS_LOADING_IMAGE"));e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.busyIndicators.push(n),n.translateY=0,n.opacity=1},REQUEST_PREPARE_OUTPUT:function(t){var e=t.root,n=qn(e,e.query("GET_LABEL_STATUS_PROCESSING_IMAGE"));e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.busyIndicators.push(n),n.translateY=0,n.opacity=1,e.ref.menu.opacity=0},DID_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.menu.opacity=1},DID_PRESENT_IMAGE:function(t){var e=t.root;e.ref.busyIndicators.forEach(function(t){t.opacity=0});var n=e.ref,r=n.btnConfirm,o=n.btnCancel;r&&(r.opacity=1),o&&(o.opacity=1)}},function(t){var e=t.root,n=t.props,r=t.timestamp,o=e.query("GET_CROP",n.id,r);o&&(e.ref.btnReset.opacity=o.canReset?1:0)})});function Hn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Zn=function(t){return t.preventDefault()},Wn=V({name:"editor",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}},apis:["markedForRemoval"]},create:function(t){var e=t.root,n=t.props;n.markedForRemoval=!1,e.element.addEventListener("touchmove",Zn,{passive:!1}),e.element.addEventListener("gesturestart",Zn),e.appendChildView(e.createChildView(Fn,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Hn(t,e,n[e])})}return t}({},n)))},destroy:function(t){var e=t.root;e.element.removeEventListener("touchmove",Zn,!0),e.element.removeEventListener("gesturestart",Zn)}});function Qn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Kn=function(){var t=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Qn(t,e,n[e])})}return t}({},it());return window.addEventListener("touchstart",function e(){t.fire("touch-detected"),window.removeEventListener("touchstart",e,!1)},!1),t};function Jn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var $n=function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Jn(t,e,n[e])})}return t}({},it(),{destroy:function(){t.removeEventListener("dragover",n),t.removeEventListener("drop",r)}}),n=function(t){return t.preventDefault()},r=function(t){t.preventDefault();var n=Array.from(t.dataTransfer.items||t.dataTransfer.files).map(function(t){return t.getAsFile&&"file"===t.kind?t.getAsFile():t});e.fire("drop",n)};return t.addEventListener("dragover",n),t.addEventListener("drop",r),e},tr=V({name:"root",ignoreRect:!0,mixins:{apis:["fullscreen"],styles:["opacity"],animations:{opacity:{type:"tween",duration:350}}},create:function(t){var e=t.root,n=t.props;if(e.element.id=e.query("GET_ID")||"doka-".concat(n.id),e.ref.environment=[],e.query("GET_ALLOW_DROP_FILES")&&(e.ref.catcher=$n(e.element),e.ref.catcher.on("drop",function(t){t.forEach(function(t){e.dispatch("REQUEST_LOAD_IMAGE",{source:t})})})),e.ref.touchDetector=Kn(),e.ref.touchDetector.onOnce("touch-detected",function(){e.ref.environment.push("touch")}),e.query("GET_STYLES").filter(function(t){return!N(t.value)}).map(function(t){var n=t.name,r=t.value;e.element.dataset[n]=r}),n.fullscreen){var r=["fullscreen"],o=e.query("GET_STYLE_LAYOUT_MODE");"modal"===o&&r.push(o);var i=r.join(" ");e.dispatch("SET_STYLE_LAYOUT_MODE",{value:i}),e.element.dataset.styleLayoutMode=i,e.element.setAttribute("tabindex",-1),e.ref.initialScreenMeasureHeight=null,e.ref.fullscreenDetector=function(t){return e.element.dataset.styleFullscreen=window.innerHeight===e.ref.initialScreenMeasureHeight},e.ref.focusTrap=function(t){if(9===t.keyCode){var n=Array.from(e.element.querySelectorAll("button,[tabindex]")).filter(function(t){return"hidden"!==t.style.visibility}),r=n[0],o=n[n.length-1];t.shiftKey?document.activeElement===r&&(o.focus(),t.preventDefault()):document.activeElement===o&&(r.focus(),t.preventDefault())}},e.ref.escapeListener=function(t){27===t.keyCode&&(e.dispatch("EDIT_CANCEL"),e.dispatch("EDIT_CLOSE"))};var a=document.createDocumentFragment();a.appendChild(e.element);var c=document.createElement("div");c.style.cssText="position:fixed;height:100vh;top:0;",a.appendChild(c),e.ref.measure=c,document.body.appendChild(a)}e.ref.updateViewport=function(){e.dispatch("UPDATE_VIEWPORT")},window.addEventListener("resize",e.ref.updateViewport),e.ref.editor=e.appendChildView(e.createChildView(Wn,{opacity:"preview"===e.query("GET_STYLE_LAYOUT_MODE")||n.fullscreen?0:1,id:n.id})),n.fullscreen||e.dispatch("EDIT_OPEN"),e.element.dataset.styleViewport=er(e.rect.element.width,e.rect.element.height)+" "+e.ref.environment.join(" ")},read:function(t){var e=t.root,n=e.ref.measure;n&&(e.ref.initialScreenMeasureHeight=n.offsetHeight,n.parentNode.removeChild(n),e.ref.measure=null)},destroy:function(t){var e=t.root;window.removeEventListener("resize",e.ref.updateViewport),window.removeEventListener("scroll",e.ref.updateViewport),e.ref.catcher&&e.ref.catcher.destroy()},write:Y({DID_SET_STYLE_LAYOUT_MODE:function(t){var e=t.root,n=t.action;e.element.dataset.styleLayoutMode=n.value},UPDATE_VIEWPORT:function(t){var e=t.root;t.props;e.dispatch("DID_UPDATE_VIEWPORT",{rect:{left:e.ref.editor.rect.element.left,top:e.ref.editor.rect.element.top,width:e.rect.element.width,height:e.rect.element.height}})},DID_REQUEST_LOAD_IMAGE:function(t){var e=t.root,n=t.props,r=e.element;e.ref.editor||(e.ref.editor=e.appendChildView(e.createChildView(Wn,{opacity:0}))),e.ref.editor.opacity=1,n.fullscreen&&r.parentNode&&(document.body.classList.add("doka--parent"),r.dataset.styleFullscreen=window.innerHeight===e.ref.initialScreenMeasureHeight,window.addEventListener("resize",e.ref.fullscreenDetector),r.addEventListener("keydown",e.ref.focusTrap),r.addEventListener("keydown",e.ref.escapeListener),e.opacity=1,r.focus())},EDIT_CLOSE:function(t){var e=t.root,n=t.props,r=e.element,o=e.ref.editor;o.markedForRemoval=!0,e.query("HAS_EMPTY_QUEUE")?(n.fullscreen&&(window.removeEventListener("resize",e.ref.fullscreenDetector),r.removeEventListener("keydown",e.ref.focusTrap),r.removeEventListener("keydown",e.ref.escapeListener)),(n.fullscreen||"preview"===e.query("GET_STYLE_LAYOUT_MODE"))&&(e.opacity=0)):o.opacity=0}},function(t){var e=t.root;e.element.dataset.styleViewport=er(e.rect.element.width,e.rect.element.height)+" "+e.ref.environment.join(" "),e.query("GET_ROOT")||e.dispatch("UPDATE_VIEWPORT")}),didWriteView:function(t){var e=t.root,n=e.ref.editor;n&&n.markedForRemoval&&(0===e.opacity||0===n.opacity)&&(n._destroy(),e.removeChildView(n),e.ref.editor=null,e.dispatch("EDIT_DESTROY"),document.body.classList.remove("doka--parent"))}}),er=function(t,e){var n="";return n+=e>t?"portrait":"landscape",(n+=t<=600?" x-cramped":t<=1e3?" x-comfortable":" x-spacious").trim()};function nr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){rr(t,e,n[e])})}return t}function rr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var or=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s||(s=tr(a,{id:c,fullscreen:e.fullscreen||!1}),t.src&&a.dispatch("REQUEST_LOAD_IMAGE",{source:t.src}))},n=pt(),a=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=i({},t),o=[],a=[],c=function(t,e,n){n?a.push({type:t,data:e}):(s[t]&&s[t](e),o.push({type:t,data:e}))},u=function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return f[t]?(e=f)[t].apply(e,r):null},l={getState:function(){return i({},r)},processActionQueue:function(){var t=o.concat();return o.length=0,t},processDispatchQueue:function(){var t=a.concat();a.length=0,t.forEach(function(t){var e=t.type,n=t.data;c(e,n)})},dispatch:c,query:u},f={};e.forEach(function(t){f=i({},t(r),f)});var s={};return n.forEach(function(t){s=i({},t(c,u,r),s)}),l}(function(t){var e={queue:[],noImageTimeout:null,options:et(t)};return nt(e),e}(n),[Ot,function(t){return function(e){var n={};return l(t,function(t){n["GET_".concat(rt(t,"_").toUpperCase())]=function(n){return e.options[t]}}),n}}(n)],[We,function(t){return function(e,n,r){var o={};return l(t,function(t){var n=rt(t,"_").toUpperCase();o["SET_".concat(n)]=function(o){try{r.options[t]=o.value}catch(t){}e("DID_SET_".concat(n),{value:r.options[t]})}}),o}}(n)]);a.dispatch("SET_OPTIONS",{options:t});var c=ot(),u=null,s=null,p=!1,d={_read:function(){s&&!p&&s._read()},_write:function(t){if(s){var e=a.processActionQueue().filter(function(t){return!/^SET_/.test(t.type)});p&&!e.length||(m(e),(p=s._write(t,e))&&a.processDispatchQueue(),e.find(function(t){return"DID_CLOSE"===t.type})&&(g.destroy(),s.element.parentNode.removeChild(s.element),s=null))}}},h=function(t){return function(e){var n={type:t};return e?(n.output=e.output,e.hasOwnProperty("error")&&(n.error=e.error?nr({},e.error):null),n):n}},y={DID_CONFIRM:h("confirm"),DID_CANCEL:h("cancel"),DID_CLOSE:h("close"),DID_DESTROY:h("destroy"),DID_INIT:h("init")},m=function(t){t.length&&t.forEach(function(t){if(y[t.type]){var e=y[t.type];(Array.isArray(e)?e:[e]).forEach(function(e){setTimeout(function(){!function(t){var e=nr({doka:g},t);delete e.type,s&&s.element.dispatchEvent(new CustomEvent("Doka:".concat(t.type),{detail:e,bubbles:!0,cancelable:!0,composed:!0}));var n=[];t.hasOwnProperty("error")&&n.push(t.error);var r=["type","error"];Object.keys(t).filter(function(t){return!r.includes(t)}).forEach(function(e){return n.push(t[e])}),g.fire.apply(g,[t.type].concat(n));var o=a.query("GET_ON".concat(t.type.toUpperCase()));o&&o.apply(void 0,n)}(e(t.data))},0)})}})},g=nr({},it(),d,function(t,e){var n={};return l(e,function(e){n[e]={get:function(){return t.getState().options[e]},set:function(n){t.dispatch("SET_".concat(rt(e,"_").toUpperCase()),{value:n})}}}),n}(a,n),{setOptions:function(t){return a.dispatch("SET_OPTIONS",{options:t})},setData:function(t){a.dispatch("SET_DATA",t)},getData:function(t){return new Promise(function(e,n){a.dispatch("GET_DATA",nr({},t,{success:e,failure:n}))})},open:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(r,o){e({fullscreen:!0}),t&&a.dispatch("REQUEST_LOAD_IMAGE",{source:t,options:n,success:r,failure:o,resolveOnConfirm:n.resolveOnConfirm||!1})})},edit:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return g.open(t,nr({},e,{resolveOnConfirm:!0}))},clear:function(){return a.dispatch("REMOVE_IMAGE")},close:function(){return a.dispatch("EDIT_CLOSE")},destroy:function(){s&&(g.fire("destroy",s.element),s._destroy()),a.dispatch("DID_DESTROY")},insertBefore:function(t){e(),r(s.element,t)},insertAfter:function(t){e(),o(s.element,t)},appendTo:function(t){e(),t.appendChild(s.element)},replaceElement:function(t){e(),r(s.element,t),t.parentNode.removeChild(t),u=t},restoreElement:function(){u&&(o(u,s.element),s.element.parentNode.removeChild(s.element),u=null)},isAttachedTo:function(t){return!!s&&(s.element===t||u===t)},element:{get:function(){return s?s.element:null}}});return a.dispatch("DID_INIT"),f(g)};function ir(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ar=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};l(pt(),function(t,n){e[t]=n[0]});var n=or(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ir(t,e,n[e])})}return t}({},e,t));return n.src&&setTimeout(function(){n.open()},0),n};function cr(t){return(cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var ur=function(t){return"object"===cr(t)&&null!==t},lr=function(t){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.replace(new RegExp("".concat(e,"."),"g"),function(t){return t.charAt(1).toUpperCase()})}(t.replace(/^data-/,""))},fr=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];l(t.attributes,function(e){return n.push(t.attributes[e])});var r=n.filter(function(t){return t.name}).reduce(function(e,n){var r=s(t,n.name);return e[lr(n.name)]=r===n.name||r,e},{});return function t(e,n){l(n,function(n,r){l(e,function(t,o){var i=new RegExp(n);if(i.test(t)&&(delete e[t],!1!==r))if(F(r))e[r]=o;else{var a=r.group;ur(r)&&!e[a]&&(e[a]={}),e[a][function(t){return t.charAt(0).toLowerCase()+t.slice(1)}(t.replace(i,""))]=o}}),r.mapping&&t(e[r.group],r.mapping)})}(r,e),r},sr=[];function pr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var dr=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={"^class$":"className"};!function(t,e,n){sr.filter(function(e){return e.key===t}).map(function(t){return t.cb(e,n)})}("SET_ATTRIBUTE_TO_OPTION_MAP",n);var r=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){pr(t,e,n[e])})}return t}({},e),o=fr(t,n);Object.keys(o).forEach(function(t){ur(o[t])?(ur(r[t])||(r[t]={}),Object.assign(r[t],o[t])):r[t]=o[t]}),"CANVAS"!==t.nodeName&&"IMG"!==t.nodeName||(r.src=t.dataset.dokaSrc?t.dataset.dokaSrc:t);var i=ar(r);return i.replaceElement(t),i},hr=function(){return function(t){return t instanceof HTMLElement}(arguments.length<=0?void 0:arguments[0])?dr.apply(void 0,arguments):ar.apply(void 0,arguments)},yr=["fire","_read","_write"],mr=function(t){var e={};return function(t,e,n){Object.getOwnPropertyNames(t).filter(function(t){return!n.includes(t)}).forEach(function(n){return Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}(t,e,yr),e};n.d(e,"supported",function(){return gr}),n.d(e,"OptionTypes",function(){return wr}),n.d(e,"create",function(){return br}),n.d(e,"destroy",function(){return _r}),n.d(e,"parse",function(){return Or}),n.d(e,"find",function(){return xr}),n.d(e,"getOptions",function(){return Rr}),n.d(e,"setOptions",function(){return Tr});var gr=function(){var t="undefined"!=typeof window&&void 0!==window.document&&!("[object OperaMini]"===Object.prototype.toString.call(window.operamini))&&"visibilityState"in document&&"Promise"in window&&"slice"in Blob.prototype&&"URL"in window&&"createObjectURL"in window.URL&&"performance"in window;return function(){return t}}(),vr={apps:[]},Er=function(){},wr={},br=Er,_r=Er,Or=Er,xr=Er,Rr=Er,Tr=Er;if(gr()){!function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,r="__framePainter";if(window[r])return window[r].readers.push(t),void window[r].writers.push(e);window[r]={readers:[t],writers:[e]};var o=window[r],i=1e3/n,a=null,c=null;(function t(e){c=window.requestAnimationFrame(t),a||(a=e);var n=e-a;n<=i||(a=e-n%i,o.readers.forEach(function(t){return t()}),o.writers.forEach(function(t){return t(e)}))})(performance.now())}(function(){vr.apps.forEach(function(t){return t._read()})},function(t){vr.apps.forEach(function(e){return e._write(t)})});var Pr=function t(){document.dispatchEvent(new CustomEvent("doka:loaded",{detail:{supported:gr,create:br,destroy:_r,parse:Or,find:xr,setOptions:Tr}})),document.removeEventListener("DOMContentLoaded",t)};"loading"!==document.readyState?setTimeout(function(){return Pr()},0):document.addEventListener("DOMContentLoaded",Pr);wr={},l(pt(),function(t,e){wr[t]=e[1]}),br=function(){var t=hr.apply(void 0,arguments);return t.on("destroy",_r),vr.apps.push(t),mr(t)},_r=function(t){var e=vr.apps.findIndex(function(e){return e.isAttachedTo(t)});return e>=0&&(vr.apps.splice(e,1)[0].restoreElement(),!0)},Or=function(t){return Array.from(t.querySelectorAll(".".concat("doka"))).filter(function(t){return!vr.apps.find(function(e){return e.isAttachedTo(t)})}).map(function(t){return br(t)})},xr=function(t){var e=vr.apps.find(function(e){return e.isAttachedTo(t)});return e?mr(e):null},Rr=function(){var t={};return l(pt(),function(e,n){t[e]=n[0]}),t},Tr=function(t){return ur(t)&&(vr.apps.forEach(function(e){e.setOptions(t)}),function(t){l(t,function(t,e){dt[t]&&(dt[t][0]=tt(e,dt[t][0],dt[t][1]))})}(t)),Rr()}}}])});